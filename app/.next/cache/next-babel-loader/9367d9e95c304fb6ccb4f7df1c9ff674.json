{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport React, { Component } from 'react';\nimport ReactTable from \"react-table\";\nimport styled from 'styled-components';\nimport \"react-table/react-table.css\";\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\n\nconst liffInit = async () => {\n  liff.init(data => {\n    const userId = data.context.userId;\n    const accessToken = liff.getAccessToken(); //alert(\"success\");\n    //alert(userId);\n\n    const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n    const body = {\n      userId: userId\n    };\n    fetch(URL_CHECKEXIST, {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: _JSON$stringify(body)\n    }).then(res => {\n      return res.text();\n    }).then(result => {\n      if (result) {\n        alert(userId);\n        alert(accessToken);\n        lineAuth(userId, accessToken);\n      } else {\n        alert(\"請登入以查看假單\");\n        window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n      }\n    });\n  }, err => {\n    alert(\"error\");\n  });\n};\n\nconst lineAuth = async (userId, accessToken) => {\n  const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n  const body = {\n    userId: userId,\n    accessToken: accessToken\n  };\n  fetch(url, {\n    method: 'post',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: _JSON$stringify(body)\n  }).then(res => {\n    return res.json();\n  }).then(result => {\n    if (result) {\n      alert(\"success\"); //alert(result.staff);\n      //alert(result);\n\n      const ubn = result.staff.ubn;\n      const email = result.staff.email;\n      const idToken = result.token.idToken;\n      getLeaves(ubn, email, idToken);\n    } else {\n      alert(\"lineAuth no result\");\n    }\n  }).catch(function (error) {\n    alert(error.message);\n  });\n};\n\nvar leaves;\n\nconst getLeaves = async (ubn, email, idToken) => {\n  const url_pre = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n  const url = url_pre + `?ubn=${ubn}&query=email&value=${email}`;\n  const header = {\n    Authorization: idToken\n  };\n  fetch(url, {\n    method: 'get',\n    headers: header\n  }).then(res => {\n    return res.json();\n  }).then(result => {\n    if (result) {\n      convertData(result.list);\n      alert(result.list[0].startDate);\n    } else {\n      alert(\"getLeaves no result\");\n    }\n  }).catch(function (error) {\n    alert(error.message);\n  });\n};\n\nconst convertData = async list => {\n  var newList = [];\n\n  for (var i = 0; i < list.length; i++) {\n    const data = {\n      \"startDate\": list[i].startDate,\n      \"endDate\": list[i].endDate,\n      \"leaveType\": list[i].leaveType,\n      \"substitute\": list[i].substitute.name,\n      \"status\": list[i].status\n    };\n    newList.push(data);\n  }\n\n  leaves = newList; //alert(leaves);\n};\n\nliffInit();\n\nconst Basic = () => __jsx(Head, null, __jsx(\"script\", {\n  src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n})); //export default Basic;\n\n\nexport default class App extends Component {\n  render() {\n    const columns = [{\n      Header: '開始日期',\n      accessor: 'startDate'\n    }, {\n      Header: '結束日期',\n      accessor: 'endDate'\n    }, {\n      Header: '假勤類別',\n      accessor: 'leaveType'\n    }, {\n      Header: '代理人',\n      accessor: 'substitute'\n    }, {\n      Header: '簽核狀態',\n      accessor: 'status'\n    }];\n    return __jsx(BOX, null, __jsx(Head, null, __jsx(\"script\", {\n      src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n    })), __jsx(\"div\", null, __jsx(ReactTable, {\n      data: leaves,\n      columns: columns,\n      defaultPageSize: 3,\n      pageSizeOptions: [3, 6]\n    })));\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}