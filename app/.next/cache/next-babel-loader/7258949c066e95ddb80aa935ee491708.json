{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nvar _jsxFileName = \"/Users/yan/ezbot-web/app/pages/createLeave.js\";\nvar __jsx = React.createElement;\n// Render Prop\nimport React from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport icon from '../components/image/icon.png';\nimport Head from 'next/head';\nimport window from 'global';\nimport DatePicker from \"react-datepicker\";\nimport { Select } from 'material-ui-formik-components/Select';\n\nrequire(\"react-datepicker/dist/react-datepicker.css\");\n\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\nconst TITLE = styled.h2`\n  color: #F8F9F9;\n  font-family: Candara;\n  text-align: center;\n  margin-bottom:-2em;\n`;\nconst CONTAINER = styled.div`\n  background: #F7F9FA;\n  height: auto;\n  width: 90%;\n  margin: 5em auto;\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\n\n  label {\n    font-family: Candara;\n    color: #1C2833;\n    font-size: 1.2em;\n    font-weight: 400;\n  }\n`;\nconst MYFORM = styled(Form)`\n  text-align: center;\n  padding-top: 2em;\n  padding-bottom: 2em;\n`;\nconst FIELD = styled(Field)`\n  width: 80%;\n`;\nconst BUTTON = styled(Button)`\n  width: 80%;\n  variant: contained;\n`;\nconst TomatoButton = styled.button`\n  color: tomato;\n  border-color: tomato;\n  width: 80%;\n`;\n\nconst liffInit = async () => {\n  liff.init(data => {\n    const userId = data.context.userId;\n    const accessToken = liff.getAccessToken(); //alert(\"success\");\n    //alert(userId);\n\n    const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n    const body = {\n      userId: userId\n    };\n    fetch(URL_CHECKEXIST, {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: _JSON$stringify(body)\n    }).then(res => {\n      return res.text();\n    }).then(result => {\n      if (result) {\n        alert(userId);\n        alert(accessToken);\n        lineAuth(userId, accessToken);\n      } else {\n        alert(\"請登入以查看假單\");\n        window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n      }\n    });\n  }, err => {\n    alert(\"error\");\n  });\n};\n\nconst lineAuth = async (userId, accessToken) => {\n  const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n  const body = {\n    userId: userId,\n    accessToken: accessToken\n  };\n  fetch(url, {\n    method: 'post',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: _JSON$stringify(body)\n  }).then(res => {\n    return res.json();\n  }).then(result => {\n    if (result) {\n      alert(\"success\"); //alert(result.staff);\n      //alert(result);\n\n      const ubn = result.staff.ubn;\n      const department = result.staff.depertment;\n      const idToken = result.token.idToken;\n      getSubstitutes(ubn, department, idToken);\n    } else {\n      alert(\"lineAuth no result\");\n    }\n  }).catch(function (error) {\n    alert(error.message);\n  });\n};\n\nconst getSubstitutes = async (ubn, department, accessToken) => {\n  const URL_GETSUBSTITUTES = \"https://https-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n  const url = URL_GETSUBSTITUTES + `?ubn=${ubn}&query=department&value=${department}`;\n  const header = {\n    Authorization: accessToken\n  };\n  fetch(url, {\n    method: 'get',\n    headers: header\n  }).then(res => {\n    return res.json();\n  }).then(result => {\n    if (result) {\n      alert(\"success\");\n      createOptions(result.list);\n    } else {\n      alert(\"getSubstitutes no result\");\n    }\n  }).catch(function (error) {\n    alert(error.message);\n  });\n};\n\nvar substitutes;\n\nconst createOptions = async arr => {\n  for (var i = 0; i < arr.length; i++) {\n    var obj = JSON.parse(arr)[i];\n    obj.email = obj.value;\n    obj.name = obj.label;\n    delete obj.email;\n    delete obj.name; //push to list\n\n    var newList = [];\n    newList.push(obj);\n  } // tell Basic that options have been changed\n  //substitutes = newList;\n\n\n  return newList;\n}; //liffInit();\n\n\nconst Basic = props => __jsx(BOX, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 173\n  },\n  __self: this\n}, __jsx(Head, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 174\n  },\n  __self: this\n}, __jsx(\"script\", {\n  src: \"https://d.line-scdn.net/liff/1.0/sdk.js\",\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 175\n  },\n  __self: this\n})), __jsx(\"body\", {\n  style: {\n    background: '#34495E'\n  },\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 177\n  },\n  __self: this\n}, __jsx(BOX, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 178\n  },\n  __self: this\n}, __jsx(Formik, {\n  initialValues: {\n    startDate: '',\n    endDate: '',\n    leaveType: '',\n    leaveReason: ' ',\n    substitute: ' '\n  },\n  validate: values => {\n    const errors = {}; // check for ubn\n\n    if (!values.startDate) {\n      errors.startDate = 'Required';\n    } // check for email\n\n\n    if (!values.endDate) {\n      errors.endDate = 'Required';\n    } // check for leaveType\n\n\n    if (!values.leaveType) {\n      errors.leaveType = 'Required';\n    } // check for leaveReason\n\n\n    if (!values.leaveReason) {\n      errors.leaveReason = 'Required';\n    } // check for substitute\n\n\n    if (!values.substitute) {\n      errors.substitute = 'Required';\n    }\n\n    return errors;\n  },\n  onSubmit: (values, {\n    setSubmitting\n  }) => {\n    //submitForm(values, userId);\n    setTimeout(() => {\n      submitForm(values, userId);\n      setSubmitting(false);\n    }, 400); //console.log('submitting', values);\n    //setSubmitting(false);\n  },\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 179\n  },\n  __self: this\n}, ({\n  isSubmitting,\n  values,\n  setFieldValue\n}) => __jsx(CONTAINER, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 218\n  },\n  __self: this\n}, __jsx(MYFORM, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 219\n  },\n  __self: this\n}, __jsx(DatePicker, {\n  selected: values.startDate,\n  dateFormat: \"MMMM d, yyyy\",\n  className: \"form-control\",\n  name: \"startDate\",\n  label: \"\\u958B\\u59CB\\u65E5\\u671F\",\n  onChange: date => setFieldValue('startDate', date),\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 220\n  },\n  __self: this\n}), __jsx(DatePicker, {\n  selected: values.endDate,\n  dateFormat: \"MMMM d, yyyy\",\n  className: \"form-control\",\n  name: \"endDate\",\n  label: \"\\u7D50\\u675F\\u65E5\\u671F\",\n  onChange: date => setFieldValue('endDate', date),\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 228\n  },\n  __self: this\n}), __jsx(FIELD, {\n  type: \"leaveType\",\n  name: \"leaveType\",\n  label: \"\\u5047\\u52E4\\u985E\\u5225\",\n  component: TextField,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 236\n  },\n  __self: this\n}), __jsx(FIELD, {\n  type: \"leaveReason\",\n  name: \"leaveReason\",\n  label: \"\\u5047\\u52E4\\u4E8B\\u7531\",\n  component: TextField,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 237\n  },\n  __self: this\n}), __jsx(FIELD, {\n  type: \"substitute\",\n  name: \"substitute\",\n  label: \"\\u8077\\u52D9\\u4EE3\\u7406\\u4EBA\",\n  component: TextField,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 238\n  },\n  __self: this\n}), __jsx(Field, {\n  required: true,\n  name: \"substitute\",\n  label: \"\\u8077\\u52D9\\u4EE3\\u7406\\u4EBA\",\n  options: props.substitutes,\n  component: Select,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 239\n  },\n  __self: this\n}), __jsx(\"br\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 246\n  },\n  __self: this\n}), __jsx(\"br\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 247\n  },\n  __self: this\n}), __jsx(BUTTON, {\n  type: \"submit\",\n  fontFamily: \"Candara\",\n  variant: \"contained\",\n  color: \"secondary\",\n  disabled: isSubmitting,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 248\n  },\n  __self: this\n}, \"\\u9001\\u51FA\\u5047\\u55AE\")))))));\n\nBasic.getInitialProps = async req => {\n  liffInit();\n  return {\n    substitutes: [{\n      value: '',\n      label: '-- No selection --'\n    }, {\n      value: 'Male',\n      label: 'Male'\n    }, {\n      value: 'Female',\n      label: 'Female'\n    }, {\n      value: 'Other',\n      label: 'Other'\n    }]\n  };\n};\n\nexport default Basic;","map":{"version":3,"sources":["/Users/yan/ezbot-web/app/pages/createLeave.js"],"names":["React","styled","Formik","Form","Field","ErrorMessage","TextField","fetch","Button","Box","icon","Head","window","DatePicker","Select","require","liff","BOX","div","TITLE","h2","CONTAINER","MYFORM","FIELD","BUTTON","TomatoButton","button","liffInit","init","data","userId","context","accessToken","getAccessToken","URL_CHECKEXIST","body","method","headers","then","res","text","result","alert","lineAuth","location","replace","err","url","json","ubn","staff","department","depertment","idToken","token","getSubstitutes","catch","error","message","URL_GETSUBSTITUTES","header","Authorization","createOptions","list","substitutes","arr","i","length","obj","JSON","parse","email","value","name","label","newList","push","Basic","props","background","startDate","endDate","leaveType","leaveReason","substitute","values","errors","setSubmitting","setTimeout","submitForm","isSubmitting","setFieldValue","date","getInitialProps","req"],"mappings":"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","sourcesContent":["// Render Prop\nimport React from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport icon from '../components/image/icon.png';\nimport Head from 'next/head';\nimport window from 'global';\nimport DatePicker from \"react-datepicker\";\nimport { Select } from 'material-ui-formik-components/Select'\nrequire( \"react-datepicker/dist/react-datepicker.css\");\n\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\nconst TITLE = styled.h2`\n  color: #F8F9F9;\n  font-family: Candara;\n  text-align: center;\n  margin-bottom:-2em;\n`;\nconst CONTAINER = styled.div`\n  background: #F7F9FA;\n  height: auto;\n  width: 90%;\n  margin: 5em auto;\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\n\n  label {\n    font-family: Candara;\n    color: #1C2833;\n    font-size: 1.2em;\n    font-weight: 400;\n  }\n`;\nconst MYFORM = styled(Form)`\n  text-align: center;\n  padding-top: 2em;\n  padding-bottom: 2em;\n`;\nconst FIELD = styled(Field)`\n  width: 80%;\n`;\nconst BUTTON = styled(Button)`\n  width: 80%;\n  variant: contained;\n`;\nconst TomatoButton = styled.button`\n  color: tomato;\n  border-color: tomato;\n  width: 80%;\n`;\n\nconst liffInit = async () => {\n    liff.init(data => {\n      const userId = data.context.userId;\n      const accessToken = liff.getAccessToken();\n      //alert(\"success\");\n      //alert(userId);\n      const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n      const body = {\n        userId: userId\n      };\n      fetch(URL_CHECKEXIST, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(body)\n      }).then((res) => {\n        return res.text();\n      }).then(result => {\n        if (result) {\n            alert(userId);\n            alert(accessToken);\n            lineAuth(userId, accessToken);\n        } else {\n            alert(\"請登入以查看假單\");\n            window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n        }\n      })\n      \n  \n    }, err => {\n      alert(\"error\");\n    });\n  }\n\nconst lineAuth = async(userId, accessToken) => {\n    const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n    const body = {\n        userId: userId,\n        accessToken: accessToken\n      };\n    fetch(url, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(body)\n      }).then((res) => {\n        return res.json();\n      }).then(result => {\n        if (result) {\n            alert(\"success\");\n            //alert(result.staff);\n            //alert(result);\n            const ubn = result.staff.ubn;\n            const department = result.staff.depertment;\n            const idToken = result.token.idToken;\n            getSubstitutes(ubn, department, idToken);\n        } else {\n            alert(\"lineAuth no result\");\n\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      })\n}\n\nconst getSubstitutes = async(ubn, department, accessToken) => {\n  const URL_GETSUBSTITUTES = \"https://https-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n  const url = URL_GETSUBSTITUTES + `?ubn=${ubn}&query=department&value=${department}`; \n  const header = {\n      Authorization: accessToken\n    };\n  fetch(url, {\n      method: 'get',\n      headers: header\n    }).then((res) => {\n      return res.json();\n    }).then(result => {\n      if (result) {\n        alert(\"success\");\n        createOptions(result.list)\n\n\n\n      } else {\n          alert(\"getSubstitutes no result\");\n\n      }\n    }).catch(function (error) {\n      alert(error.message);\n    })\n}\nvar substitutes;\nconst createOptions = async(arr) => {\n  for (var i = 0; i < arr.length; i++) {\n    var obj = JSON.parse(arr)[i];\n    obj.email = obj.value;\n    obj.name = obj.label;\n    delete obj.email;\n    delete obj.name;\n    //push to list\n    var newList = [];\n    newList.push(obj);\n  }\n  // tell Basic that options have been changed\n  //substitutes = newList;\n  return newList\n}\n\n//liffInit();\n\n\n\nconst Basic = props => (\n    <BOX>\n    <Head>\n      <script src=\"https://d.line-scdn.net/liff/1.0/sdk.js\"></script>\n    </Head>\n    <body style={{background:'#34495E'}}>\n      <BOX>\n        <Formik\n          initialValues={{ startDate: '', endDate: '', leaveType: '', leaveReason: ' ', substitute: ' ' }}\n          validate={values => {\n            const errors = {};\n            // check for ubn\n            if (!values.startDate) {\n              errors.startDate = 'Required';\n            }\n            // check for email\n            if (!values.endDate) {\n              errors.endDate = 'Required';\n            } \n            // check for leaveType\n            if (!values.leaveType) {\n              errors.leaveType = 'Required';\n            }\n            // check for leaveReason\n            if (!values.leaveReason) {\n                errors.leaveReason = 'Required';\n            }\n            // check for substitute\n            if (!values.substitute) {\n                errors.substitute = 'Required';\n            }\n            return errors;\n          }}\n          onSubmit={(values, { setSubmitting }) => {\n            //submitForm(values, userId);\n  \n            setTimeout(() => {\n              submitForm(values, userId);\n              setSubmitting(false);\n            }, 400);\n            \n            //console.log('submitting', values);\n            //setSubmitting(false);\n          }}\n        >\n          {({ isSubmitting, values, setFieldValue}) => (\n            <CONTAINER>\n            <MYFORM>\n            <DatePicker \n              selected={values.startDate}\n              dateFormat=\"MMMM d, yyyy\"\n              className=\"form-control\"\n              name=\"startDate\"\n              label = \"開始日期\"\n              onChange={date => setFieldValue('startDate', date)}\n            />\n            <DatePicker \n              selected={values.endDate}\n              dateFormat=\"MMMM d, yyyy\"\n              className=\"form-control\"\n              name=\"endDate\"\n              label = \"結束日期\"\n              onChange={date => setFieldValue('endDate', date)}\n            />\n              <FIELD type=\"leaveType\" name=\"leaveType\" label = \"假勤類別\" component = { TextField }/>\n              <FIELD type=\"leaveReason\" name=\"leaveReason\" label = \"假勤事由\" component = { TextField }/>\n              <FIELD type=\"substitute\" name=\"substitute\" label = \"職務代理人\" component = { TextField }/>\n              <Field\n                required\n                name=\"substitute\"\n                label=\"職務代理人\"\n                options={props.substitutes}\n                component={Select}\n              />\n              <br></br>\n              <br></br>\n              <BUTTON\n              type=\"submit\"\n              fontFamily= \"Candara\"\n              variant=\"contained\"\n              color=\"secondary\"\n              disabled={isSubmitting}\n            >\n              送出假單\n            </BUTTON>\n            </MYFORM>\n            </CONTAINER>\n          )}\n        </Formik>\n      </BOX>\n    </body>\n    </BOX>\n    \n  );\n  \n  Basic.getInitialProps = async (req) => {\n    liffInit();\n    return {\n      substitutes: [\n        { value: '', label: '-- No selection --' },\n        { value: 'Male', label: 'Male' },\n        { value: 'Female', label: 'Female' },\n        { value: 'Other', label: 'Other' },\n      ]\n    }\n  }\n\n  export default Basic;"]},"metadata":{},"sourceType":"module"}