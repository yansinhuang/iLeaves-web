{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar __jsx = React.createElement;\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n  color: tomato;\\n  border-color: tomato;\\n  width: 80%;\\n\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 80%;\\n  variant: contained;\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 80%;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  text-align: center;\\n  padding-top: 2em;\\n  padding-bottom: 2em;\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  background: #F7F9FA;\\n  height: auto;\\n  width: 90%;\\n  margin: 5em auto;\\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\\n\\n  label {\\n    font-family: Candara;\\n    color: #1C2833;\\n    font-size: 1.2em;\\n    font-weight: 400;\\n  }\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  color: #F8F9F9;\\n  font-family: Candara;\\n  text-align: center;\\n  margin-bottom:-2em;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 5.5em auto;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\n// Render Prop\nimport React, { Component } from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport icon from '../components/image/icon.png';\nimport Head from 'next/head';\nimport window from 'global';\nimport DatePicker from \"react-datepicker\";\nimport { Select } from 'material-ui-formik-components/Select';\n\nrequire(\"react-datepicker/dist/react-datepicker.css\");\n\nvar liff = window.liff;\nvar BOX = styled.div(_templateObject());\nvar TITLE = styled.h2(_templateObject2());\nvar CONTAINER = styled.div(_templateObject3());\nvar MYFORM = styled(Form)(_templateObject4());\nvar FIELD = styled(Field)(_templateObject5());\nvar BUTTON = styled(Button)(_templateObject6());\nvar TomatoButton = styled.button(_templateObject7());\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n    _this.state = {\n      substitutes: []\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.liffInit();\n    }\n  }, {\n    key: \"liffInit\",\n    value: function liffInit() {\n      var _this2 = this;\n\n      liff.init(function (data) {\n        var userId = data.context.userId;\n        var accessToken = liff.getAccessToken();\n        var URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n        var body = {\n          userId: userId\n        };\n        fetch(URL_CHECKEXIST, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(function (res) {\n          return res.text();\n        }).then(function (result) {\n          if (result) {\n            alert(\"liffInit\");\n\n            _this2.lineAuth(userId, accessToken);\n          } else {\n            alert(\"請登入以查看假單\");\n            window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n          }\n        });\n      }, function (err) {\n        alert(\"error\");\n      });\n    }\n  }, {\n    key: \"lineAuth\",\n    value: function lineAuth(userId, accessToken) {\n      var _this3 = this;\n\n      var url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n      var body = {\n        userId: userId,\n        accessToken: accessToken\n      };\n      fetch(url, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: _JSON$stringify(body)\n      }).then(function (res) {\n        return res.json();\n      }).then(function (result) {\n        if (result) {\n          alert(\"lineAuth\");\n          alert(\"department \" + result.staff.department);\n          var ubn = result.staff.ubn;\n          var department = result.staff.department;\n          var idToken = result.token.idToken;\n\n          _this3.getSubstitutes(ubn, department, idToken);\n        } else {\n          alert(\"lineAuth no result\");\n        }\n      })[\"catch\"](function (error) {\n        alert(error.message);\n      });\n    }\n  }, {\n    key: \"getSubstitutes\",\n    value: function getSubstitutes(ubn, department, idToken) {\n      var _this4 = this;\n\n      var URL_GETSUBSTITUTES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/getSubstitutes\";\n      var url = URL_GETSUBSTITUTES + \"?ubn=\".concat(ubn, \"&query=department&value=\").concat(department);\n      var header = {\n        Authorization: idToken\n      };\n      alert(url); //document.write(idToken);\n\n      fetch(url, {\n        method: 'get',\n        headers: header\n      }).then(function (res) {\n        return res.json();\n      }).then(function (result) {\n        if (result) {\n          alert(\"getSubstitutes\");\n\n          _this4.createOptions(result.list);\n        } else {\n          alert(\"getSubstitutes no result\");\n        }\n      })[\"catch\"](function (error) {\n        alert(error.message);\n      });\n    }\n  }, {\n    key: \"createOptions\",\n    value: function createOptions(arr) {\n      for (var i = 0; i < arr.length; i++) {\n        var obj = arr[i];\n        obj.value = obj.email;\n        obj.label = obj.name;\n        delete obj.email;\n        delete obj.name; //push to list\n\n        var newList = [];\n        newList.push(obj);\n\n        if (i == arr.length - 1) {\n          alert(newList.length);\n          this.setState({\n            substitutes: newList\n          });\n        }\n      }\n    } // tell Basic that options have been changed\n    //substitutes = newList;\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this5 = this;\n\n      return __jsx(BOX, null, __jsx(Head, null, __jsx(\"script\", {\n        src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n      })), __jsx(\"body\", {\n        style: {\n          background: '#34495E'\n        }\n      }, __jsx(BOX, null, __jsx(Formik, {\n        initialValues: {\n          startDate: '',\n          endDate: '',\n          leaveType: '',\n          leaveReason: ' ',\n          substitute: ' '\n        },\n        validate: function validate(values) {\n          var errors = {}; // check for ubn\n\n          if (!values.startDate) {\n            errors.startDate = 'Required';\n          } // check for email\n\n\n          if (!values.endDate) {\n            errors.endDate = 'Required';\n          } // check for leaveType\n\n\n          if (!values.leaveType) {\n            errors.leaveType = 'Required';\n          } // check for leaveReason\n\n\n          if (!values.leaveReason) {\n            errors.leaveReason = 'Required';\n          } // check for substitute\n\n\n          if (!values.substitute) {\n            errors.substitute = 'Required';\n          }\n\n          return errors;\n        },\n        onSubmit: function onSubmit(values, _ref) {\n          var setSubmitting = _ref.setSubmitting;\n          //submitForm(values, userId);\n          setTimeout(function () {\n            submitForm(values, userId);\n            setSubmitting(false);\n          }, 400); //console.log('submitting', values);\n          //setSubmitting(false);\n        }\n      }, function (_ref2) {\n        var isSubmitting = _ref2.isSubmitting,\n            values = _ref2.values,\n            setFieldValue = _ref2.setFieldValue;\n        return __jsx(CONTAINER, null, __jsx(MYFORM, null, __jsx(DatePicker, {\n          selected: values.startDate,\n          dateFormat: \"MMMM d, yyyy\",\n          className: \"form-control\",\n          name: \"startDate\",\n          label: \"\\u958B\\u59CB\\u65E5\\u671F\",\n          onChange: function onChange(date) {\n            return setFieldValue('startDate', date);\n          }\n        }), __jsx(DatePicker, {\n          selected: values.endDate,\n          dateFormat: \"MMMM d, yyyy\",\n          className: \"form-control\",\n          name: \"endDate\",\n          label: \"\\u7D50\\u675F\\u65E5\\u671F\",\n          onChange: function onChange(date) {\n            return setFieldValue('endDate', date);\n          }\n        }), __jsx(FIELD, {\n          type: \"leaveType\",\n          name: \"leaveType\",\n          label: \"\\u5047\\u52E4\\u985E\\u5225\",\n          component: TextField\n        }), __jsx(FIELD, {\n          type: \"leaveReason\",\n          name: \"leaveReason\",\n          label: \"\\u5047\\u52E4\\u4E8B\\u7531\",\n          component: TextField\n        }), __jsx(FIELD, {\n          type: \"substitute\",\n          name: \"substitute\",\n          label: \"\\u8077\\u52D9\\u4EE3\\u7406\\u4EBA\",\n          component: TextField\n        }), __jsx(Field, {\n          required: true,\n          name: \"substitute\",\n          label: \"\\u8077\\u52D9\\u4EE3\\u7406\\u4EBA\",\n          options: _this5.state.substitutes,\n          component: Select\n        }), __jsx(\"br\", null), __jsx(\"br\", null), __jsx(BUTTON, {\n          type: \"submit\",\n          fontFamily: \"Candara\",\n          variant: \"contained\",\n          color: \"secondary\",\n          disabled: isSubmitting\n        }, \"\\u9001\\u51FA\\u5047\\u55AE\")));\n      }))));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport { App as default };","map":null,"metadata":{},"sourceType":"module"}