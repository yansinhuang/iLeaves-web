{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nvar __jsx = React.createElement;\n// Render Prop\nimport React, { Component } from 'react';\nimport fetch from 'isomorphic-unfetch';\nimport Head from 'next/head';\nimport window from 'global';\nimport Loader from 'react-loader-spinner';\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\nimport firebase from 'firebase';\nvar config = {\n  databaseUrl: 'https://teddybear-dev.firebaseio.com',\n  authUrl: 'https://identitytoolkit.googleapis.com/v1',\n  secureUrl: 'https://securetoken.googleapis.com/v1',\n  apiKey: 'AIzaSyDhqqn1bFuw7mpHKQDdRPQZrc2HfmKb-l8'\n};\nvar liff = window.liff;\nimport { BOX, TITLE, TEXT, CONTAINER, BUTTON, GlobalStyle } from './component';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n    _this.state = {\n      userId: null,\n      email: null\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.liffInit();\n    }\n  }, {\n    key: \"liffInit\",\n    value: function liffInit() {\n      var _this2 = this;\n\n      try {\n        firebase.initializeApp(config);\n        liff.init(function (data) {\n          var userId = data.context.userId;\n          var accessToken = liff.getAccessToken();\n          var URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n          var body = {\n            userId: userId\n          };\n          fetch(URL_CHECKEXIST, {\n            method: 'post',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: _JSON$stringify(body)\n          }).then(function (res) {\n            return res.text();\n          }).then(function (result) {\n            if (result) {\n              _this2.setState({\n                userId: userId\n              });\n\n              _this2.lineAuth(userId, accessToken);\n            } else {\n              alert(\"請登入\");\n              window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n            }\n          });\n        }, function (err) {\n          alert(err.message);\n        });\n      } catch (err) {\n        next(err);\n      }\n    }\n  }, {\n    key: \"lineAuth\",\n    value: function lineAuth(userId, accessToken) {\n      var _this3 = this;\n\n      try {\n        var url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n        var body = {\n          userId: userId,\n          accessToken: accessToken\n        };\n        fetch(url, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          if (result) {\n            var ubn = result.staff.ubn;\n            var department = result.staff.department;\n            var email = result.staff.email;\n            var idToken = result.token.idToken;\n\n            _this3.setState({\n              Authorization: idToken,\n              ubn: ubn,\n              email: email\n            });\n          } else {\n            alert(\"lineAuth no result\");\n          }\n        })[\"catch\"](function (error) {\n          alert(error.message);\n        });\n      } catch (err) {\n        next(err);\n      }\n    }\n  }, {\n    key: \"forgotPassword\",\n    value: function forgotPassword(email) {\n      try {\n        firebase.auth().sendPasswordResetEmail(email).then(function () {\n          alert('請查看信箱：' + email);\n          var messages = [{\n            type: \"text\",\n            text: \"已發送密碼重設信\"\n          }];\n          liff.sendMessages(messages);\n          liff.closeWindow();\n        });\n      } catch (err) {\n        alert(err);\n        next(err);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return __jsx(BOX, null, __jsx(GlobalStyle, null), __jsx(Head, null, __jsx(\"script\", {\n        src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n      }), __jsx(\"script\", {\n        src: \"https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js\"\n      }), __jsx(\"link\", {\n        type: \"text/css\",\n        rel: \"stylesheet\",\n        href: \"https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css\"\n      })), __jsx(\"body\", null, __jsx(CONTAINER, null, __jsx(BOX, null, this.state.email ? __jsx(BUTTON, {\n        fontFamily: \"Candara\",\n        variant: \"contained\",\n        color: \"secondary\",\n        onClick: function onClick() {\n          _this4.forgotPassword(_this4.state.email);\n        }\n      }, \"\\u767C\\u9001\\u5BC6\\u78BC\\u91CD\\u8A2D\\u4FE1\") : __jsx(BOX, null, __jsx(Loader, {\n        type: \"ThreeDots\",\n        color: \"#1DB954\",\n        height: 80,\n        width: 80\n      }))))));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport { App as default };","map":null,"metadata":{},"sourceType":"module"}