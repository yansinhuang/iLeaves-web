{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _Date$now from \"@babel/runtime-corejs2/core-js/date/now\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/yan/ezbot-web/app/pages/createLeave.js\";\nvar __jsx = React.createElement;\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n  color: tomato;\\n  border-color: tomato;\\n  width: 80%;\\n\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 80%;\\n  variant: contained;\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 80%;\\n  margin: auto;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  text-align: center;\\n  padding-top: 2em;\\n  padding-bottom: 2em;\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  background: #F7F9FA;\\n  height: auto;\\n  width: 90%;\\n  margin: 5em auto;\\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\\n\\n  label {\\n    font-family: Candara;\\n    color: #1C2833;\\n    font-size: 1.2em;\\n    font-weight: 400;\\n  }\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  color: #F8F9F9;\\n  font-family: Candara;\\n  text-align: center;\\n  margin-bottom:-2em;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 5.5em auto;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\n// Render Prop\nimport React, { Component, useState } from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport icon from '../components/image/icon.png';\nimport Head from 'next/head';\nimport window from 'global'; //import DatePicker from \"react-datepicker\";\n\nimport { Select } from 'material-ui-formik-components/Select';\n\nrequire(\"react-datepicker/dist/react-datepicker.css\");\n\nimport { DatePicker, TimePicker, DateTimePicker, MuiPickersUtilsProvider } from '@material-ui/pickers';\nimport MomentUtils from '@date-io/moment';\nimport DateFnsUtils from '@date-io/date-fns';\nimport LuxonUtils from '@date-io/luxon';\nvar liff = window.liff;\nvar BOX = styled.div(_templateObject());\nvar TITLE = styled.h2(_templateObject2());\nvar CONTAINER = styled.div(_templateObject3());\nvar MYFORM = styled(Form)(_templateObject4());\nvar FIELD = styled(Field)(_templateObject5());\nvar BUTTON = styled(Button)(_templateObject6());\nvar TomatoButton = styled.button(_templateObject7());\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStartDateChange\", function (date) {\n      _this.setState({\n        startDate: date\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleEndDateChange\", function (date) {\n      _this.setState({\n        endDate: date\n      });\n    });\n\n    _this.state = {\n      substitutes: [],\n      userId: null,\n      startDate: _Date$now(),\n      endDate: _Date$now()\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.liffInit();\n    }\n  }, {\n    key: \"liffInit\",\n    value: function liffInit() {\n      var _this2 = this;\n\n      liff.init(function (data) {\n        var userId = data.context.userId;\n        var accessToken = liff.getAccessToken();\n        var URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n        var body = {\n          userId: userId\n        };\n        fetch(URL_CHECKEXIST, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(function (res) {\n          return res.text();\n        }).then(function (result) {\n          if (result) {\n            _this2.setState({\n              userId: userId\n            });\n\n            _this2.lineAuth(userId, accessToken);\n          } else {\n            alert(\"請登入以查看假單\");\n            window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n          }\n        });\n      }, function (err) {\n        alert(\"error\");\n      });\n    }\n  }, {\n    key: \"lineAuth\",\n    value: function lineAuth(userId, accessToken) {\n      var _this3 = this;\n\n      var url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n      var body = {\n        userId: userId,\n        accessToken: accessToken\n      };\n      fetch(url, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: _JSON$stringify(body)\n      }).then(function (res) {\n        return res.json();\n      }).then(function (result) {\n        if (result) {\n          var ubn = result.staff.ubn;\n          var department = result.staff.department;\n          var email = result.staff.email;\n          var idToken = result.token.idToken;\n\n          _this3.setState({\n            Authorization: idToken,\n            ubn: ubn,\n            email: email\n          });\n\n          _this3.getSubstitutes(ubn, department, idToken);\n        } else {\n          alert(\"lineAuth no result\");\n        }\n      })[\"catch\"](function (error) {\n        alert(error.message);\n      });\n    }\n  }, {\n    key: \"getSubstitutes\",\n    value: function getSubstitutes(ubn, department, idToken) {\n      var _this4 = this;\n\n      var URL_GETSUBSTITUTES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/getSubstitutes\";\n      var url = URL_GETSUBSTITUTES + \"?ubn=\".concat(ubn, \"&query=department&value=\").concat(department);\n      var header = {\n        Authorization: idToken\n      }; //document.write(idToken);\n\n      fetch(url, {\n        method: 'get',\n        headers: header\n      }).then(function (res) {\n        return res.json();\n      }).then(function (result) {\n        if (result) {\n          _this4.createOptions(result.list);\n        } else {\n          alert(\"getSubstitutes no result\");\n        }\n      })[\"catch\"](function (error) {\n        alert(error.message);\n      });\n    }\n  }, {\n    key: \"createOptions\",\n    value: function createOptions(arr) {\n      var newList = [];\n\n      for (var i = 0; i < arr.length; i++) {\n        var obj = arr[i];\n        obj.value = _JSON$stringify({\n          \"name\": obj.name,\n          \"email\": obj.email\n        });\n        obj.label = obj.name;\n        delete obj.email;\n        delete obj.name; //push to list\n\n        newList.push(obj);\n\n        if (i == arr.length - 1) {\n          this.setState({\n            substitutes: newList\n          });\n        }\n      }\n    } // tell Basic that options have been changed\n    //substitutes = newList;\n\n  }, {\n    key: \"submitForm\",\n    value: function submitForm(values) {\n      alert(\"submitForm\");\n      var URL_CREATELEAVE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/create\";\n      fetch(URL_CREATELEAVE, {\n        method: 'post',\n        headers: {\n          \"Authorization\": this.state.Authorization,\n          \"ubn\": this.state.ubn,\n          \"userId\": this.state.userId,\n          \"Content-Type\": \"application/json\"\n        },\n        body: _JSON$stringify(values)\n      }).then(function (res) {\n        alert(res);\n        return res.text();\n      }).then(function (result) {\n        if (result) {\n          alert(result);\n          liff.closeWindow();\n        } else {\n          alert(\"submitForm error\"); //window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n        }\n      })[\"catch\"](function (error) {\n        alert(error.message);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this5 = this;\n\n      return __jsx(BOX, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244\n        },\n        __self: this\n      }, __jsx(Head, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      }, __jsx(\"script\", {\n        src: \"https://d.line-scdn.net/liff/1.0/sdk.js\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246\n        },\n        __self: this\n      })), __jsx(\"body\", {\n        style: {\n          background: '#34495E'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248\n        },\n        __self: this\n      }, __jsx(BOX, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }, __jsx(Formik, {\n        initialValues: {\n          startDate: '',\n          endDate: '',\n          leaveType: '',\n          leaveReason: '',\n          substitute: ''\n        },\n        validate: function validate(values) {\n          var errors = {}; // check for startDate\n\n          if (!values.startDate) {\n            errors.startDate = 'Required';\n          } // check for endDate\n\n\n          if (!values.endDate) {\n            errors.endDate = 'Required';\n          } // check for leaveType\n\n\n          if (!values.leaveType) {\n            errors.leaveType = 'Required';\n          } // check for leaveReason\n\n\n          if (!values.leaveReason) {\n            errors.leaveReason = 'Required';\n          } // check for substitute\n\n\n          if (!values.substitute) {\n            errors.substitute = 'Required';\n          }\n\n          return errors;\n        },\n        onSubmit: function onSubmit(values, _ref) {\n          var setSubmitting = _ref.setSubmitting;\n          values.email = _this5.state.email;\n          alert(values);\n\n          _this5.submitForm(values);\n\n          setSubmitting(false);\n          /*\n          setTimeout(() => {\n            this.submitForm(values);\n            setSubmitting(false);\n          }, 400);\n          */\n\n          console.log('submitting', values); //setSubmitting(false);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250\n        },\n        __self: this\n      }, function (_ref2) {\n        var isSubmitting = _ref2.isSubmitting,\n            values = _ref2.values,\n            setFieldValue = _ref2.setFieldValue;\n        return __jsx(CONTAINER, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 296\n          },\n          __self: this\n        }, __jsx(MYFORM, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 297\n          },\n          __self: this\n        }, __jsx(MuiPickersUtilsProvider, {\n          utils: LuxonUtils,\n          width: \"80%\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 298\n          },\n          __self: this\n        }, __jsx(DatePicker, {\n          name: \"startDate\",\n          label: \"\\u958B\\u59CB\\u65E5\\u671F\",\n          value: values.startDate,\n          onChange: function onChange(date) {\n            return setFieldValue('startDate', date);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 299\n          },\n          __self: this\n        })), __jsx(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 301\n          },\n          __self: this\n        }), __jsx(MuiPickersUtilsProvider, {\n          utils: LuxonUtils,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 302\n          },\n          __self: this\n        }, __jsx(DatePicker, {\n          name: \"endDate\",\n          label: \"\\u7D50\\u675F\\u65E5\\u671F\",\n          value: values.endDate,\n          onChange: function onChange(date) {\n            return setFieldValue('endDate', date);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 303\n          },\n          __self: this\n        })), __jsx(FIELD, {\n          type: \"leaveType\",\n          name: \"leaveType\",\n          label: \"\\u5047\\u52E4\\u985E\\u5225\",\n          options: [{\n            value: '病假',\n            label: '病假'\n          }, {\n            value: '事假',\n            label: '事假'\n          }, {\n            value: '喪假',\n            label: '喪假'\n          }, {\n            value: '公假',\n            label: '公假'\n          }, {\n            value: '生理假',\n            label: '生理假'\n          }, {\n            value: '婚假',\n            label: '婚假'\n          }, {\n            value: '產假',\n            label: '產假'\n          }, {\n            value: '陪產假',\n            label: '陪產假'\n          }],\n          component: Select,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 306\n          },\n          __self: this\n        }), __jsx(FIELD, {\n          type: \"leaveReason\",\n          name: \"leaveReason\",\n          label: \"\\u5047\\u52E4\\u4E8B\\u7531\",\n          component: TextField,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 322\n          },\n          __self: this\n        }), __jsx(FIELD, {\n          type: \"substitute\",\n          name: \"substitute\",\n          label: \"\\u8077\\u52D9\\u4EE3\\u7406\\u4EBA\",\n          options: _this5.state.substitutes,\n          component: Select,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 323\n          },\n          __self: this\n        }), __jsx(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 330\n          },\n          __self: this\n        }), __jsx(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 331\n          },\n          __self: this\n        }), __jsx(BUTTON, {\n          type: \"submit\",\n          fontFamily: \"Candara\",\n          variant: \"contained\",\n          color: \"secondary\",\n          disabled: isSubmitting,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 332\n          },\n          __self: this\n        }, \"\\u9001\\u51FA\\u5047\\u55AE\")));\n      }))));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport { App as default };","map":{"version":3,"sources":["/Users/yan/ezbot-web/app/pages/createLeave.js"],"names":["React","Component","useState","styled","Formik","Form","Field","ErrorMessage","TextField","fetch","Button","Box","icon","Head","window","Select","require","DatePicker","TimePicker","DateTimePicker","MuiPickersUtilsProvider","MomentUtils","DateFnsUtils","LuxonUtils","liff","BOX","div","TITLE","h2","CONTAINER","MYFORM","FIELD","BUTTON","TomatoButton","button","App","props","date","setState","startDate","endDate","state","substitutes","userId","liffInit","init","data","context","accessToken","getAccessToken","URL_CHECKEXIST","body","method","headers","then","res","text","result","lineAuth","alert","location","replace","err","url","json","ubn","staff","department","email","idToken","token","Authorization","getSubstitutes","error","message","URL_GETSUBSTITUTES","header","createOptions","list","arr","newList","i","length","obj","value","name","label","push","values","URL_CREATELEAVE","closeWindow","background","leaveType","leaveReason","substitute","errors","setSubmitting","submitForm","console","log","isSubmitting","setFieldValue"],"mappings":"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","sourcesContent":["// Render Prop\nimport React, { Component, useState } from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport icon from '../components/image/icon.png';\nimport Head from 'next/head';\nimport window from 'global';\n//import DatePicker from \"react-datepicker\";\nimport { Select } from 'material-ui-formik-components/Select'\nrequire( \"react-datepicker/dist/react-datepicker.css\");\n\nimport {\n  DatePicker,\n  TimePicker,\n  DateTimePicker,\n  MuiPickersUtilsProvider,\n} from '@material-ui/pickers';\nimport MomentUtils from '@date-io/moment';\nimport DateFnsUtils from '@date-io/date-fns';\nimport LuxonUtils from '@date-io/luxon';\n\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\nconst TITLE = styled.h2`\n  color: #F8F9F9;\n  font-family: Candara;\n  text-align: center;\n  margin-bottom:-2em;\n`;\nconst CONTAINER = styled.div`\n  background: #F7F9FA;\n  height: auto;\n  width: 90%;\n  margin: 5em auto;\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\n\n  label {\n    font-family: Candara;\n    color: #1C2833;\n    font-size: 1.2em;\n    font-weight: 400;\n  }\n`;\nconst MYFORM = styled(Form)`\n  text-align: center;\n  padding-top: 2em;\n  padding-bottom: 2em;\n`;\nconst FIELD = styled(Field)`\n  width: 80%;\n  margin: auto;\n`;\nconst BUTTON = styled(Button)`\n  width: 80%;\n  variant: contained;\n`;\nconst TomatoButton = styled.button`\n  color: tomato;\n  border-color: tomato;\n  width: 80%;\n`;\n\n\nexport default class App extends Component {\n    constructor(props) {\n      super(props);\n  \n      this.state = {\n        substitutes : [],\n        userId : null,\n        startDate: Date.now(),\n        endDate: Date.now()\n      };\n    }\n\n    handleStartDateChange = (date) => {\n      this.setState({ startDate: date });\n    };\n\n    handleEndDateChange = (date) => {\n      this.setState({ endDate: date });\n    };\n  \n    componentDidMount() {\n      this.liffInit();\n    }\n  \n    liffInit() {\n      liff.init(data => {\n        const userId = data.context.userId;\n        const accessToken = liff.getAccessToken();\n        const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n        const body = {\n          userId: userId\n        };\n        fetch(URL_CHECKEXIST, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(body)\n        }).then((res) => {\n          return res.text();\n        }).then(result => {\n          if (result) {\n              this.setState({\n                userId: userId\n            })\n            this.lineAuth(userId, accessToken);\n          } else {\n              alert(\"請登入以查看假單\");\n              window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n          }\n        })\n        \n    \n      }, err => {\n        alert(\"error\");\n      });\n    }\n    \n    lineAuth (userId, accessToken)  {\n      const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n      const body = {\n          userId: userId,\n          accessToken: accessToken\n        };\n      fetch(url, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(body)\n        }).then((res) => {\n          return res.json();\n        }).then(result => {\n          if (result) {\n            const ubn = result.staff.ubn;\n            const department = result.staff.department;\n            const email = result.staff.email;\n            const idToken = result.token.idToken;\n            this.setState({\n              Authorization: idToken,\n              ubn: ubn,\n              email: email\n          })\n            this.getSubstitutes(ubn, department, idToken);\n          } else {\n              alert(\"lineAuth no result\");\n  \n          }\n        }).catch(function (error) {\n          alert(error.message);\n        })\n    }\n  \n    getSubstitutes (ubn, department, idToken) {\n        const URL_GETSUBSTITUTES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/getSubstitutes\";\n        const url = URL_GETSUBSTITUTES + `?ubn=${ubn}&query=department&value=${department}`; \n        const header = {\n            Authorization: idToken\n          };\n        //document.write(idToken);\n        fetch(url, {\n            method: 'get',\n            headers: header\n          }).then((res) => {\n            return res.json();\n          }).then(result => {\n            if (result) {\n              this.createOptions(result.list)\n            } else {\n                alert(\"getSubstitutes no result\");\n      \n            }\n          }).catch(function (error) {\n            alert(error.message);\n          })\n      }\n  \n    createOptions (arr) {\n    var newList = [];\n    for (var i = 0; i < arr.length; i++) {\n        var obj = arr[i];\n        obj.value = JSON.stringify({\n          \"name\": obj.name,\n          \"email\": obj.email\n        });\n        obj.label = obj.name;\n        delete obj.email;\n        delete obj.name;\n        //push to list\n        newList.push(obj);\n        \n        if(i == arr.length-1) {\n          this.setState({\n              substitutes: newList\n          })\n        }\n        }\n    }\n    // tell Basic that options have been changed\n    //substitutes = newList;\n    \n    submitForm (values) {\n      alert(\"submitForm\");\n      const URL_CREATELEAVE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/create\";\n      fetch(URL_CREATELEAVE, {\n        method: 'post',\n        headers: {\n          \"Authorization\": this.state.Authorization,\n          \"ubn\": this.state.ubn,\n          \"userId\": this.state.userId,\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(values)\n      }).then((res) => {\n        alert(res);\n        return res.text();\n      }).then(result => {\n        if (result) {\n          alert(result);\n          liff.closeWindow();\n        } else {\n            alert(\"submitForm error\");\n            //window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      })\n    }\n  \n  \n    \n    \n    render() {\n      return (\n        <BOX>\n    <Head>\n      <script src=\"https://d.line-scdn.net/liff/1.0/sdk.js\"></script>\n    </Head>\n    <body style={{background:'#34495E'}}>\n      <BOX>\n        <Formik\n          initialValues={{ startDate: '', endDate: '', leaveType: '', leaveReason: '', substitute: '' }}\n          validate={values => {\n            const errors = {};\n            // check for startDate\n            if (!values.startDate) {\n              errors.startDate = 'Required';\n            }\n            // check for endDate\n            if (!values.endDate) {\n              errors.endDate = 'Required';\n            } \n            // check for leaveType\n            if (!values.leaveType) {\n              errors.leaveType = 'Required';\n            }\n            // check for leaveReason\n            if (!values.leaveReason) {\n                errors.leaveReason = 'Required';\n            }\n            \n            // check for substitute\n            if (!values.substitute) {\n                errors.substitute = 'Required';\n            }\n            return errors;\n            \n          }}\n          onSubmit={(values, { setSubmitting }) => {\n            values.email = this.state.email;\n            alert(values);\n            this.submitForm(values);\n              setSubmitting(false);\n            \n            /*\n            setTimeout(() => {\n              this.submitForm(values);\n              setSubmitting(false);\n            }, 400);\n            */\n            \n            console.log('submitting', values);\n            //setSubmitting(false);\n          }}\n        >\n          {({ isSubmitting, values, setFieldValue}) => (\n            <CONTAINER>\n            <MYFORM>\n            <MuiPickersUtilsProvider utils={LuxonUtils} width = \"80%\">\n              <DatePicker name=\"startDate\" label = \"開始日期\" value={values.startDate} onChange={date => setFieldValue('startDate', date)}/>\n            </MuiPickersUtilsProvider>\n            <br></br>\n            <MuiPickersUtilsProvider utils={LuxonUtils}>\n              <DatePicker name=\"endDate\" label = \"結束日期\" value={values.endDate} onChange={date => setFieldValue('endDate', date)} />\n            </MuiPickersUtilsProvider>\n\n              <FIELD\n                type=\"leaveType\"\n                name=\"leaveType\"\n                label=\"假勤類別\"\n                options={[\n                  { value: '病假', label: '病假' },\n                  { value: '事假', label: '事假' },\n                  { value: '喪假', label: '喪假' },\n                  { value: '公假', label: '公假' },\n                  { value: '生理假', label: '生理假' },\n                  { value: '婚假', label: '婚假' },\n                  { value: '產假', label: '產假' },\n                  { value: '陪產假', label: '陪產假' }\n                ]}\n                component={Select}\n              />\n              <FIELD type=\"leaveReason\" name=\"leaveReason\" label = \"假勤事由\" component = { TextField }/>\n              <FIELD\n                type=\"substitute\"\n                name=\"substitute\"\n                label=\"職務代理人\"\n                options={this.state.substitutes}\n                component={Select}\n              />\n              <br></br>\n              <br></br>\n              <BUTTON\n              type=\"submit\"\n              fontFamily= \"Candara\"\n              variant=\"contained\"\n              color=\"secondary\"\n              disabled={isSubmitting}\n            >\n              送出假單\n            </BUTTON>\n            </MYFORM>\n            </CONTAINER>\n          )}\n        </Formik>\n      </BOX>\n    </body>\n    </BOX>   \n      );\n    }\n  }"]},"metadata":{},"sourceType":"module"}