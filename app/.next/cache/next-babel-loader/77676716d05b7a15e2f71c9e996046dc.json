{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nvar _jsxFileName = \"/Users/yan/ezbot-web/app/pages/reject_sub.js\";\nvar __jsx = React.createElement;\n// Render Prop\nimport React, { Component } from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport Head from 'next/head';\nimport window from 'global';\nimport { Select } from 'material-ui-formik-components/Select';\nimport { DatePicker, MuiPickersUtilsProvider } from '@material-ui/pickers';\nimport LuxonUtils from '@date-io/luxon';\nimport Loader from 'react-loader-spinner';\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\n\nrequire(\"react-datepicker/dist/react-datepicker.css\");\n\nvar dateFormat = require('dateformat');\n\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n  width:100%;\n  height:40vh;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n`;\nconst LOADERBOX = styled.div`\n  display: table;\n  margin: 0 auto;\n\n`;\nconst TITLE = styled.h2`\n  color: #F8F9F9;\n  font-family: Candara;\n  text-align: center;\n  margin-bottom:-2em;\n`;\nconst CONTAINER = styled.div`\n  background: #F7F9FA;\n  height: 70vh;\n  width: 80vw;\n  margin: 5em auto;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\n\n  label {\n    font-family: Candara;\n    color: #1C2833;\n    font-size: 1.2em;\n    font-weight: 400;\n  }\n`;\nconst MYFORM = styled(Form)`\n  text-align: center;\n  padding-top: 2em;\n  padding-bottom: 2em;\n`;\nconst FIELD = styled(Field)`\n  width: 70vw;\n  margin: auto;\n`;\nconst BUTTON = styled(Button)`\n  width: 70vw;\n  variant: contained;\n`;\nconst TomatoButton = styled.button`\n  color: tomato;\n  border-color: tomato;\n  width: 80%;\n`;\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      userId: null,\n      Authorization: null,\n      ubn: null,\n      leaveId: null,\n      leave: null,\n      status: null\n    };\n  }\n\n  componentDidMount() {\n    this.getQuery();\n    this.liffInit();\n  }\n\n  getQuery() {\n    let urlParams = new URLSearchParams(window.location.search);\n    urlParams = urlParams.toString().split(\"&\");\n    const ubn = urlParams[0].split(\"=\")[1];\n    const leaveId = urlParams[1].split(\"=\")[1];\n    this.setState({\n      leaveId: leaveId\n    });\n  }\n\n  liffInit() {\n    try {\n      liff.init(data => {\n        const userId = data.context.userId;\n        const accessToken = liff.getAccessToken();\n        const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n        const body = {\n          userId: userId\n        };\n        fetch(URL_CHECKEXIST, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(res => {\n          return res.text();\n        }).then(result => {\n          if (result) {\n            this.setState({\n              userId: userId\n            });\n            this.lineAuth(userId, accessToken);\n          } else {\n            alert(\"請登入以查看假單\");\n            window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n          }\n        });\n      }, err => {\n        alert(err.message);\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  lineAuth(userId, accessToken) {\n    try {\n      const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n      const body = {\n        userId: userId,\n        accessToken: accessToken\n      };\n      fetch(url, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: _JSON$stringify(body)\n      }).then(res => {\n        return res.json();\n      }).then(result => {\n        if (result) {\n          const ubn = result.staff.ubn; //const department = result.staff.department;\n          //const email = result.staff.email;\n\n          const idToken = result.token.idToken;\n          this.setState({\n            Authorization: idToken,\n            ubn: ubn\n          });\n          this.checkStatus(idToken, ubn, this.state.leaveId);\n        } else {\n          alert(\"lineAuth no result\");\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  checkStatus(Authorization, ubn, id) {\n    try {\n      const URL_GETLEAVE = `https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/target?ubn=${ubn}&id=${id}`;\n      fetch(URL_GETLEAVE, {\n        method: 'get',\n        headers: {\n          Authorization: Authorization\n        }\n      }).then(res => {\n        if (res.ok) {\n          return res.json();\n        }\n\n        throw new Error('checkStatus response was not ok.');\n      }).then(result => {\n        if (result.status != \"等待簽核\") {\n          //alert(\"此張假單已簽核\");\n          this.setState({\n            status: \"signed\"\n          }); //window.location.replace(\"https://teddybear-dev.firebaseapp.com/alreadyApproved/\");\n        } else {\n          this.setState({\n            status: \"not signed\"\n          });\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  updateLeave(values) {\n    try {\n      const URL_UPDATELEAVE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/update\";\n      fetch(URL_UPDATELEAVE, {\n        method: 'post',\n        headers: {\n          \"Authorization\": this.state.Authorization,\n          \"Content-Type\": \"application/json\"\n        },\n        body: _JSON$stringify(values)\n      }).then(res => {\n        if (res.ok) {\n          return res.json();\n        }\n\n        throw new Error('updateLeave response was not ok.');\n      }).then(result => {\n        this.setState({\n          leave: result\n        });\n        const messages = [{\n          type: \"text\",\n          text: \"拒絕成功\"\n        }];\n        this.pushMessage(this.state.userId, messages);\n        const substituteInfo = JSON.parse(result.substitute);\n        const messages_self = {\n          \"type\": \"flex\",\n          \"altText\": \"代理人已拒絕假單\",\n          \"contents\": {\n            \"type\": \"bubble\",\n            \"styles\": {},\n            \"body\": {\n              \"type\": \"box\",\n              \"layout\": \"vertical\",\n              \"contents\": [{\n                \"type\": \"text\",\n                \"text\": \"代理人\",\n                \"weight\": \"bold\",\n                \"color\": \"#1DB446\",\n                \"size\": \"sm\"\n              }, {\n                \"type\": \"text\",\n                \"text\": \"已拒絕假單\",\n                \"weight\": \"bold\",\n                \"size\": \"xxl\",\n                \"margin\": \"md\"\n              }, {\n                \"type\": \"separator\",\n                \"margin\": \"xxl\"\n              }, {\n                \"type\": \"box\",\n                \"layout\": \"vertical\",\n                \"margin\": \"xxl\",\n                \"spacing\": \"sm\",\n                \"contents\": [{\n                  \"type\": \"box\",\n                  \"layout\": \"horizontal\",\n                  \"contents\": [{\n                    \"type\": \"text\",\n                    \"text\": \"開始日期\",\n                    \"size\": \"sm\",\n                    \"color\": \"#555555\"\n                  }, {\n                    \"type\": \"text\",\n                    \"text\": result.startDate,\n                    \"size\": \"sm\",\n                    \"color\": \"#111111\",\n                    \"align\": \"end\"\n                  }]\n                }, {\n                  \"type\": \"box\",\n                  \"layout\": \"horizontal\",\n                  \"contents\": [{\n                    \"type\": \"text\",\n                    \"text\": \"結束日期\",\n                    \"size\": \"sm\",\n                    \"color\": \"#555555\"\n                  }, {\n                    \"type\": \"text\",\n                    \"text\": result.endDate,\n                    \"size\": \"sm\",\n                    \"color\": \"#111111\",\n                    \"align\": \"end\"\n                  }]\n                }, {\n                  \"type\": \"separator\",\n                  \"margin\": \"xxl\"\n                }, {\n                  \"type\": \"box\",\n                  \"layout\": \"horizontal\",\n                  \"margin\": \"xxl\",\n                  \"contents\": [{\n                    \"type\": \"text\",\n                    \"text\": \"假別\",\n                    \"size\": \"sm\",\n                    \"color\": \"#555555\"\n                  }, {\n                    \"type\": \"text\",\n                    \"text\": result.leaveType,\n                    \"size\": \"sm\",\n                    \"color\": \"#111111\",\n                    \"align\": \"end\"\n                  }]\n                }, {\n                  \"type\": \"box\",\n                  \"layout\": \"horizontal\",\n                  \"contents\": [{\n                    \"type\": \"text\",\n                    \"text\": \"請假原因\",\n                    \"size\": \"sm\",\n                    \"color\": \"#555555\"\n                  }, {\n                    \"type\": \"text\",\n                    \"text\": result.leaveReason,\n                    \"size\": \"sm\",\n                    \"color\": \"#111111\",\n                    \"align\": \"end\"\n                  }]\n                }, {\n                  \"type\": \"box\",\n                  \"layout\": \"horizontal\",\n                  \"contents\": [{\n                    \"type\": \"text\",\n                    \"text\": \"代理人\",\n                    \"size\": \"sm\",\n                    \"color\": \"#555555\"\n                  }, {\n                    \"type\": \"text\",\n                    \"text\": substituteInfo.name,\n                    \"size\": \"sm\",\n                    \"color\": \"#111111\",\n                    \"align\": \"end\"\n                  }]\n                }]\n              }, {\n                \"type\": \"separator\",\n                \"margin\": \"xxl\"\n              }, {\n                \"type\": \"box\",\n                \"layout\": \"horizontal\",\n                \"margin\": \"md\",\n                \"contents\": [{\n                  \"type\": \"text\",\n                  \"text\": \"簽核狀態\",\n                  \"size\": \"xs\",\n                  \"color\": \"#555555\"\n                }, {\n                  \"type\": \"text\",\n                  \"text\": \"拒絕(代理人)\",\n                  \"color\": \"#ff0000\",\n                  \"size\": \"xs\",\n                  \"align\": \"end\"\n                }]\n              }, {\n                \"type\": \"box\",\n                \"layout\": \"horizontal\",\n                \"margin\": \"md\",\n                \"contents\": [{\n                  \"type\": \"text\",\n                  \"text\": \"拒絕原因\",\n                  \"size\": \"xs\",\n                  \"color\": \"#555555\"\n                }, {\n                  \"type\": \"text\",\n                  \"text\": result.rejectReason,\n                  \"color\": \"#111111\",\n                  \"size\": \"xs\",\n                  \"align\": \"end\"\n                }]\n              }]\n            }\n          }\n        };\n        this.pushMessage(this.state.userId, [messages_self]);\n        liff.closeWindow();\n      }).catch(function (error) {\n        alert(error.message);\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  pushMessage(userId, messages) {\n    try {\n      const URL_PUSHMESSAGE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/message/pushMessage\";\n      const body = {\n        userId: userId,\n        messages: messages\n      };\n      fetch(URL_PUSHMESSAGE, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: _JSON$stringify(body)\n      }).then(res => {\n        if (res.ok) {\n          return res.json();\n        }\n\n        throw new Error('pushMessage response was not ok.');\n      }).then(result => {//liff.closeWindow();\n      }).catch(function (error) {\n        alert(error.message);\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  render() {\n    return __jsx(BOX, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 467\n      },\n      __self: this\n    }, __jsx(Head, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 468\n      },\n      __self: this\n    }, __jsx(\"script\", {\n      src: \"https://d.line-scdn.net/liff/1.0/sdk.js\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 469\n      },\n      __self: this\n    })), __jsx(\"body\", {\n      style: {\n        background: '#34495E'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 471\n      },\n      __self: this\n    }, __jsx(BOX, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 472\n      },\n      __self: this\n    }, __jsx(Formik, {\n      initialValues: {\n        rejectReason: ''\n      },\n      validate: values => {\n        const errors = {}; // check for rejectReason\n\n        if (!values.rejectReason) {\n          errors.rejectReason = 'Required';\n        }\n\n        return errors;\n      },\n      onSubmit: (values, {\n        setSubmitting\n      }) => {\n        values.status = \"拒絕 (代理人)\";\n        values.leaveId = this.state.leaveId;\n        values.ubn = this.state.ubn;\n        this.updateLeave(values);\n        setSubmitting(false); //console.log('submitting', values);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 473\n      },\n      __self: this\n    }, ({\n      isSubmitting,\n      values,\n      setFieldValue\n    }) => __jsx(CONTAINER, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 493\n      },\n      __self: this\n    }, this.state.userId && this.state.Authorization && this.state.ubn && this.state.leaveId && this.state.status == \"not signed\" ? __jsx(MYFORM, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 495\n      },\n      __self: this\n    }, __jsx(FIELD, {\n      type: \"rejectReason\",\n      name: \"rejectReason\",\n      label: \"\\u62D2\\u7D55\\u539F\\u56E0\",\n      component: TextField,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 496\n      },\n      __self: this\n    }), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 503\n      },\n      __self: this\n    }), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 504\n      },\n      __self: this\n    }), __jsx(BUTTON, {\n      type: \"submit\",\n      fontFamily: \"Candara\",\n      variant: \"contained\",\n      color: \"secondary\",\n      disabled: isSubmitting,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 506\n      },\n      __self: this\n    }, \"\\u9001\\u51FA\")) : this.state.userId && this.state.Authorization && this.state.ubn && this.state.leaveId && this.state.status == \"signed\" ? __jsx(MYFORM, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 519\n      },\n      __self: this\n    }, __jsx(\"label\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 520\n      },\n      __self: this\n    }, \"\\u6B64\\u5F35\\u5047\\u55AE\\u5DF2\\u7C3D\\u6838\")) : __jsx(LOADERBOX, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 523\n      },\n      __self: this\n    }, __jsx(Loader, {\n      type: \"ThreeDots\",\n      color: \"#f50057\",\n      height: 80,\n      width: 80,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 524\n      },\n      __self: this\n    })))))));\n  }\n\n}","map":{"version":3,"sources":["/Users/yan/ezbot-web/app/pages/reject_sub.js"],"names":["React","Component","styled","Formik","Form","Field","ErrorMessage","TextField","fetch","Button","Box","Head","window","Select","DatePicker","MuiPickersUtilsProvider","LuxonUtils","Loader","require","dateFormat","liff","BOX","div","LOADERBOX","TITLE","h2","CONTAINER","MYFORM","FIELD","BUTTON","TomatoButton","button","App","constructor","props","state","userId","Authorization","ubn","leaveId","leave","status","componentDidMount","getQuery","liffInit","urlParams","URLSearchParams","location","search","toString","split","setState","init","data","context","accessToken","getAccessToken","URL_CHECKEXIST","body","method","headers","then","res","text","result","lineAuth","alert","replace","err","message","next","url","json","staff","idToken","token","checkStatus","catch","error","id","URL_GETLEAVE","ok","Error","updateLeave","values","URL_UPDATELEAVE","messages","type","pushMessage","substituteInfo","JSON","parse","substitute","messages_self","startDate","endDate","leaveType","leaveReason","name","rejectReason","closeWindow","URL_PUSHMESSAGE","render","background","errors","setSubmitting","isSubmitting","setFieldValue"],"mappings":"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","sourcesContent":["// Render Prop\nimport React, { Component } from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport Head from 'next/head';\nimport window from 'global';\nimport { Select } from 'material-ui-formik-components/Select';\nimport {\n  DatePicker,\n  MuiPickersUtilsProvider,\n} from '@material-ui/pickers';\nimport LuxonUtils from '@date-io/luxon';\nimport Loader from 'react-loader-spinner'\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\"\nrequire( \"react-datepicker/dist/react-datepicker.css\");\nvar dateFormat = require('dateformat');\n\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n  width:100%;\n  height:40vh;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n`;\nconst LOADERBOX = styled.div`\n  display: table;\n  margin: 0 auto;\n\n`;\nconst TITLE = styled.h2`\n  color: #F8F9F9;\n  font-family: Candara;\n  text-align: center;\n  margin-bottom:-2em;\n`;\nconst CONTAINER = styled.div`\n  background: #F7F9FA;\n  height: 70vh;\n  width: 80vw;\n  margin: 5em auto;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\n\n  label {\n    font-family: Candara;\n    color: #1C2833;\n    font-size: 1.2em;\n    font-weight: 400;\n  }\n`;\nconst MYFORM = styled(Form)`\n  text-align: center;\n  padding-top: 2em;\n  padding-bottom: 2em;\n`;\nconst FIELD = styled(Field)`\n  width: 70vw;\n  margin: auto;\n`;\nconst BUTTON = styled(Button)`\n  width: 70vw;\n  variant: contained;\n`;\nconst TomatoButton = styled.button`\n  color: tomato;\n  border-color: tomato;\n  width: 80%;\n`;\n\n\nexport default class App extends Component {\n    constructor(props) {\n      super(props);\n  \n      this.state = {\n        userId : null,\n        Authorization: null,\n        ubn: null,\n        leaveId: null,\n        leave: null,\n        status: null\n      };\n    }\n\n    componentDidMount() {\n      this.getQuery();\n      this.liffInit();\n    }\n\n    getQuery() {\n        let urlParams = new URLSearchParams(window.location.search);\n        urlParams = urlParams.toString().split(\"&\");\n        const ubn = urlParams[0].split(\"=\")[1];\n        const leaveId = urlParams[1].split(\"=\")[1];\n        this.setState({\n            leaveId: leaveId\n        })\n    }\n  \n    liffInit() {\n      try {\n        liff.init(data => {\n            const userId = data.context.userId;\n            const accessToken = liff.getAccessToken();\n            const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n            const body = {\n                userId: userId\n            };\n            fetch(URL_CHECKEXIST, {\n                method: 'post',\n                headers: {\n                'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(body)\n            }).then((res) => {\n                return res.text();\n            }).then(result => {\n                if (result) {\n                    this.setState({\n                        userId: userId\n                    })\n                    this.lineAuth(userId, accessToken);\n                } else {\n                    alert(\"請登入以查看假單\");\n                    window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n                }\n            })\n        }, err => {\n            alert(err.message);\n        });\n      } catch (err) {\n            next(err);\n      }\n    }\n    \n    lineAuth (userId, accessToken)  {\n      try {\n        const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n        const body = {\n            userId: userId,\n            accessToken: accessToken\n        };\n        fetch(url, {\n            method: 'post',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(body)\n        }).then((res) => {\n            return res.json();\n        }).then(result => {\n            if (result) {\n                const ubn = result.staff.ubn;\n                //const department = result.staff.department;\n                //const email = result.staff.email;\n                const idToken = result.token.idToken;\n                this.setState({\n                    Authorization: idToken,\n                    ubn: ubn\n                })\n                this.checkStatus(idToken, ubn, this.state.leaveId);\n            } else {\n                alert(\"lineAuth no result\");\n            }\n        }).catch(function (error) {\n            alert(error.message);\n        })\n      } catch (err) {\n            next(err);\n      }\n    }\n\n    checkStatus (Authorization, ubn, id) {\n        try {\n            const URL_GETLEAVE = `https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/target?ubn=${ubn}&id=${id}`;\n            fetch(URL_GETLEAVE, {\n                method: 'get',\n                headers: {\n                    Authorization: Authorization\n                }\n            }).then((res) => {\n                if(res.ok) {\n                return res.json();  \n                }\n                throw new Error('checkStatus response was not ok.');\n            }).then(result => {\n                if (result.status != \"等待簽核\") {\n                    //alert(\"此張假單已簽核\");\n                    this.setState({\n                      status: \"signed\"\n                    })\n                    //window.location.replace(\"https://teddybear-dev.firebaseapp.com/alreadyApproved/\");\n                } else {\n                  this.setState({\n                    status: \"not signed\"\n                  })\n                }\n            }).catch(function (error) {\n                alert(error.message);\n            })\n        } catch (err) {\n            next(err);\n        }\n    }\n    \n    updateLeave (values) {\n      try {\n        const URL_UPDATELEAVE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/update\";\n        fetch(URL_UPDATELEAVE, {\n            method: 'post',\n            headers: {\n                \"Authorization\": this.state.Authorization,\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(values)\n        }).then((res) => {\n            if(res.ok) {\n                return res.json();  \n            }\n            throw new Error('updateLeave response was not ok.');\n        }).then(result => {\n            this.setState({\n                leave: result\n            })\n            const messages = [\n                {\n                type: \"text\",\n                text: \"拒絕成功\"\n                }\n            ];\n            this.pushMessage(this.state.userId, messages);\n            const substituteInfo = JSON.parse(result.substitute);\n            const messages_self = {\n                \"type\": \"flex\",\n                \"altText\": \"代理人已拒絕假單\",\n                \"contents\": {\n                    \"type\": \"bubble\",\n                    \"styles\": {\n\n                    },\n                    \"body\": {\n                    \"type\": \"box\",\n                    \"layout\": \"vertical\",\n                    \"contents\": [\n                        {\n                        \"type\": \"text\",\n                        \"text\": \"代理人\",\n                        \"weight\": \"bold\",\n                        \"color\": \"#1DB446\",\n                        \"size\": \"sm\"\n                        },\n                        {\n                        \"type\": \"text\",\n                        \"text\": \"已拒絕假單\",\n                        \"weight\": \"bold\",\n                        \"size\": \"xxl\",\n                        \"margin\": \"md\"\n                        },\n                        {\n                        \"type\": \"separator\",\n                        \"margin\": \"xxl\"\n                        },\n                        {\n                        \"type\": \"box\",\n                        \"layout\": \"vertical\",\n                        \"margin\": \"xxl\",\n                        \"spacing\": \"sm\",\n                        \"contents\": [\n                            {\n                            \"type\": \"box\",\n                            \"layout\": \"horizontal\",\n                            \"contents\": [\n                                {\n                                \"type\": \"text\",\n                                \"text\": \"開始日期\",\n                                \"size\": \"sm\",\n                                \"color\": \"#555555\"\n                                },\n                                {\n                                \"type\": \"text\",\n                                \"text\": result.startDate,\n                                \"size\": \"sm\",\n                                \"color\": \"#111111\",\n                                \"align\": \"end\"\n                                }\n                            ]\n                            },\n                            {\n                            \"type\": \"box\",\n                            \"layout\": \"horizontal\",\n                            \"contents\": [\n                                {\n                                \"type\": \"text\",\n                                \"text\": \"結束日期\",\n                                \"size\": \"sm\",\n                                \"color\": \"#555555\"\n                                },\n                                {\n                                \"type\": \"text\",\n                                \"text\": result.endDate,\n                                \"size\": \"sm\",\n                                \"color\": \"#111111\",\n                                \"align\": \"end\"\n                                }\n                            ]\n                            },\n                            {\n                            \"type\": \"separator\",\n                            \"margin\": \"xxl\"\n                            },\n                            {\n                            \"type\": \"box\",\n                            \"layout\": \"horizontal\",\n                            \"margin\": \"xxl\",\n                            \"contents\": [\n                                {\n                                \"type\": \"text\",\n                                \"text\": \"假別\",\n                                \"size\": \"sm\",\n                                \"color\": \"#555555\"\n                                },\n                                {\n                                \"type\": \"text\",\n                                \"text\": result.leaveType,\n                                \"size\": \"sm\",\n                                \"color\": \"#111111\",\n                                \"align\": \"end\"\n                                }\n                            ]\n                            },\n                            {\n                            \"type\": \"box\",\n                            \"layout\": \"horizontal\",\n                            \"contents\": [\n                                {\n                                \"type\": \"text\",\n                                \"text\": \"請假原因\",\n                                \"size\": \"sm\",\n                                \"color\": \"#555555\"\n                                },\n                                {\n                                \"type\": \"text\",\n                                \"text\": result.leaveReason,\n                                \"size\": \"sm\",\n                                \"color\": \"#111111\",\n                                \"align\": \"end\"\n                                }\n                            ]\n                            },\n                            {\n                            \"type\": \"box\",\n                            \"layout\": \"horizontal\",\n                            \"contents\": [\n                                {\n                                \"type\": \"text\",\n                                \"text\": \"代理人\",\n                                \"size\": \"sm\",\n                                \"color\": \"#555555\"\n                                },\n                                {\n                                \"type\": \"text\",\n                                \"text\": substituteInfo.name,\n                                \"size\": \"sm\",\n                                \"color\": \"#111111\",\n                                \"align\": \"end\"\n                                }\n                            ]\n                            }\n                        ]\n                        },\n                        {\n                        \"type\": \"separator\",\n                        \"margin\": \"xxl\"\n                        },\n                        {\n                        \"type\": \"box\",\n                        \"layout\": \"horizontal\",\n                        \"margin\": \"md\",\n                        \"contents\": [\n                            {\n                            \"type\": \"text\",\n                            \"text\": \"簽核狀態\",\n                            \"size\": \"xs\",\n                            \"color\": \"#555555\"\n                            },\n                            {\n                            \"type\": \"text\",\n                            \"text\": \"拒絕(代理人)\",\n                            \"color\": \"#ff0000\",\n                            \"size\": \"xs\",\n                            \"align\": \"end\"\n                            }\n                        ]\n                        },\n                        {\n                        \"type\": \"box\",\n                        \"layout\": \"horizontal\",\n                        \"margin\": \"md\",\n                        \"contents\": [\n                            {\n                            \"type\": \"text\",\n                            \"text\": \"拒絕原因\",\n                            \"size\": \"xs\",\n                            \"color\": \"#555555\"\n                            },\n                            {\n                            \"type\": \"text\",\n                            \"text\": result.rejectReason,\n                            \"color\": \"#111111\",\n                            \"size\": \"xs\",\n                            \"align\": \"end\"\n                            }\n                        ]\n                        }\n                    ]\n                    }\n                }\n            };\n            this.pushMessage(this.state.userId, [messages_self]);\n            liff.closeWindow();\n        }).catch(function (error) {\n            alert(error.message);\n        })\n      } catch (err) {\n            next(err);\n      }\n    }\n\n    pushMessage (userId, messages) {\n        try {\n            const URL_PUSHMESSAGE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/message/pushMessage\";\n            const body = {\n                userId: userId,\n                messages: messages\n            }\n            fetch(URL_PUSHMESSAGE, {\n                method: 'post',\n                headers: {\n                'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(body)\n            }).then((res) => {\n                if(res.ok) {\n                return res.json();  \n                }\n                throw new Error('pushMessage response was not ok.');\n            }).then(result => {\n                //liff.closeWindow();\n            }).catch(function (error) {\n                alert(error.message);\n            })\n        } catch (err) {\n            next(err);\n        }\n    }\n  \n    render() {\n      return (\n        <BOX>\n          <Head>\n            <script src=\"https://d.line-scdn.net/liff/1.0/sdk.js\"></script>\n          </Head>\n          <body style={{background:'#34495E'}}>\n            <BOX>\n              <Formik\n                initialValues={{ rejectReason: '' }}\n                validate={values => {\n                  const errors = {};\n                  // check for rejectReason\n                  if (!values.rejectReason) {\n                      errors.rejectReason = 'Required';\n                  }                 \n                  return errors;                 \n                }}\n                onSubmit={(values, { setSubmitting }) => {\n                  values.status = \"拒絕 (代理人)\";\n                  values.leaveId = this.state.leaveId;\n                  values.ubn = this.state.ubn;\n                  this.updateLeave(values);\n                    setSubmitting(false);\n                  //console.log('submitting', values);\n                }}\n              >\n              {({ isSubmitting, values, setFieldValue}) => (\n                <CONTAINER>\n                  {this.state.userId && this.state.Authorization && this.state.ubn && this.state.leaveId && (this.state.status == \"not signed\") ?\n                    <MYFORM>\n                      <FIELD \n                        type=\"rejectReason\" \n                        name=\"rejectReason\" \n                        label = \"拒絕原因\" \n                        component = { TextField }\n                      />\n\n                      <br></br>\n                      <br></br>\n\n                      <BUTTON\n                        type=\"submit\"\n                        fontFamily= \"Candara\"\n                        variant=\"contained\"\n                        color=\"secondary\"\n                        disabled={isSubmitting}\n                      >\n                      送出\n                      </BUTTON>\n                      \n                    </MYFORM> :\n\n                    this.state.userId && this.state.Authorization && this.state.ubn && this.state.leaveId && (this.state.status == \"signed\") ?\n                    <MYFORM>\n                        <label>此張假單已簽核</label>                    \n                    </MYFORM> :\n\n                    <LOADERBOX>\n                      <Loader type=\"ThreeDots\" color=\"#f50057\" height={80} width={80} />\n                    </LOADERBOX>\n                  }\n                </CONTAINER>\n              )}\n              </Formik>\n            </BOX>\n          </body>\n        </BOX>   \n      );\n    }\n  }"]},"metadata":{},"sourceType":"module"}