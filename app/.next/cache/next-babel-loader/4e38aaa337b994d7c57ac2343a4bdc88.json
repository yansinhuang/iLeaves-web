{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/yan/ezbot-web/app/pages/viewSign.js\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport React, { Component } from 'react';\nimport ReactTable from \"react-table\";\nimport styled from 'styled-components';\nimport \"react-table/react-table.css\";\nimport window from 'global';\nimport MonthPickerInput from 'react-month-picker-input';\nimport Loader from \"./loader\"; //import 'react-month-picker-input/dist/react-month-picker-input.css';\n//var MonthPickerInput = require('react-month-picker-input');\n\nrequire('react-month-picker-input/dist/react-month-picker-input.css');\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nconst useStyles = makeStyles(theme => ({\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: 120\n  },\n  selectEmpty: {\n    marginTop: theme.spacing(2)\n  }\n}));\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\nvar leaves;\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"handleChange\", event => {\n      try {\n        this.setState({\n          role: event\n        }, () => {\n          //this.globalSearch();\n          if (event == \"substitute\") {\n            this.getLeavesSub(this.state.ubn, this.state.name, this.state.email, this.state.idToken);\n          } else if (event == \"supervisor\") {}\n        });\n      } catch (err) {\n        throw err;\n      }\n    });\n\n    _defineProperty(this, \"globalSearch\", () => {\n      try {\n        let {\n          role\n        } = this.state;\n        var date_array = role.split(\"/\");\n        var date_select = new Date(date_array[1], date_array[0]);\n        var year_select = date_select.getFullYear();\n        var month_select = date_select.getMonth();\n        let filteredData = this.state.data_origin.filter(value => {\n          var date = new Date(value.startDate);\n          var year = date.getFullYear();\n          var month = date.getMonth() + 1;\n          return year === year_select && month === month_select;\n        });\n        this.setState({\n          data: filteredData,\n          loading: false\n        });\n      } catch (err) {\n        throw err;\n      }\n    });\n\n    this.state = {\n      data: null,\n      data_origin: null,\n      role: \"substitute\"\n    };\n  }\n\n  componentDidMount() {\n    this.liffInit();\n  }\n\n  liffInit() {\n    try {\n      liff.init(data => {\n        const userId = data.context.userId;\n        const accessToken = liff.getAccessToken();\n        const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n        const body = {\n          userId: userId\n        };\n        fetch(URL_CHECKEXIST, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(res => {\n          return res.text();\n        }).then(result => {\n          if (result) {\n            this.lineAuth(userId, accessToken);\n          } else {\n            alert(\"請登入以查看假單\");\n            window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n          }\n        });\n      }, err => {\n        alert(\"error\");\n      });\n    } catch (err) {\n      throw err;\n    }\n  }\n\n  lineAuth(userId, accessToken) {\n    try {\n      const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n      const body = {\n        userId: userId,\n        accessToken: accessToken\n      };\n      fetch(url, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: _JSON$stringify(body)\n      }).then(res => {\n        return res.json();\n      }).then(result => {\n        if (result) {\n          const ubn = result.staff.ubn;\n          const email = result.staff.email;\n          const name = result.staff.name;\n          const idToken = result.token.idToken; //this.getLeaves(ubn, email, idToken);\n          //this.getLeavesSub(ubn, name, email, idToken);\n          //this.getLeavesSuper(ubn, email, idToken);\n\n          this.setState({\n            ubn: ubn,\n            name: name,\n            email: email,\n            idToken: idToken\n          });\n        } else {\n          alert(\"lineAuth no result\");\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      });\n    } catch (err) {\n      throw err;\n    }\n  }\n\n  getLeavesSub(ubn, name, email, idToken) {\n    try {\n      const URL_GETLEAVES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n      const url = URL_GETLEAVES + `?ubn=${ubn}&query=substitute&value={\"name\":\"${name}\",\"email\":\"${email}\"}`;\n      const header = {\n        Authorization: idToken\n      };\n      fetch(url, {\n        method: 'get',\n        headers: header\n      }).then(res => {\n        return res.json();\n      }).then(result => {\n        if (result) {\n          this.convertData(result.list);\n        } else {\n          alert(\"getLeavesSub no result\");\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      });\n    } catch (err) {\n      throw err;\n    }\n  }\n\n  getLeavesSuper(ubn, email, idToken) {\n    try {\n      const URL_GETLEAVES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n      const url = URL_GETLEAVES + `?ubn=${ubn}&query=supervisor&value=${email}`;\n      const header = {\n        Authorization: idToken\n      };\n      fetch(url, {\n        method: 'get',\n        headers: header\n      }).then(res => {\n        return res.json();\n      }).then(result => {\n        if (result) {\n          this.convertData(result.list);\n        } else {\n          alert(\"getLeavesSuper no result\");\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      });\n    } catch (err) {\n      throw err;\n    }\n  }\n\n  convertData(list) {\n    try {\n      var newList = [];\n\n      for (var i = 0; i < list.length; i++) {\n        const data = {\n          \"startDate\": list[i].startDate,\n          \"endDate\": list[i].endDate,\n          \"leaveType\": list[i].leaveType,\n          \"substitute\": JSON.parse(list[i].substitute).name,\n          \"status\": list[i].status,\n          \"leaveReason\": list[i].leaveReason,\n          \"rejectReason\": list[i].rejectReason\n        };\n        newList.push(data);\n      }\n\n      this.setState({\n        data: newList,\n        data_origin: newList\n      });\n    } catch (err) {\n      throw err;\n    }\n  }\n\n  render() {\n    const MyLoader = () => __jsx(Loader, {\n      loading: this.state.loading,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243\n      },\n      __self: this\n    });\n\n    let months = ['Jan', 'Feb', 'Mar', 'Spr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\n    let makeText = m => {\n      if (m && m.year && m.month) return months[m.month - 1] + '. ' + m.year;\n      return '?';\n    };\n\n    let mvalue = {\n      year: 2015,\n      month: 11\n    };\n    const columns = [{\n      Header: '開始日期',\n      accessor: 'startDate',\n      id: \"startDate\"\n    }, {\n      Header: '結束日期',\n      accessor: 'endDate'\n    }, {\n      Header: '假勤類別',\n      accessor: 'leaveType'\n    }, {\n      Header: '代理人',\n      accessor: 'substitute'\n    }, {\n      Header: '簽核狀態',\n      accessor: 'status'\n    }, {\n      Header: '請假原因',\n      accessor: 'leaveReason',\n      show: false\n    }, {\n      Header: '拒絕原因',\n      accessor: 'rejectReason',\n      show: false\n    }];\n    const classes = useStyles;\n    return __jsx(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278\n      },\n      __self: this\n    }, __jsx(Head, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279\n      },\n      __self: this\n    }, __jsx(\"script\", {\n      src: \"https://d.line-scdn.net/liff/1.0/sdk.js\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280\n      },\n      __self: this\n    })), __jsx(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282\n      },\n      __self: this\n    }, \"\\u5E74/\\u6708\"), __jsx(MonthPickerInput, {\n      onChange: this.handleChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283\n      },\n      __self: this\n    }), __jsx(FormControl, {\n      className: classes.formControl,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 286\n      },\n      __self: this\n    }, __jsx(InputLabel, {\n      id: \"demo-simple-select-label\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287\n      },\n      __self: this\n    }, \"\\u7C3D\\u6838\\u8EAB\\u4EFD\"), __jsx(Select, {\n      labelId: \"demo-simple-select-label\",\n      id: \"demo-simple-select\",\n      value: this.state.role,\n      onChange: this.handleChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288\n      },\n      __self: this\n    }, __jsx(MenuItem, {\n      value: \"substitute\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294\n      },\n      __self: this\n    }, \"\\u4EE3\\u7406\\u4EBA\"), __jsx(MenuItem, {\n      value: \"supervisor\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 295\n      },\n      __self: this\n    }, \"\\u4E3B\\u7BA1\"))), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 298\n      },\n      __self: this\n    }), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299\n      },\n      __self: this\n    }), __jsx(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }, this.state.data ? __jsx(ReactTable, {\n      data: this.state.data,\n      getTrProps: (state, rowInfo, column, instance) => ({\n        onClick: e => alert(`開始日期：${rowInfo.row.startDate}\\n結束日期：${rowInfo.row.endDate}\\n假勤類別：${rowInfo.row.leaveType}\\n代理人：${rowInfo.row.substitute}\\n簽核狀態：${rowInfo.row.status}\\n拒絕原因：${rowInfo.row.rejectReason}`)\n      }),\n      columns: columns,\n      defaultPageSize: 10,\n      pageSizeOptions: [10, 15],\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302\n      },\n      __self: this\n    }) : __jsx(ReactTable, {\n      LoadingComponent: MyLoader,\n      data: leaves,\n      columns: columns,\n      defaultPageSize: 10,\n      pageSizeOptions: [10, 15],\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 312\n      },\n      __self: this\n    })));\n  }\n\n}","map":{"version":3,"sources":["/Users/yan/ezbot-web/app/pages/viewSign.js"],"names":["Head","React","Component","ReactTable","styled","window","MonthPickerInput","Loader","require","makeStyles","InputLabel","MenuItem","FormHelperText","FormControl","Select","useStyles","theme","formControl","margin","spacing","minWidth","selectEmpty","marginTop","liff","BOX","div","leaves","App","constructor","props","event","setState","role","getLeavesSub","state","ubn","name","email","idToken","err","date_array","split","date_select","Date","year_select","getFullYear","month_select","getMonth","filteredData","data_origin","filter","value","date","startDate","year","month","data","loading","componentDidMount","liffInit","init","userId","context","accessToken","getAccessToken","URL_CHECKEXIST","body","fetch","method","headers","then","res","text","result","lineAuth","alert","location","replace","url","json","staff","token","catch","error","message","URL_GETLEAVES","header","Authorization","convertData","list","getLeavesSuper","newList","i","length","endDate","leaveType","JSON","parse","substitute","status","leaveReason","rejectReason","push","render","MyLoader","months","makeText","m","mvalue","columns","Header","accessor","id","show","classes","handleChange","rowInfo","column","instance","onClick","e","row"],"mappings":"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","sourcesContent":["import Head from 'next/head';\nimport React, { Component } from 'react';\nimport ReactTable from \"react-table\";\nimport styled from 'styled-components';\nimport \"react-table/react-table.css\";\nimport window from 'global'\n\nimport MonthPickerInput from 'react-month-picker-input';\nimport Loader from \"./loader\";\n//import 'react-month-picker-input/dist/react-month-picker-input.css';\n//var MonthPickerInput = require('react-month-picker-input');\nrequire('react-month-picker-input/dist/react-month-picker-input.css');\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nconst useStyles = makeStyles(theme => ({\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: 120,\n  },\n  selectEmpty: {\n    marginTop: theme.spacing(2),\n  },\n}));\n\n\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\n\nvar leaves;\n\n\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data : null,\n      data_origin : null,\n      role : \"substitute\"\n    };\n  }\n\n  componentDidMount() {\n    this.liffInit();\n  }\n\n  liffInit() {\n    try {\n      liff.init(data => {\n        const userId = data.context.userId;\n        const accessToken = liff.getAccessToken();\n        const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n        const body = {\n          userId: userId\n        };\n        fetch(URL_CHECKEXIST, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(body)\n        }).then((res) => {\n          return res.text();\n        }).then(result => {\n          if (result) {\n              this.lineAuth(userId, accessToken);\n          } else {\n              alert(\"請登入以查看假單\");\n              window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n          }\n        })\n      }, err => {\n        alert(\"error\");\n      });\n    } catch (err) {\n      throw(err);\n    }\n  }\n  \n  lineAuth (userId, accessToken)  {\n    try {\n      const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n      const body = {\n          userId: userId,\n          accessToken: accessToken\n        };\n      fetch(url, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(body)\n        }).then((res) => {\n          return res.json();\n        }).then(result => {\n          if (result) {\n              const ubn = result.staff.ubn;\n              const email = result.staff.email;\n              const name = result.staff.name;\n              const idToken = result.token.idToken;\n              //this.getLeaves(ubn, email, idToken);\n              //this.getLeavesSub(ubn, name, email, idToken);\n              //this.getLeavesSuper(ubn, email, idToken);\n              this.setState({\n                ubn: ubn,\n                name: name,\n                email: email,\n                idToken: idToken\n              })\n          } else {\n              alert(\"lineAuth no result\");\n\n          }\n        }).catch(function (error) {\n          alert(error.message);\n        })\n      } catch (err) {\n        throw(err);\n      }\n  }\n\n  getLeavesSub (ubn, name, email, idToken) {\n    try {\n      const URL_GETLEAVES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n      const url = URL_GETLEAVES + `?ubn=${ubn}&query=substitute&value={\"name\":\"${name}\",\"email\":\"${email}\"}`;\n      const header = {\n          Authorization: idToken\n        };\n      fetch(url, {\n          method: 'get',\n          headers: header\n      }).then((res) => {\n          return res.json();\n      }).then(result => {\n          if (result) {\n            this.convertData(result.list);\n      } else {\n          alert(\"getLeavesSub no result\");\n      }\n      }).catch(function (error) {\n          alert(error.message);\n      })\n    } catch (err) {\n      throw(err);\n    }\n  }\n\n  getLeavesSuper (ubn, email, idToken) {\n    try {\n      const URL_GETLEAVES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n      const url = URL_GETLEAVES + `?ubn=${ubn}&query=supervisor&value=${email}`;\n      const header = {\n          Authorization: idToken\n        };\n      fetch(url, {\n          method: 'get',\n          headers: header\n      }).then((res) => {\n          return res.json();\n      }).then(result => {\n          if (result) {\n            this.convertData(result.list);\n      } else {\n          alert(\"getLeavesSuper no result\");\n      }\n      }).catch(function (error) {\n          alert(error.message);\n      })\n    } catch (err) {\n      throw(err);\n    }\n  }\n\n  convertData (list)  {\n    try {\n      var newList = [];\n      for (var i = 0; i < list.length; i++) {\n        const data = {\n          \"startDate\": list[i].startDate,\n          \"endDate\": list[i].endDate,\n          \"leaveType\": list[i].leaveType,\n          \"substitute\": JSON.parse(list[i].substitute).name,\n          \"status\": list[i].status,\n          \"leaveReason\": list[i].leaveReason,\n          \"rejectReason\": list[i].rejectReason\n        };\n        newList.push(data);\n      }\n      this.setState({\n        data: newList,\n        data_origin: newList\n      })\n    } catch (err) {\n      throw(err);\n    }\n  }\n\n  handleChange = event => {\n    try{\n      this.setState({ role: event }, () => {\n        //this.globalSearch();\n        if (event == \"substitute\") {\n          this.getLeavesSub(this.state.ubn, this.state.name, this.state.email, this.state.idToken);\n        } else if (event == \"supervisor\") {\n          \n        }\n      });\n    } catch (err) {\n      throw(err);\n    }\n  };\n\n  globalSearch = () => {\n    try {\n      let { role } = this.state;\n      var date_array = role.split(\"/\");\n      var date_select = new Date(date_array[1], date_array[0]);\n      var year_select = date_select.getFullYear();\n      var month_select = date_select.getMonth();\n\n      let filteredData = this.state.data_origin.filter(value => {\n        var date = new Date(value.startDate);\n        var year = date.getFullYear();\n        var month = date.getMonth() + 1;\n        return (      \n          year === year_select &&\n          month === month_select  \n        );\n      });\n      this.setState({ data: filteredData, loading: false });\n    } catch (err) {\n      throw(err);\n    }\n  };\n  \n  render() {\n    const MyLoader = () => <Loader loading={this.state.loading} />;\n    let months = ['Jan', 'Feb', 'Mar', 'Spr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    let makeText = m => {\n      if (m && m.year && m.month) return (months[m.month-1] + '. ' + m.year)\n      return '?'\n    };\n    let mvalue = {year: 2015, month: 11};\n    const columns = [{\n      Header: '開始日期',\n      accessor: 'startDate',\n      id: \"startDate\",\n    },{\n      Header: '結束日期',\n      accessor: 'endDate'\n    },{\n      Header: '假勤類別',\n      accessor: 'leaveType'\n    },{\n      Header: '代理人',\n      accessor: 'substitute'\n    },{\n      Header: '簽核狀態',\n      accessor: 'status'\n    },{\n      Header: '請假原因',\n      accessor: 'leaveReason',\n      show: false\n    },{\n      Header: '拒絕原因',\n      accessor: 'rejectReason',\n      show: false\n    }];\n    const classes = useStyles;\n\n    return (\n      <div>\n        <Head>\n          <script src=\"https://d.line-scdn.net/liff/1.0/sdk.js\"></script>\n        </Head>\n        <p>年/月</p>\n        <MonthPickerInput \n          onChange={this.handleChange}\n        />\n        <FormControl className={classes.formControl}>\n          <InputLabel id=\"demo-simple-select-label\">簽核身份</InputLabel>\n          <Select\n            labelId=\"demo-simple-select-label\"\n            id=\"demo-simple-select\"\n            value={this.state.role}\n            onChange={this.handleChange}\n          >\n            <MenuItem value={\"substitute\"}>代理人</MenuItem>\n            <MenuItem value={\"supervisor\"}>主管</MenuItem>\n          </Select>\n        </FormControl>\n        <br></br>\n        <br></br>\n        <div>\n          {this.state.data ?\n            <ReactTable\n              data={this.state.data}\n              getTrProps={(state, rowInfo, column, instance) => ({\n                onClick: e => alert(\n              `開始日期：${rowInfo.row.startDate}\\n結束日期：${rowInfo.row.endDate}\\n假勤類別：${rowInfo.row.leaveType}\\n代理人：${rowInfo.row.substitute}\\n簽核狀態：${rowInfo.row.status}\\n拒絕原因：${rowInfo.row.rejectReason}`)\n              })}\n              columns={columns}\n              defaultPageSize = {10}\n              pageSizeOptions = {[10, 15]}\n            /> :\n            <ReactTable\n              LoadingComponent={MyLoader}\n              data={leaves}\n              columns={columns}\n              defaultPageSize = {10}\n              pageSizeOptions = {[10, 15]}\n            />\n          }\n        </div> \n      </div>    \n    );\n  }\n}\n\n"]},"metadata":{},"sourceType":"module"}