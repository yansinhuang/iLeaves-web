{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _Date$now from \"@babel/runtime-corejs2/core-js/date/now\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/yan/ezbot-web/app/pages/createLeave.js\";\nvar __jsx = React.createElement;\n// Render Prop\nimport React, { Component, useState } from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport icon from '../components/image/icon.png';\nimport Head from 'next/head';\nimport window from 'global'; //import DatePicker from \"react-datepicker\";\n\nimport { Select } from 'material-ui-formik-components/Select';\n\nrequire(\"react-datepicker/dist/react-datepicker.css\");\n\nvar dateFormat = require('dateformat');\n\nimport { DatePicker, TimePicker, DateTimePicker, MuiPickersUtilsProvider } from '@material-ui/pickers';\nimport MomentUtils from '@date-io/moment';\nimport DateFnsUtils from '@date-io/date-fns';\nimport LuxonUtils from '@date-io/luxon';\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\nconst TITLE = styled.h2`\n  color: #F8F9F9;\n  font-family: Candara;\n  text-align: center;\n  margin-bottom:-2em;\n`;\nconst CONTAINER = styled.div`\n  background: #F7F9FA;\n  height: auto;\n  width: 90%;\n  margin: 5em auto;\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\n\n  label {\n    font-family: Candara;\n    color: #1C2833;\n    font-size: 1.2em;\n    font-weight: 400;\n  }\n`;\nconst MYFORM = styled(Form)`\n  text-align: center;\n  padding-top: 2em;\n  padding-bottom: 2em;\n`;\nconst FIELD = styled(Field)`\n  width: 80%;\n  margin: auto;\n`;\nconst BUTTON = styled(Button)`\n  width: 80%;\n  variant: contained;\n`;\nconst TomatoButton = styled.button`\n  color: tomato;\n  border-color: tomato;\n  width: 80%;\n`;\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"handleStartDateChange\", date => {\n      this.setState({\n        startDate: date\n      });\n    });\n\n    _defineProperty(this, \"handleEndDateChange\", date => {\n      this.setState({\n        endDate: date\n      });\n    });\n\n    this.state = {\n      substitutes: [],\n      userId: null,\n      startDate: dateFormat(new Date(), \"yyyy-mm-dd\"),\n      endDate: _Date$now()\n    };\n  }\n\n  componentDidMount() {\n    this.liffInit();\n  }\n\n  liffInit() {\n    liff.init(data => {\n      const userId = data.context.userId;\n      const accessToken = liff.getAccessToken();\n      const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n      const body = {\n        userId: userId\n      };\n      fetch(URL_CHECKEXIST, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: _JSON$stringify(body)\n      }).then(res => {\n        return res.text();\n      }).then(result => {\n        if (result) {\n          this.setState({\n            userId: userId\n          });\n          this.lineAuth(userId, accessToken);\n        } else {\n          alert(\"請登入以查看假單\");\n          window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n        }\n      });\n    }, err => {\n      alert(\"error\");\n    });\n  }\n\n  lineAuth(userId, accessToken) {\n    const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n    const body = {\n      userId: userId,\n      accessToken: accessToken\n    };\n    fetch(url, {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: _JSON$stringify(body)\n    }).then(res => {\n      return res.json();\n    }).then(result => {\n      if (result) {\n        const ubn = result.staff.ubn;\n        const department = result.staff.department;\n        const email = result.staff.email;\n        const idToken = result.token.idToken;\n        this.setState({\n          Authorization: idToken,\n          ubn: ubn,\n          email: email\n        });\n        this.getSubstitutes(ubn, department, idToken);\n      } else {\n        alert(\"lineAuth no result\");\n      }\n    }).catch(function (error) {\n      alert(error.message);\n    });\n  }\n\n  getSubstitutes(ubn, department, idToken) {\n    const URL_GETSUBSTITUTES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/getSubstitutes\";\n    const url = URL_GETSUBSTITUTES + `?ubn=${ubn}&query=department&value=${department}`;\n    const header = {\n      Authorization: idToken\n    }; //document.write(idToken);\n\n    fetch(url, {\n      method: 'get',\n      headers: header\n    }).then(res => {\n      return res.json();\n    }).then(result => {\n      if (result) {\n        this.createOptions(result.list);\n      } else {\n        alert(\"getSubstitutes no result\");\n      }\n    }).catch(function (error) {\n      alert(error.message);\n    });\n  }\n\n  createOptions(arr) {\n    var newList = [];\n\n    for (var i = 0; i < arr.length; i++) {\n      var obj = arr[i];\n      obj.value = _JSON$stringify({\n        \"name\": obj.name,\n        \"email\": obj.email\n      });\n      obj.label = obj.name;\n      delete obj.email;\n      delete obj.name; //push to list\n\n      newList.push(obj);\n\n      if (i == arr.length - 1) {\n        this.setState({\n          substitutes: newList\n        });\n      }\n    }\n  } // tell Basic that options have been changed\n  //substitutes = newList;\n\n\n  submitForm(values) {\n    alert(\"submitForm\");\n    const URL_CREATELEAVE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/create\";\n    fetch(URL_CREATELEAVE, {\n      method: 'post',\n      headers: {\n        \"Authorization\": this.state.Authorization,\n        \"ubn\": this.state.ubn,\n        \"userId\": this.state.userId,\n        \"Content-Type\": \"application/json\"\n      },\n      body: _JSON$stringify(values)\n    }).then(res => {\n      alert(res);\n      return res.text();\n    }).then(result => {\n      if (result) {\n        alert(result);\n        liff.closeWindow();\n      } else {\n        alert(\"submitForm error\"); //window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n      }\n    }).catch(function (error) {\n      alert(error.message);\n    });\n  }\n\n  render() {\n    return __jsx(BOX, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }, __jsx(Head, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }, __jsx(\"script\", {\n      src: \"https://d.line-scdn.net/liff/1.0/sdk.js\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    })), __jsx(\"body\", {\n      style: {\n        background: '#34495E'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249\n      },\n      __self: this\n    }, __jsx(BOX, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250\n      },\n      __self: this\n    }, __jsx(Formik, {\n      initialValues: {\n        startDate: new Date(),\n        endDate: '',\n        leaveType: '',\n        leaveReason: '',\n        substitute: ''\n      },\n      validate: values => {\n        const errors = {}; // check for startDate\n\n        if (!values.startDate) {\n          errors.startDate = 'Required';\n        } // check for endDate\n\n\n        if (!values.endDate) {\n          errors.endDate = 'Required';\n        } // check for leaveType\n\n\n        if (!values.leaveType) {\n          errors.leaveType = 'Required';\n        } // check for leaveReason\n\n\n        if (!values.leaveReason) {\n          errors.leaveReason = 'Required';\n        }\n        /*\n        // check for substitute\n        if (!values.substitute) {\n            errors.substitute = 'Required';\n        }\n        */\n\n\n        return errors;\n      },\n      onSubmit: (values, {\n        setSubmitting\n      }) => {\n        values.email = this.state.email;\n        alert(values);\n        this.submitForm(values);\n        setSubmitting(false);\n        /*\n        setTimeout(() => {\n          this.submitForm(values);\n          setSubmitting(false);\n        }, 400);\n        */\n\n        console.log('submitting', values); //setSubmitting(false);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251\n      },\n      __self: this\n    }, ({\n      isSubmitting,\n      values,\n      setFieldValue\n    }) => __jsx(CONTAINER, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 298\n      },\n      __self: this\n    }, __jsx(MYFORM, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299\n      },\n      __self: this\n    }, __jsx(MuiPickersUtilsProvider, {\n      utils: LuxonUtils,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }, __jsx(DatePicker, {\n      style: {\n        width: \"80%\"\n      },\n      name: \"startDate\",\n      label: \"\\u958B\\u59CB\\u65E5\\u671F\",\n      format: \"yyyy-MM-dd\",\n      value: values.startDate,\n      onChange: date => setFieldValue('startDate', dateFormat(date, \"yyyy-mm-dd\")),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301\n      },\n      __self: this\n    })), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 303\n      },\n      __self: this\n    }), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 304\n      },\n      __self: this\n    }), __jsx(MuiPickersUtilsProvider, {\n      utils: LuxonUtils,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305\n      },\n      __self: this\n    }, __jsx(DatePicker, {\n      style: {\n        width: \"80%\"\n      },\n      name: \"endDate\",\n      label: \"\\u7D50\\u675F\\u65E5\\u671F\",\n      format: \"yyyy-MM-dd\",\n      value: values.endDate,\n      onChange: date => setFieldValue('endDate', dateFormat(date, \"yyyy-mm-dd\")),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306\n      },\n      __self: this\n    })), __jsx(FIELD, {\n      type: \"leaveType\",\n      name: \"leaveType\",\n      label: \"\\u5047\\u52E4\\u985E\\u5225\",\n      options: [{\n        value: '病假',\n        label: '病假'\n      }, {\n        value: '事假',\n        label: '事假'\n      }, {\n        value: '喪假',\n        label: '喪假'\n      }, {\n        value: '公假',\n        label: '公假'\n      }, {\n        value: '生理假',\n        label: '生理假'\n      }, {\n        value: '婚假',\n        label: '婚假'\n      }, {\n        value: '產假',\n        label: '產假'\n      }, {\n        value: '陪產假',\n        label: '陪產假'\n      }],\n      component: Select,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308\n      },\n      __self: this\n    }), __jsx(FIELD, {\n      type: \"leaveReason\",\n      name: \"leaveReason\",\n      label: \"\\u5047\\u52E4\\u4E8B\\u7531\",\n      component: TextField,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324\n      },\n      __self: this\n    }), __jsx(FIELD, {\n      type: \"substitute\",\n      name: \"substitute\",\n      label: \"\\u8077\\u52D9\\u4EE3\\u7406\\u4EBA\",\n      options: this.state.substitutes,\n      component: Select,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 325\n      },\n      __self: this\n    }), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 332\n      },\n      __self: this\n    }), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 333\n      },\n      __self: this\n    }), __jsx(BUTTON, {\n      type: \"submit\",\n      fontFamily: \"Candara\",\n      variant: \"contained\",\n      color: \"secondary\",\n      disabled: isSubmitting,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 334\n      },\n      __self: this\n    }, \"\\u9001\\u51FA\\u5047\\u55AE\")))))));\n  }\n\n}","map":{"version":3,"sources":["/Users/yan/ezbot-web/app/pages/createLeave.js"],"names":["React","Component","useState","styled","Formik","Form","Field","ErrorMessage","TextField","fetch","Button","Box","icon","Head","window","Select","require","dateFormat","DatePicker","TimePicker","DateTimePicker","MuiPickersUtilsProvider","MomentUtils","DateFnsUtils","LuxonUtils","liff","BOX","div","TITLE","h2","CONTAINER","MYFORM","FIELD","BUTTON","TomatoButton","button","App","constructor","props","date","setState","startDate","endDate","state","substitutes","userId","Date","componentDidMount","liffInit","init","data","context","accessToken","getAccessToken","URL_CHECKEXIST","body","method","headers","then","res","text","result","lineAuth","alert","location","replace","err","url","json","ubn","staff","department","email","idToken","token","Authorization","getSubstitutes","catch","error","message","URL_GETSUBSTITUTES","header","createOptions","list","arr","newList","i","length","obj","value","name","label","push","submitForm","values","URL_CREATELEAVE","closeWindow","render","background","leaveType","leaveReason","substitute","errors","setSubmitting","console","log","isSubmitting","setFieldValue","width"],"mappings":"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","sourcesContent":["// Render Prop\nimport React, { Component, useState } from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport icon from '../components/image/icon.png';\nimport Head from 'next/head';\nimport window from 'global';\n//import DatePicker from \"react-datepicker\";\nimport { Select } from 'material-ui-formik-components/Select'\nrequire( \"react-datepicker/dist/react-datepicker.css\");\nvar dateFormat = require('dateformat');\n\nimport {\n  DatePicker,\n  TimePicker,\n  DateTimePicker,\n  MuiPickersUtilsProvider,\n} from '@material-ui/pickers';\nimport MomentUtils from '@date-io/moment';\nimport DateFnsUtils from '@date-io/date-fns';\nimport LuxonUtils from '@date-io/luxon';\n\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\nconst TITLE = styled.h2`\n  color: #F8F9F9;\n  font-family: Candara;\n  text-align: center;\n  margin-bottom:-2em;\n`;\nconst CONTAINER = styled.div`\n  background: #F7F9FA;\n  height: auto;\n  width: 90%;\n  margin: 5em auto;\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\n\n  label {\n    font-family: Candara;\n    color: #1C2833;\n    font-size: 1.2em;\n    font-weight: 400;\n  }\n`;\nconst MYFORM = styled(Form)`\n  text-align: center;\n  padding-top: 2em;\n  padding-bottom: 2em;\n`;\nconst FIELD = styled(Field)`\n  width: 80%;\n  margin: auto;\n`;\nconst BUTTON = styled(Button)`\n  width: 80%;\n  variant: contained;\n`;\nconst TomatoButton = styled.button`\n  color: tomato;\n  border-color: tomato;\n  width: 80%;\n`;\n\n\nexport default class App extends Component {\n    constructor(props) {\n      super(props);\n  \n      this.state = {\n        substitutes : [],\n        userId : null,\n        startDate: dateFormat(new Date(), \"yyyy-mm-dd\"),\n        endDate: Date.now()\n      };\n    }\n\n    handleStartDateChange = (date) => {\n      this.setState({ startDate: date });\n    };\n\n    handleEndDateChange = (date) => {\n      this.setState({ endDate: date });\n    };\n  \n    componentDidMount() {\n      this.liffInit();\n    }\n  \n    liffInit() {\n      liff.init(data => {\n        const userId = data.context.userId;\n        const accessToken = liff.getAccessToken();\n        const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n        const body = {\n          userId: userId\n        };\n        fetch(URL_CHECKEXIST, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(body)\n        }).then((res) => {\n          return res.text();\n        }).then(result => {\n          if (result) {\n              this.setState({\n                userId: userId\n            })\n            this.lineAuth(userId, accessToken);\n          } else {\n              alert(\"請登入以查看假單\");\n              window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n          }\n        })\n        \n    \n      }, err => {\n        alert(\"error\");\n      });\n    }\n    \n    lineAuth (userId, accessToken)  {\n      const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n      const body = {\n          userId: userId,\n          accessToken: accessToken\n        };\n      fetch(url, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(body)\n        }).then((res) => {\n          return res.json();\n        }).then(result => {\n          if (result) {\n            const ubn = result.staff.ubn;\n            const department = result.staff.department;\n            const email = result.staff.email;\n            const idToken = result.token.idToken;\n            this.setState({\n              Authorization: idToken,\n              ubn: ubn,\n              email: email\n          })\n            this.getSubstitutes(ubn, department, idToken);\n          } else {\n              alert(\"lineAuth no result\");\n  \n          }\n        }).catch(function (error) {\n          alert(error.message);\n        })\n    }\n  \n    getSubstitutes (ubn, department, idToken) {\n        const URL_GETSUBSTITUTES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/getSubstitutes\";\n        const url = URL_GETSUBSTITUTES + `?ubn=${ubn}&query=department&value=${department}`; \n        const header = {\n            Authorization: idToken\n          };\n        //document.write(idToken);\n        fetch(url, {\n            method: 'get',\n            headers: header\n          }).then((res) => {\n            return res.json();\n          }).then(result => {\n            if (result) {\n              this.createOptions(result.list)\n            } else {\n                alert(\"getSubstitutes no result\");\n      \n            }\n          }).catch(function (error) {\n            alert(error.message);\n          })\n      }\n  \n    createOptions (arr) {\n    var newList = [];\n    for (var i = 0; i < arr.length; i++) {\n        var obj = arr[i];\n        obj.value = JSON.stringify({\n          \"name\": obj.name,\n          \"email\": obj.email\n        });\n        obj.label = obj.name;\n        delete obj.email;\n        delete obj.name;\n        //push to list\n        newList.push(obj);\n        \n        if(i == arr.length-1) {\n          this.setState({\n              substitutes: newList\n          })\n        }\n        }\n    }\n    // tell Basic that options have been changed\n    //substitutes = newList;\n    \n    submitForm (values) {\n      alert(\"submitForm\");\n      const URL_CREATELEAVE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/create\";\n      fetch(URL_CREATELEAVE, {\n        method: 'post',\n        headers: {\n          \"Authorization\": this.state.Authorization,\n          \"ubn\": this.state.ubn,\n          \"userId\": this.state.userId,\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(values)\n      }).then((res) => {\n        alert(res);\n        return res.text();\n      }).then(result => {\n        if (result) {\n          alert(result);\n          liff.closeWindow();\n        } else {\n            alert(\"submitForm error\");\n            //window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      })\n    }\n  \n  \n    \n    \n    render() {\n      return (\n        <BOX>\n    <Head>\n      <script src=\"https://d.line-scdn.net/liff/1.0/sdk.js\"></script>\n    </Head>\n    <body style={{background:'#34495E'}}>\n      <BOX>\n        <Formik\n          initialValues={{ startDate: new Date, endDate: '', leaveType: '', leaveReason: '', substitute: '' }}\n          validate={values => {\n            const errors = {};\n            // check for startDate\n            if (!values.startDate) {\n              errors.startDate = 'Required';\n            }\n            // check for endDate\n            if (!values.endDate) {\n              errors.endDate = 'Required';\n            } \n            // check for leaveType\n            if (!values.leaveType) {\n              errors.leaveType = 'Required';\n            }\n            // check for leaveReason\n            if (!values.leaveReason) {\n                errors.leaveReason = 'Required';\n            }\n            /*\n            // check for substitute\n            if (!values.substitute) {\n                errors.substitute = 'Required';\n            }\n            */\n            return errors;\n            \n          }}\n          onSubmit={(values, { setSubmitting }) => {\n            values.email = this.state.email;\n            alert(values);\n            this.submitForm(values);\n              setSubmitting(false);\n            \n            /*\n            setTimeout(() => {\n              this.submitForm(values);\n              setSubmitting(false);\n            }, 400);\n            */\n            \n            console.log('submitting', values);\n            //setSubmitting(false);\n          }}\n        >\n          {({ isSubmitting, values, setFieldValue}) => (\n            <CONTAINER>\n            <MYFORM>\n            <MuiPickersUtilsProvider utils={LuxonUtils}>\n              <DatePicker style={{ width: \"80%\" }}  name=\"startDate\" label = \"開始日期\" format=\"yyyy-MM-dd\" value={values.startDate} onChange={date => setFieldValue('startDate', dateFormat(date, \"yyyy-mm-dd\"))}/>\n            </MuiPickersUtilsProvider>\n            <br></br>\n            <br></br>\n            <MuiPickersUtilsProvider utils={LuxonUtils}>\n              <DatePicker style={{ width: \"80%\" }} name=\"endDate\" label = \"結束日期\" format=\"yyyy-MM-dd\" value={values.endDate} onChange={date => setFieldValue('endDate', dateFormat(date, \"yyyy-mm-dd\"))} />\n            </MuiPickersUtilsProvider>\n              <FIELD\n                type=\"leaveType\"\n                name=\"leaveType\"\n                label=\"假勤類別\"\n                options={[\n                  { value: '病假', label: '病假' },\n                  { value: '事假', label: '事假' },\n                  { value: '喪假', label: '喪假' },\n                  { value: '公假', label: '公假' },\n                  { value: '生理假', label: '生理假' },\n                  { value: '婚假', label: '婚假' },\n                  { value: '產假', label: '產假' },\n                  { value: '陪產假', label: '陪產假' }\n                ]}\n                component={Select}\n              />\n              <FIELD type=\"leaveReason\" name=\"leaveReason\" label = \"假勤事由\" component = { TextField }/>\n              <FIELD\n                type=\"substitute\"\n                name=\"substitute\"\n                label=\"職務代理人\"\n                options={this.state.substitutes}\n                component={Select}\n              />\n              <br></br>\n              <br></br>\n              <BUTTON\n              type=\"submit\"\n              fontFamily= \"Candara\"\n              variant=\"contained\"\n              color=\"secondary\"\n              disabled={isSubmitting}\n            >\n              送出假單\n            </BUTTON>\n            </MYFORM>\n            </CONTAINER>\n          )}\n        </Formik>\n      </BOX>\n    </body>\n    </BOX>   \n      );\n    }\n  }"]},"metadata":{},"sourceType":"module"}