{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar __jsx = React.createElement;\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 5.5em auto;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 20%;\\n  variant: contained;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport Head from 'next/head';\nimport React, { Component } from 'react';\nimport ReactTable from \"react-table\";\nimport styled from 'styled-components';\nimport \"react-table/react-table.css\";\nimport window from 'global';\nimport Loader from \"./loader\";\nimport Button from \"@material-ui/core/Button\";\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\nrequire('react-month-picker-input/dist/react-month-picker-input.css');\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport Grid from '@material-ui/core/Grid';\nvar useStyles = makeStyles(function (theme) {\n  return {\n    formControl: {\n      margin: theme.spacing(1),\n      minWidth: 120,\n      fullWidth: true\n    },\n    selectEmpty: {\n      marginTop: theme.spacing(2)\n    }\n  };\n});\nvar BUTTON = styled(Button)(_templateObject());\nvar liff = window.liff;\nvar BOX = styled.div(_templateObject2());\nvar leaves;\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleRoleChange\", function (event) {\n      try {\n        _this.setState({\n          role: event.target.value\n        }, function () {\n          if (event.target.value == \"substitute\") {\n            _this.getLeavesSub(_this.state.ubn, _this.state.name, _this.state.email, _this.state.idToken);\n          } else if (event.target.value == \"supervisor\") {\n            _this.getLeavesSuper(_this.state.ubn, _this.state.email, _this.state.idToken);\n          }\n        });\n      } catch (err) {\n        throw err;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStatusChange\", function (event) {\n      try {\n        _this.setState({\n          status: event.target.value\n        }, function () {\n          //console.log(event.target.value);\n          _this.globalSearch();\n        });\n      } catch (err) {\n        throw err;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"globalSearch\", function () {\n      try {\n        _this.setState({\n          loading: true\n        });\n\n        var role_select = _this.state.role;\n        var status_select = _this.state.status;\n\n        var filteredData = _this.state.data_origin.filter(function (value) {\n          if (role_select == \"substitute\") {\n            switch (status_select) {\n              case \"signed\":\n                return value.status != \"等待簽核\";\n\n              case \"not signed\":\n                return value.status == \"等待簽核\";\n\n              default:\n                throw 'Option not supported';\n            }\n          } else if (role_select == \"supervisor\") {\n            switch (status_select) {\n              case \"signed\":\n                return value.status == \"同意 (主管)\" || value.status == \"拒絕 (主管)\";\n\n              case \"not signed\":\n                return value.status == \"同意 (代理人)\";\n\n              default:\n                throw 'Option not supported';\n            }\n          }\n        });\n\n        _this.setState({\n          data: filteredData,\n          loading: false\n        });\n      } catch (err) {\n        throw err;\n      }\n    });\n\n    _this.state = {\n      data: null,\n      data_origin: null,\n      role: \"substitute\",\n      status: \"not signed\",\n      loading: true,\n      userId: null,\n      ubn: null,\n      idToken: null,\n      loading_button: false\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.liffInit();\n    }\n  }, {\n    key: \"liffInit\",\n    value: function liffInit() {\n      var _this2 = this;\n\n      try {\n        liff.init(function (data) {\n          var userId = data.context.userId;\n\n          _this2.setState({\n            userId: userId\n          });\n\n          var accessToken = liff.getAccessToken();\n          var URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n          var body = {\n            userId: userId\n          };\n          fetch(URL_CHECKEXIST, {\n            method: 'post',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: _JSON$stringify(body)\n          }).then(function (res) {\n            return res.text();\n          }).then(function (result) {\n            if (result) {\n              _this2.lineAuth(userId, accessToken);\n            } else {\n              alert(\"請登入以查看假單\");\n              window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n            }\n          });\n        }, function (err) {\n          alert(\"error\");\n        });\n      } catch (err) {\n        throw err;\n      }\n    }\n  }, {\n    key: \"lineAuth\",\n    value: function lineAuth(userId, accessToken) {\n      var _this3 = this;\n\n      try {\n        var url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n        var body = {\n          userId: userId,\n          accessToken: accessToken\n        };\n        fetch(url, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          if (result) {\n            var ubn = result.staff.ubn;\n            var email = result.staff.email;\n            var name = result.staff.name;\n            var idToken = result.token.idToken;\n\n            _this3.setState({\n              ubn: ubn,\n              name: name,\n              email: email,\n              idToken: idToken\n            });\n\n            if (_this3.state.role == \"substitute\") {\n              _this3.getLeavesSub(_this3.state.ubn, _this3.state.name, _this3.state.email, _this3.state.idToken);\n            } else if (_this3.state.role == \"supervisor\") {\n              _this3.getLeavesSuper(_this3.state.ubn, _this3.state.email, _this3.state.idToken);\n            }\n          } else {\n            alert(\"lineAuth no result\");\n          }\n        })[\"catch\"](function (error) {\n          alert(error.message);\n        });\n      } catch (err) {\n        throw err;\n      }\n    }\n  }, {\n    key: \"getLeavesSub\",\n    value: function getLeavesSub(ubn, name, email, idToken) {\n      var _this4 = this;\n\n      try {\n        this.setState({\n          loading: true\n        });\n        var URL_GETLEAVES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n        var url = URL_GETLEAVES + \"?ubn=\".concat(ubn, \"&query=substitute&value={\\\"name\\\":\\\"\").concat(name, \"\\\",\\\"email\\\":\\\"\").concat(email, \"\\\"}\");\n        var header = {\n          Authorization: idToken\n        };\n        fetch(url, {\n          method: 'get',\n          headers: header\n        }).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          if (result) {\n            _this4.convertData(result.list);\n          } else {\n            alert(\"getLeavesSub no result\");\n          }\n        })[\"catch\"](function (error) {\n          alert(error.message);\n        });\n      } catch (err) {\n        throw err;\n      }\n    }\n  }, {\n    key: \"getLeavesSuper\",\n    value: function getLeavesSuper(ubn, email, idToken) {\n      var _this5 = this;\n\n      try {\n        this.setState({\n          loading: true\n        });\n        var URL_GETLEAVES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n        var url = URL_GETLEAVES + \"?ubn=\".concat(ubn, \"&query=supervisor&value=\").concat(email);\n        var header = {\n          Authorization: idToken\n        };\n        fetch(url, {\n          method: 'get',\n          headers: header\n        }).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          if (result) {\n            _this5.convertData(result.list);\n          } else {\n            alert(\"getLeavesSuper no result\");\n          }\n        })[\"catch\"](function (error) {\n          alert(error.message);\n        });\n      } catch (err) {\n        throw err;\n      }\n    }\n  }, {\n    key: \"convertData\",\n    value: function convertData(list) {\n      try {\n        var newList = [];\n\n        for (var i = 0; i < list.length; i++) {\n          var data = {\n            \"id\": list[i].id,\n            \"startDate\": list[i].startDate,\n            \"endDate\": list[i].endDate,\n            \"leaveType\": list[i].leaveType,\n            \"substitute\": JSON.parse(list[i].substitute).name,\n            \"status\": list[i].status,\n            \"leaveReason\": list[i].leaveReason,\n            \"rejectReason\": list[i].rejectReason\n          };\n          newList.push(data);\n        }\n\n        this.setState({\n          data_origin: newList\n        });\n        this.globalSearch();\n      } catch (err) {\n        throw err;\n      }\n    }\n  }, {\n    key: \"approveLeave\",\n\n    /*\n    getStaff (Authorization, ubn, email) {\n      try {\n        const URL_GETSTAFF = `https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/target?email=${email}&ubn=${ubn}`;\n        fetch(URL_GETSTAFF, {\n            method: 'get',\n            headers: {\n                \"Authorization\": Authorization\n            }\n        }).then((res) => {\n            if(res.ok) {\n                return res.json();  \n            }\n            throw new Error('getStaff response was not ok.');\n        }).then(result => {\n            this.getDepartment(Authorization, ubn, result.department);\n        }).catch(function (error) {\n            alert(error.message);\n        })\n      } catch (err) {\n            next(err);\n      }\n    }\n     getStaff_super (Authorization, ubn, email) {\n      try {\n        const URL_GETSTAFF = `https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/target?email=${email}&ubn=${ubn}`;\n        fetch(URL_GETSTAFF, {\n            method: 'get',\n            headers: {\n                \"Authorization\": Authorization\n            }\n        }).then((res) => {\n            if(res.ok) {\n                return res.json();  \n            }\n            throw new Error('getStaff response was not ok.');\n        }).then(result => {\n          const message_super = {\n            \"type\": \"flex\",\n            \"altText\": \"[主管] 是否批准假單？\",\n            \"contents\": {\n              \"type\": \"bubble\",\n              \"styles\": {},\n              \"body\": {\n                \"type\": \"box\",\n                \"layout\": \"vertical\",\n                \"contents\": [\n                  {\n                    \"type\": \"text\",\n                    \"text\": \"主管\",\n                    \"weight\": \"bold\",\n                    \"color\": \"#1DB446\",\n                    \"size\": \"sm\"\n                  },\n                  {\n                    \"type\": \"text\",\n                    \"text\": \"是否批准假單？\",\n                    \"weight\": \"bold\",\n                    \"size\": \"xxl\",\n                    \"margin\": \"md\"\n                  },\n                  {\n                    \"type\": \"separator\",\n                    \"margin\": \"xxl\"\n                  },\n                  {\n                    \"type\": \"box\",\n                    \"layout\": \"vertical\",\n                    \"margin\": \"xxl\",\n                    \"spacing\": \"sm\",\n                    \"contents\": [\n                      {\n                        \"type\": \"box\",\n                        \"layout\": \"horizontal\",\n                        \"contents\": [\n                          {\n                            \"type\": \"text\",\n                            \"text\": \"請假者\",\n                            \"size\": \"sm\",\n                            \"color\": \"#555555\"\n                          },\n                          {\n                            \"type\": \"text\",\n                            \"text\": selfStaff.name,\n                            \"size\": \"sm\",\n                            \"color\": \"#111111\",\n                            \"align\": \"end\"\n                          }\n                        ]\n                      },\n                      {\n                        \"type\": \"separator\",\n                        \"margin\": \"xxl\"\n                      },\n                      {\n                        \"type\": \"box\",\n                        \"layout\": \"horizontal\",\n                        \"margin\": \"xxl\",\n                        \"contents\": [\n                          {\n                            \"type\": \"text\",\n                            \"text\": \"開始日期\",\n                            \"size\": \"sm\",\n                            \"color\": \"#555555\"\n                          },\n                          {\n                            \"type\": \"text\",\n                            \"text\": this.state.leave.startDate,\n                            \"size\": \"sm\",\n                            \"color\": \"#111111\",\n                            \"align\": \"end\"\n                          }\n                        ]\n                      },\n                      {\n                        \"type\": \"box\",\n                        \"layout\": \"horizontal\",\n                        \"contents\": [\n                          {\n                            \"type\": \"text\",\n                            \"text\": \"結束日期\",\n                            \"size\": \"sm\",\n                            \"color\": \"#555555\",\n                            \"flex\": 0\n                          },\n                          {\n                            \"type\": \"text\",\n                            \"text\": this.state.leave.endDate,\n                            \"size\": \"sm\",\n                            \"color\": \"#111111\",\n                            \"align\": \"end\"\n                          }\n                        ]\n                      },\n                      {\n                        \"type\": \"separator\",\n                        \"margin\": \"xxl\"\n                      },\n                      {\n                        \"type\": \"box\",\n                        \"layout\": \"horizontal\",\n                        \"margin\": \"xxl\",\n                        \"contents\": [\n                          {\n                            \"type\": \"text\",\n                            \"text\": \"假別\",\n                            \"size\": \"sm\",\n                            \"color\": \"#555555\"\n                          },\n                          {\n                            \"type\": \"text\",\n                            \"text\": this.state.leave.leaveType,\n                            \"size\": \"sm\",\n                            \"color\": \"#111111\",\n                            \"align\": \"end\"\n                          }\n                        ]\n                      },\n                      {\n                        \"type\": \"box\",\n                        \"layout\": \"horizontal\",\n                        \"contents\": [\n                          {\n                            \"type\": \"text\",\n                            \"text\": \"請假原因\",\n                            \"size\": \"sm\",\n                            \"color\": \"#555555\"\n                          },\n                          {\n                            \"type\": \"text\",\n                            \"text\": this.state.leave.leaveReason,\n                            \"size\": \"sm\",\n                            \"color\": \"#111111\",\n                            \"align\": \"end\"\n                          }\n                        ]\n                      },\n                      {\n                        \"type\": \"box\",\n                        \"layout\": \"horizontal\",\n                        \"contents\": [\n                          {\n                            \"type\": \"text\",\n                            \"text\": \"代理人\",\n                            \"size\": \"sm\",\n                            \"color\": \"#555555\"\n                          },\n                          {\n                            \"type\": \"text\",\n                            \"text\": substituteInfo.name,\n                            \"size\": \"sm\",\n                            \"color\": \"#111111\",\n                            \"align\": \"end\"\n                          }\n                        ]\n                      }\n                    ]\n                  },\n                  {\n                    \"type\": \"separator\",\n                    \"margin\": \"xxl\"\n                  },\n                  {\n                    \"type\": \"box\",\n                    \"layout\": \"horizontal\",\n                    \"margin\": \"md\",\n                    \"contents\": [\n                      {\n                        \"type\": \"box\",\n                        \"layout\": \"vertical\",\n                        \"margin\": \"md\",\n                        \"contents\": [\n                          {\n                            \"type\": \"button\",\n                            \"style\": \"secondary\",\n                            \"height\": \"sm\",\n                            \"action\": {\n                              \"type\": \"uri\",\n                              \"label\": \"拒絕\",\n                              \"uri\": `line://app/1596565799-A57K2l04?ubn=${ubn}&leaveId=${this.state.leave.id}`\n                            }\n                          }\n                        ]\n                      },\n                      {\n                        \"type\": \"box\",\n                        \"layout\": \"vertical\",\n                        \"margin\": \"md\",\n                        \"contents\": [\n                          {\n                            \"type\": \"button\",\n                            \"style\": \"secondary\",\n                            \"height\": \"sm\",\n                            \"action\": {\n                              \"type\": \"postback\",\n                              \"label\": \"批准\",\n                              \"data\": `action=同意&role=主管&ubn=${ubn}&leaveId=${this.state.leave.id}`,\n                              \"text\": \"批准\"\n                            }\n                          }\n                        ]\n                      }\n                    ]\n                  }\n                ]\n              }\n            }\n      };\n            this.pushMessage()\n        }).catch(function (error) {\n            alert(error.message);\n        })\n      } catch (err) {\n            next(err);\n      }\n    }\n     getDepartment (Authorization, ubn, departmentId) {\n      try {\n        const URL_GETDEPARTMENT = `https://us-central1-teddybear-dev.cloudfunctions.net/api/department/target?departmentId=${departmentId}&ubn=${ubn}`;\n        fetch(URL_GETDEPARTMENT, {\n            method: 'get',\n            headers: {\n                \"Authorization\": Authorization\n            }\n        }).then((res) => {\n            if(res.ok) {\n                return res.json();  \n            }\n            throw new Error('getDepartment response was not ok.');\n        }).then(result => {\n            this.getStaff_super(ubn, result.supervisor)\n        }).catch(function (error) {\n            alert(error.message);\n        })\n      } catch (err) {\n            next(err);\n      }\n    }\n    \n    updateLeave (ubn, leaveId, updateData, action, role) {\n      try {\n        const URL_UPDATELEAVE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/update\";\n        fetch(URL_UPDATELEAVE, {\n            method: 'post',\n            headers: {\n                \"Authorization\": this.state.Authorization,\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(updateData)\n        }).then((res) => {\n            if(res.ok) {\n                return res.json();  \n            }\n            throw new Error('updateLeave response was not ok.');\n        }).then(result => {\n            this.setState({\n              leave: result\n            })\n            const substituteInfo = JSON.parse(result.substitute);\n            if (action == \"approve\") {\n              if (role == \"substitute\") {\n                const message_self = {\n                  \"type\": \"flex\",\n                  \"altText\": \"代理人已批准假單\",\n                  \"contents\": {\n                      \"type\": \"bubble\",\n                      \"styles\": {\n                      \"footer\": {\n                          \"separator\": true\n                      }\n                      },\n                      \"body\": {\n                      \"type\": \"box\",\n                      \"layout\": \"vertical\",\n                      \"contents\": [\n                          {\n                          \"type\": \"text\",\n                          \"text\": \"代理人\",\n                          \"weight\": \"bold\",\n                          \"color\": \"#1DB446\",\n                          \"size\": \"sm\"\n                          },\n                          {\n                          \"type\": \"text\",\n                          \"text\": \"已批准假單\",\n                          \"weight\": \"bold\",\n                          \"size\": \"xxl\",\n                          \"margin\": \"md\"\n                          },\n                          {\n                          \"type\": \"separator\",\n                          \"margin\": \"xxl\"\n                          },\n                          {\n                          \"type\": \"box\",\n                          \"layout\": \"vertical\",\n                          \"margin\": \"xxl\",\n                          \"spacing\": \"sm\",\n                          \"contents\": [\n                              {\n                              \"type\": \"box\",\n                              \"layout\": \"horizontal\",\n                              \"contents\": [\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": \"開始日期\",\n                                  \"size\": \"sm\",\n                                  \"color\": \"#555555\",\n                                  \"flex\": 0\n                                  },\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": result.startDate,\n                                  \"size\": \"sm\",\n                                  \"color\": \"#111111\",\n                                  \"align\": \"end\"\n                                  }\n                              ]\n                              },\n                              {\n                              \"type\": \"box\",\n                              \"layout\": \"horizontal\",\n                              \"contents\": [\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": \"結束日期\",\n                                  \"size\": \"sm\",\n                                  \"color\": \"#555555\",\n                                  \"flex\": 0\n                                  },\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": result.endDate,\n                                  \"size\": \"sm\",\n                                  \"color\": \"#111111\",\n                                  \"align\": \"end\"\n                                  }\n                              ]\n                              },\n                              {\n                              \"type\": \"separator\",\n                              \"margin\": \"xxl\"\n                              },\n                              {\n                              \"type\": \"box\",\n                              \"layout\": \"horizontal\",\n                              \"margin\": \"xxl\",\n                              \"contents\": [\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": \"假別\",\n                                  \"size\": \"sm\",\n                                  \"color\": \"#555555\"\n                                  },\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": result.leaveType,\n                                  \"size\": \"sm\",\n                                  \"color\": \"#111111\",\n                                  \"align\": \"end\"\n                                  }\n                              ]\n                              },\n                              {\n                              \"type\": \"box\",\n                              \"layout\": \"horizontal\",\n                              \"contents\": [\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": \"請假原因\",\n                                  \"size\": \"sm\",\n                                  \"color\": \"#555555\"\n                                  },\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": result.leaveReason,\n                                  \"size\": \"sm\",\n                                  \"color\": \"#111111\",\n                                  \"align\": \"end\"\n                                  }\n                              ]\n                              },\n                              {\n                              \"type\": \"box\",\n                              \"layout\": \"horizontal\",\n                              \"contents\": [\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": \"代理人\",\n                                  \"size\": \"sm\",\n                                  \"color\": \"#555555\"\n                                  },\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": substituteInfo.name,\n                                  \"size\": \"sm\",\n                                  \"color\": \"#111111\",\n                                  \"align\": \"end\"\n                                  }\n                              ]\n                              }\n                          ]\n                          },\n                          {\n                          \"type\": \"separator\",\n                          \"margin\": \"xxl\"\n                          },\n                          {\n                          \"type\": \"box\",\n                          \"layout\": \"horizontal\",\n                          \"margin\": \"md\",\n                          \"contents\": [\n                              {\n                              \"type\": \"text\",\n                              \"text\": \"簽核狀態\",\n                              \"size\": \"xs\",\n                              \"color\": \"#555555\",\n                              \"flex\": 0\n                              },\n                              {\n                              \"type\": \"text\",\n                              \"text\": \"同意(代理人)\",\n                              \"color\": \"#1DB446\",\n                              \"size\": \"xs\",\n                              \"align\": \"end\"\n                              }\n                          ]\n                          }\n                      ]\n                      }\n                  }\n                };\n                // send message to supervisor\n               } else if (role == \"supervisor\") {\n                const message_self = {\n                  \"type\": \"flex\",\n                  \"altText\": \"主管已批准假單\",\n                  \"contents\": {\n                      \"type\": \"bubble\",\n                      \"styles\": {\n                      \"footer\": {\n                          \"separator\": true\n                      }\n                      },\n                      \"body\": {\n                      \"type\": \"box\",\n                      \"layout\": \"vertical\",\n                      \"contents\": [\n                          {\n                          \"type\": \"text\",\n                          \"text\": \"主管\",\n                          \"weight\": \"bold\",\n                          \"color\": \"#1DB446\",\n                          \"size\": \"sm\"\n                          },\n                          {\n                          \"type\": \"text\",\n                          \"text\": \"已批准假單\",\n                          \"weight\": \"bold\",\n                          \"size\": \"xxl\",\n                          \"margin\": \"md\"\n                          },\n                          {\n                          \"type\": \"separator\",\n                          \"margin\": \"xxl\"\n                          },\n                          {\n                          \"type\": \"box\",\n                          \"layout\": \"vertical\",\n                          \"margin\": \"xxl\",\n                          \"spacing\": \"sm\",\n                          \"contents\": [\n                              {\n                              \"type\": \"box\",\n                              \"layout\": \"horizontal\",\n                              \"contents\": [\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": \"開始日期\",\n                                  \"size\": \"sm\",\n                                  \"color\": \"#555555\",\n                                  \"flex\": 0\n                                  },\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": result.startDate,\n                                  \"size\": \"sm\",\n                                  \"color\": \"#111111\",\n                                  \"align\": \"end\"\n                                  }\n                              ]\n                              },\n                              {\n                              \"type\": \"box\",\n                              \"layout\": \"horizontal\",\n                              \"contents\": [\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": \"結束日期\",\n                                  \"size\": \"sm\",\n                                  \"color\": \"#555555\",\n                                  \"flex\": 0\n                                  },\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": result.endDate,\n                                  \"size\": \"sm\",\n                                  \"color\": \"#111111\",\n                                  \"align\": \"end\"\n                                  }\n                              ]\n                              },\n                              {\n                              \"type\": \"separator\",\n                              \"margin\": \"xxl\"\n                              },\n                              {\n                              \"type\": \"box\",\n                              \"layout\": \"horizontal\",\n                              \"margin\": \"xxl\",\n                              \"contents\": [\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": \"假別\",\n                                  \"size\": \"sm\",\n                                  \"color\": \"#555555\"\n                                  },\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": result.leaveType,\n                                  \"size\": \"sm\",\n                                  \"color\": \"#111111\",\n                                  \"align\": \"end\"\n                                  }\n                              ]\n                              },\n                              {\n                              \"type\": \"box\",\n                              \"layout\": \"horizontal\",\n                              \"contents\": [\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": \"請假原因\",\n                                  \"size\": \"sm\",\n                                  \"color\": \"#555555\"\n                                  },\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": result.leaveReason,\n                                  \"size\": \"sm\",\n                                  \"color\": \"#111111\",\n                                  \"align\": \"end\"\n                                  }\n                              ]\n                              },\n                              {\n                              \"type\": \"box\",\n                              \"layout\": \"horizontal\",\n                              \"contents\": [\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": \"代理人\",\n                                  \"size\": \"sm\",\n                                  \"color\": \"#555555\"\n                                  },\n                                  {\n                                  \"type\": \"text\",\n                                  \"text\": substituteInfo.name,\n                                  \"size\": \"sm\",\n                                  \"color\": \"#111111\",\n                                  \"align\": \"end\"\n                                  }\n                              ]\n                              }\n                          ]\n                          },\n                          {\n                          \"type\": \"separator\",\n                          \"margin\": \"xxl\"\n                          },\n                          {\n                          \"type\": \"box\",\n                          \"layout\": \"horizontal\",\n                          \"margin\": \"md\",\n                          \"contents\": [\n                              {\n                              \"type\": \"text\",\n                              \"text\": \"簽核狀態\",\n                              \"size\": \"xs\",\n                              \"color\": \"#555555\",\n                              \"flex\": 0\n                              },\n                              {\n                              \"type\": \"text\",\n                              \"text\": \"同意(主管)\",\n                              \"color\": \"#1DB446\",\n                              \"size\": \"xs\",\n                              \"align\": \"end\"\n                              }\n                          ]\n                          }\n                      ]\n                      }\n                  }\n                };\n              }\n            } else if (action == \"reject\") {\n             }\n             this.pushMessage(this.state.userId, [messages_self]);\n        }).catch(function (error) {\n            alert(error.message);\n        })\n      } catch (err) {\n            next(err);\n      }\n    }\n     approveLeave (ubn, leaveId, role) {\n      try {\n        if (role == \"substitute\") {\n          var updateData = {\n            \"status\": \"同意 (代理人)\"\n          }\n        } else if (role == \"supervisor\") {\n          var updateData = {\n            \"status\": \"同意 (主管)\"\n          }\n        }\n        const result = await updateLeave(ubn, leaveId, updateData, \"approve\", role);\n         const URL_CREATELEAVE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/create\";\n        fetch(URL_CREATELEAVE, {\n          method: 'post',\n          headers: {\n            \"Authorization\": this.state.Authorization,\n            \"ubn\": this.state.ubn,\n            \"userId\": this.state.userId,\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify(values)\n        }).then((res) => {\n          return res.text();\n        }).then(result => {\n          if (result) {\n           } else {\n              alert(\"approveLeave error\");\n          }\n        }).catch(function (error) {\n          alert(error.message);\n        })\n      } catch (err) {\n        next(err);\n      }\n    }\n    */\n    value: function approveLeave(Authorization, ubn, leaveId, role) {\n      try {\n        if (role == \"substitute\") {\n          var URL_APPROVELEAVESUB = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/message/approveLeaveSub\";\n          var body = {\n            ubn: ubn,\n            leaveId: leaveId\n          };\n          fetch(URL_APPROVELEAVESUB, {\n            method: 'post',\n            headers: {\n              \"Authorization\": Authorization,\n              \"Content-Type\": \"application/json\"\n            },\n            body: _JSON$stringify(body)\n          }).then(function (res) {\n            return res.json();\n          }).then(function (result) {\n            if (result) {} else {\n              alert(\"approveLeave error\");\n            }\n          });\n        } else if (role == \"supervisor\") {\n          var URL_APPROVELEAVESUPER = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/message/approveLeaveSuper\";\n          var _body = {\n            ubn: ubn,\n            leaveId: leaveId\n          };\n          fetch(URL_APPROVELEAVESUPER, {\n            method: 'post',\n            headers: {\n              \"Authorization\": Authorization,\n              \"Content-Type\": \"application/json\"\n            },\n            body: _JSON$stringify(_body)\n          }).then(function (res) {\n            return res.json();\n          }).then(function (result) {\n            if (result) {} else {\n              alert(\"approveLeave error\");\n            }\n          });\n        }\n      } catch (err) {\n        next(err);\n      }\n    }\n  }, {\n    key: \"updateLeave\",\n    value: function updateLeave(Authorization, ubn, leaveId, role, rejectReason) {\n      var _this6 = this;\n\n      try {\n        var URL_UPDATELEAVE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/update\";\n        var values = {\n          ubn: ubn,\n          leaveId: leaveId,\n          rejectReason: rejectReason\n        };\n\n        if (role == \"substitute\") {\n          values.status = \"拒絕 (代理人)\";\n        } else if (role == \"supervisor\") {\n          values.status = \"拒絕 (主管)\";\n        }\n\n        fetch(URL_UPDATELEAVE, {\n          method: 'post',\n          headers: {\n            \"Authorization\": Authorization,\n            \"Content-Type\": \"application/json\"\n          },\n          body: _JSON$stringify(values)\n        }).then(function (res) {\n          if (res.ok) {\n            return res.json();\n          }\n\n          throw new Error('updateLeave response was not ok.');\n        }).then(function (result) {\n          var substituteInfo = JSON.parse(result.substitute);\n          var messages_self = {\n            \"type\": \"flex\",\n            \"altText\": \"代理人已拒絕假單\",\n            \"contents\": {\n              \"type\": \"bubble\",\n              \"styles\": {},\n              \"body\": {\n                \"type\": \"box\",\n                \"layout\": \"vertical\",\n                \"contents\": [{\n                  \"type\": \"text\",\n                  \"text\": \"代理人\",\n                  \"weight\": \"bold\",\n                  \"color\": \"#1DB446\",\n                  \"size\": \"sm\"\n                }, {\n                  \"type\": \"text\",\n                  \"text\": \"已拒絕假單\",\n                  \"weight\": \"bold\",\n                  \"size\": \"xxl\",\n                  \"margin\": \"md\"\n                }, {\n                  \"type\": \"separator\",\n                  \"margin\": \"xxl\"\n                }, {\n                  \"type\": \"box\",\n                  \"layout\": \"vertical\",\n                  \"margin\": \"xxl\",\n                  \"spacing\": \"sm\",\n                  \"contents\": [{\n                    \"type\": \"box\",\n                    \"layout\": \"horizontal\",\n                    \"contents\": [{\n                      \"type\": \"text\",\n                      \"text\": \"開始日期\",\n                      \"size\": \"sm\",\n                      \"color\": \"#555555\"\n                    }, {\n                      \"type\": \"text\",\n                      \"text\": result.startDate,\n                      \"size\": \"sm\",\n                      \"color\": \"#111111\",\n                      \"align\": \"end\"\n                    }]\n                  }, {\n                    \"type\": \"box\",\n                    \"layout\": \"horizontal\",\n                    \"contents\": [{\n                      \"type\": \"text\",\n                      \"text\": \"結束日期\",\n                      \"size\": \"sm\",\n                      \"color\": \"#555555\"\n                    }, {\n                      \"type\": \"text\",\n                      \"text\": result.endDate,\n                      \"size\": \"sm\",\n                      \"color\": \"#111111\",\n                      \"align\": \"end\"\n                    }]\n                  }, {\n                    \"type\": \"separator\",\n                    \"margin\": \"xxl\"\n                  }, {\n                    \"type\": \"box\",\n                    \"layout\": \"horizontal\",\n                    \"margin\": \"xxl\",\n                    \"contents\": [{\n                      \"type\": \"text\",\n                      \"text\": \"假別\",\n                      \"size\": \"sm\",\n                      \"color\": \"#555555\"\n                    }, {\n                      \"type\": \"text\",\n                      \"text\": result.leaveType,\n                      \"size\": \"sm\",\n                      \"color\": \"#111111\",\n                      \"align\": \"end\"\n                    }]\n                  }, {\n                    \"type\": \"box\",\n                    \"layout\": \"horizontal\",\n                    \"contents\": [{\n                      \"type\": \"text\",\n                      \"text\": \"請假原因\",\n                      \"size\": \"sm\",\n                      \"color\": \"#555555\"\n                    }, {\n                      \"type\": \"text\",\n                      \"text\": result.leaveReason,\n                      \"size\": \"sm\",\n                      \"color\": \"#111111\",\n                      \"align\": \"end\"\n                    }]\n                  }, {\n                    \"type\": \"box\",\n                    \"layout\": \"horizontal\",\n                    \"contents\": [{\n                      \"type\": \"text\",\n                      \"text\": \"代理人\",\n                      \"size\": \"sm\",\n                      \"color\": \"#555555\"\n                    }, {\n                      \"type\": \"text\",\n                      \"text\": substituteInfo.name,\n                      \"size\": \"sm\",\n                      \"color\": \"#111111\",\n                      \"align\": \"end\"\n                    }]\n                  }]\n                }, {\n                  \"type\": \"separator\",\n                  \"margin\": \"xxl\"\n                }, {\n                  \"type\": \"box\",\n                  \"layout\": \"horizontal\",\n                  \"margin\": \"md\",\n                  \"contents\": [{\n                    \"type\": \"text\",\n                    \"text\": \"簽核狀態\",\n                    \"size\": \"xs\",\n                    \"color\": \"#555555\"\n                  }, {\n                    \"type\": \"text\",\n                    \"text\": \"拒絕(代理人)\",\n                    \"color\": \"#ff0000\",\n                    \"size\": \"xs\",\n                    \"align\": \"end\"\n                  }]\n                }, {\n                  \"type\": \"box\",\n                  \"layout\": \"horizontal\",\n                  \"margin\": \"md\",\n                  \"contents\": [{\n                    \"type\": \"text\",\n                    \"text\": \"拒絕原因\",\n                    \"size\": \"xs\",\n                    \"color\": \"#555555\"\n                  }, {\n                    \"type\": \"text\",\n                    \"text\": result.rejectReason,\n                    \"color\": \"#111111\",\n                    \"size\": \"xs\",\n                    \"align\": \"end\"\n                  }]\n                }]\n              }\n            }\n          };\n          ;\n\n          _this6.getStaff(Authorization, ubn, result.email, messages_self); //this.pushMessage(this.state.userId_self, [messages_self]);\n\n        })[\"catch\"](function (error) {\n          alert(error.message);\n        });\n      } catch (err) {\n        next(err);\n      }\n    }\n  }, {\n    key: \"getStaff\",\n    value: function getStaff(Authorization, ubn, email, messages) {\n      var _this7 = this;\n\n      try {\n        var URL_GETSTAFF = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/target?email=\".concat(email, \"&ubn=\").concat(ubn);\n        fetch(URL_GETSTAFF, {\n          method: 'get',\n          headers: {\n            \"Authorization\": Authorization\n          }\n        }).then(function (res) {\n          if (res.ok) {\n            return res.json();\n          }\n\n          throw new Error('getStaff response was not ok.');\n        }).then(function (result) {\n          _this7.pushMessage(result.userId, [messages]);\n        });\n      } catch (err) {\n        next(err);\n      }\n    }\n  }, {\n    key: \"pushMessage\",\n    value: function pushMessage(userId, messages) {\n      try {\n        var URL_PUSHMESSAGE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/message/pushMessage\";\n        var body = {\n          userId: userId,\n          messages: messages\n        };\n        fetch(URL_PUSHMESSAGE, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(function (res) {\n          if (res.ok) {\n            return res.json();\n          }\n\n          throw new Error('pushMessage response was not ok.');\n        });\n      } catch (err) {\n        next(err);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this8 = this;\n\n      var MyLoader = function MyLoader() {\n        return __jsx(Loader, {\n          loading: _this8.state.loading\n        });\n      };\n\n      var columns = [{\n        Header: 'id',\n        accessor: 'id',\n        show: false\n      }, {\n        Header: '開始日期',\n        accessor: 'startDate',\n        width: 90\n      }, {\n        Header: '結束日期',\n        accessor: 'endDate',\n        width: 90\n      }, {\n        Header: '假勤類別',\n        accessor: 'leaveType',\n        width: 90\n      }, {\n        Header: '代理人',\n        accessor: 'substitute',\n        show: false\n      }, {\n        Header: '簽核狀態',\n        accessor: 'status',\n        width: 90\n      }, {\n        Header: '請假原因',\n        accessor: 'leaveReason',\n        show: false\n      }, {\n        Header: '拒絕原因',\n        accessor: 'rejectReason',\n        show: false\n      }];\n      var classes = useStyles;\n\n      function ButtonComponent(props) {\n        var _this9 = this;\n\n        var loading = props.loading,\n            id = props.id;\n        return __jsx(Button, {\n          variant: \"contained\",\n          disabled: loading,\n          fontFamily: \"Candara\",\n          color: \"secondary\",\n          onClick: function onClick() {\n            row.loading = true;\n\n            _this9.approveLeave(_this9.state.idToken, _this9.state.ubn, id, _this9.state.role).then(function () {\n              row.loading = false;\n            });\n          }\n        }, loading && __jsx(CircularProgress, {\n          size: 16\n        }), !loading && '批准!');\n      }\n\n      return __jsx(\"div\", null, __jsx(Head, null, __jsx(\"script\", {\n        src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n      })), __jsx(Grid, {\n        container: true,\n        spacing: 1\n      }, __jsx(Grid, {\n        item: true,\n        xs: 12\n      }, __jsx(Grid, {\n        container: true,\n        justify: \"center\",\n        spacing: 3\n      }, __jsx(Grid, {\n        key: 1,\n        item: true\n      }, __jsx(FormControl, {\n        margin: \"normal\",\n        style: {\n          minWidth: 150\n        }\n      }, __jsx(InputLabel, {\n        id: \"role-label\"\n      }, \"\\u7C3D\\u6838\\u8EAB\\u4EFD\"), __jsx(Select, {\n        labelId: \"role-label\",\n        id: \"role\",\n        value: this.state.role,\n        onChange: this.handleRoleChange\n      }, __jsx(MenuItem, {\n        value: \"substitute\"\n      }, \"\\u4EE3\\u7406\\u4EBA\"), __jsx(MenuItem, {\n        value: \"supervisor\"\n      }, \"\\u4E3B\\u7BA1\")))), __jsx(Grid, {\n        key: 2,\n        item: true\n      }, __jsx(FormControl, {\n        margin: \"normal\",\n        style: {\n          minWidth: 150\n        }\n      }, __jsx(InputLabel, {\n        id: \"status-label\"\n      }, \"\\u7C3D\\u6838\\u72C0\\u614B\"), __jsx(Select, {\n        labelId: \"status-label\",\n        id: \"status\",\n        value: this.state.status,\n        onChange: this.handleStatusChange\n      }, __jsx(MenuItem, {\n        value: \"not signed\"\n      }, \"\\u672A\\u7C3D\\u6838\"), __jsx(MenuItem, {\n        value: \"signed\"\n      }, \"\\u5DF2\\u7C3D\\u6838\")))), __jsx(Grid, {\n        key: 3,\n        item: true\n      }, __jsx(\"div\", null, this.state.data ? __jsx(ReactTable, {\n        LoadingComponent: MyLoader,\n        data: this.state.data,\n        columns: columns,\n        className: \"-striped -highlight\",\n        SubComponent: function SubComponent(row) {\n          row.loading = false;\n          return __jsx(\"div\", null, row.original.rejectReason ? __jsx(\"div\", {\n            style: {\n              padding: \"20px\"\n            }\n          }, \" \\u4EE3\\u7406\\u4EBA\\uFF1A\", row.original.substitute, \"\\xA0\\xA0\\xA0\\u62D2\\u7D55\\u539F\\u56E0\\uFF1A\", row.original.rejectReason, \" \") : __jsx(\"div\", {\n            style: {\n              padding: \"20px\"\n            }\n          }, \" \\u4EE3\\u7406\\u4EBA\\uFF1A\", row.original.substitute, \" \"), _this8.state.status == \"not signed\" ? __jsx(\"div\", null, __jsx(BUTTON, {\n            fontFamily: \"Candara\",\n            variant: \"contained\",\n            color: \"secondary\",\n            disabled: _this8.state.loading_button[row.original.id],\n            onClick: function onClick() {\n              alert(\"A\");\n\n              var loading = _this8.state.loading_button.slice();\n\n              alert(\"B\");\n              loading[row.original.id] = true;\n              alert(\"C\");\n\n              _this8.setState({\n                loading_button: loading\n              });\n\n              alert(\"D\");\n              alert(_this8.state.loading_button[row.original.id]); //this.setState({ loading_button: true });\n              //row.loading = true; \n              //this.approveLeave(this.state.idToken, this.state.ubn, row.original.id, this.state.role);\n\n              /*\n              this.approveLeave(this.state.idToken, this.state.ubn, row.original.id, this.state.role).then(()=>{\n                alert(\"A\");\n                row.loading = false;\n                alert(\"B\");\n              });  \n              */\n            }\n          }, _this8.state.loading_button[row.original.id] && __jsx(CircularProgress, {\n            size: 16\n          }), !_this8.state.loading_button[row.original.id] && '批准'), __jsx(BUTTON, {\n            fontFamily: \"Candara\",\n            variant: \"contained\",\n            color: \"secondary\",\n            disabled: _this8.state.loading_button,\n            onClick: function onClick() {\n              var rejectReason = prompt(\"請輸入拒絕原因\", \"\");\n\n              if (rejectReason != null && rejectReason != \"\") {\n                _this8.updateLeave(_this8.state.idToken, _this8.state.ubn, row.original.id, _this8.state.role, rejectReason);\n              }\n            }\n          }, \"\\u62D2\\u7D55\")) : __jsx(\"div\", null));\n        },\n        defaultPageSize: 10,\n        pageSizeOptions: [10, 15]\n      }) : __jsx(ReactTable, {\n        LoadingComponent: MyLoader,\n        data: leaves,\n        columns: columns,\n        defaultPageSize: 10,\n        pageSizeOptions: [10, 15]\n      })))))));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport { App as default };","map":null,"metadata":{},"sourceType":"module"}