{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/yan/ezbot-web/app/pages/viewSign.js\";\nvar __jsx = React.createElement;\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 5.5em auto;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport Head from 'next/head';\nimport React, { Component } from 'react';\nimport ReactTable from \"react-table\";\nimport styled from 'styled-components';\nimport \"react-table/react-table.css\";\nimport window from 'global';\nimport MonthPickerInput from 'react-month-picker-input';\nimport Loader from \"./loader\"; //import 'react-month-picker-input/dist/react-month-picker-input.css';\n//var MonthPickerInput = require('react-month-picker-input');\n\nrequire('react-month-picker-input/dist/react-month-picker-input.css');\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nvar useStyles = makeStyles(function (theme) {\n  return {\n    formControl: {\n      margin: theme.spacing(1),\n      minWidth: 120\n    },\n    selectEmpty: {\n      marginTop: theme.spacing(2)\n    }\n  };\n});\nvar liff = window.liff;\nvar BOX = styled.div(_templateObject());\nvar leaves;\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleChange\", function (event) {\n      try {\n        _this.setState({\n          role: event\n        }, function () {\n          //this.globalSearch();\n          if (event == \"substitute\") {\n            _this.getLeavesSub(_this.state.ubn, _this.state.name, _this.state.email, idToken);\n          }\n        });\n      } catch (err) {\n        throw err;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"globalSearch\", function () {\n      try {\n        var role = _this.state.role;\n        var date_array = role.split(\"/\");\n        var date_select = new Date(date_array[1], date_array[0]);\n        var year_select = date_select.getFullYear();\n        var month_select = date_select.getMonth();\n\n        var filteredData = _this.state.data_origin.filter(function (value) {\n          var date = new Date(value.startDate);\n          var year = date.getFullYear();\n          var month = date.getMonth() + 1;\n          return year === year_select && month === month_select;\n        });\n\n        _this.setState({\n          data: filteredData,\n          loading: false\n        });\n      } catch (err) {\n        throw err;\n      }\n    });\n\n    _this.state = {\n      data: null,\n      data_origin: null,\n      role: \"substitute\"\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.liffInit();\n    }\n  }, {\n    key: \"liffInit\",\n    value: function liffInit() {\n      var _this2 = this;\n\n      try {\n        liff.init(function (data) {\n          var userId = data.context.userId;\n          var accessToken = liff.getAccessToken();\n          var URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n          var body = {\n            userId: userId\n          };\n          fetch(URL_CHECKEXIST, {\n            method: 'post',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: _JSON$stringify(body)\n          }).then(function (res) {\n            return res.text();\n          }).then(function (result) {\n            if (result) {\n              _this2.lineAuth(userId, accessToken);\n            } else {\n              alert(\"請登入以查看假單\");\n              window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n            }\n          });\n        }, function (err) {\n          alert(\"error\");\n        });\n      } catch (err) {\n        throw err;\n      }\n    }\n  }, {\n    key: \"lineAuth\",\n    value: function lineAuth(userId, accessToken) {\n      var _this3 = this;\n\n      try {\n        var url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n        var body = {\n          userId: userId,\n          accessToken: accessToken\n        };\n        fetch(url, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          if (result) {\n            var ubn = result.staff.ubn;\n            var email = result.staff.email;\n            var name = result.staff.name;\n            var _idToken = result.token.idToken; //this.getLeaves(ubn, email, idToken);\n            //this.getLeavesSub(ubn, name, email, idToken);\n            //this.getLeavesSuper(ubn, email, idToken);\n\n            _this3.setState({\n              ubn: ubn,\n              name: name,\n              email: email,\n              idToken: _idToken\n            });\n          } else {\n            alert(\"lineAuth no result\");\n          }\n        })[\"catch\"](function (error) {\n          alert(error.message);\n        });\n      } catch (err) {\n        throw err;\n      }\n    }\n  }, {\n    key: \"getLeavesSub\",\n    value: function getLeavesSub(ubn, name, email, idToken) {\n      var _this4 = this;\n\n      try {\n        var URL_GETLEAVES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n        var url = URL_GETLEAVES + \"?ubn=\".concat(ubn, \"&query=substitute&value={\\\"name\\\":\\\"\").concat(name, \"\\\",\\\"email\\\":\\\"\").concat(email, \"\\\"}\");\n        var header = {\n          Authorization: idToken\n        };\n        fetch(url, {\n          method: 'get',\n          headers: header\n        }).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          if (result) {\n            _this4.convertData(result.list);\n          } else {\n            alert(\"getLeavesSub no result\");\n          }\n        })[\"catch\"](function (error) {\n          alert(error.message);\n        });\n      } catch (err) {\n        throw err;\n      }\n    }\n  }, {\n    key: \"getLeavesSuper\",\n    value: function getLeavesSuper(ubn, email, idToken) {\n      var _this5 = this;\n\n      try {\n        var URL_GETLEAVES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n        var url = URL_GETLEAVES + \"?ubn=\".concat(ubn, \"&query=supervisor&value=\").concat(email);\n        var header = {\n          Authorization: idToken\n        };\n        fetch(url, {\n          method: 'get',\n          headers: header\n        }).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          if (result) {\n            _this5.convertData(result.list);\n          } else {\n            alert(\"getLeavesSuper no result\");\n          }\n        })[\"catch\"](function (error) {\n          alert(error.message);\n        });\n      } catch (err) {\n        throw err;\n      }\n    }\n  }, {\n    key: \"convertData\",\n    value: function convertData(list) {\n      try {\n        var newList = [];\n\n        for (var i = 0; i < list.length; i++) {\n          var data = {\n            \"startDate\": list[i].startDate,\n            \"endDate\": list[i].endDate,\n            \"leaveType\": list[i].leaveType,\n            \"substitute\": JSON.parse(list[i].substitute).name,\n            \"status\": list[i].status,\n            \"leaveReason\": list[i].leaveReason,\n            \"rejectReason\": list[i].rejectReason\n          };\n          newList.push(data);\n        }\n\n        this.setState({\n          data: newList,\n          data_origin: newList\n        });\n      } catch (err) {\n        throw err;\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var MyLoader = function MyLoader() {\n        return __jsx(Loader, {\n          loading: _this6.state.loading,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 241\n          },\n          __self: this\n        });\n      };\n\n      var months = ['Jan', 'Feb', 'Mar', 'Spr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\n      var makeText = function makeText(m) {\n        if (m && m.year && m.month) return months[m.month - 1] + '. ' + m.year;\n        return '?';\n      };\n\n      var mvalue = {\n        year: 2015,\n        month: 11\n      };\n      var columns = [{\n        Header: '開始日期',\n        accessor: 'startDate',\n        id: \"startDate\"\n      }, {\n        Header: '結束日期',\n        accessor: 'endDate'\n      }, {\n        Header: '假勤類別',\n        accessor: 'leaveType'\n      }, {\n        Header: '代理人',\n        accessor: 'substitute'\n      }, {\n        Header: '簽核狀態',\n        accessor: 'status'\n      }, {\n        Header: '請假原因',\n        accessor: 'leaveReason',\n        show: false\n      }, {\n        Header: '拒絕原因',\n        accessor: 'rejectReason',\n        show: false\n      }];\n      var classes = useStyles;\n      return __jsx(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 276\n        },\n        __self: this\n      }, __jsx(Head, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 277\n        },\n        __self: this\n      }, __jsx(\"script\", {\n        src: \"https://d.line-scdn.net/liff/1.0/sdk.js\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 278\n        },\n        __self: this\n      })), __jsx(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 280\n        },\n        __self: this\n      }, \"\\u5E74/\\u6708\"), __jsx(MonthPickerInput, {\n        onChange: this.handleChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281\n        },\n        __self: this\n      }), __jsx(FormControl, {\n        className: classes.formControl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 284\n        },\n        __self: this\n      }, __jsx(InputLabel, {\n        id: \"demo-simple-select-label\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285\n        },\n        __self: this\n      }, \"\\u7C3D\\u6838\\u8EAB\\u4EFD\"), __jsx(Select, {\n        labelId: \"demo-simple-select-label\",\n        id: \"demo-simple-select\",\n        value: this.state.role,\n        onChange: this.handleChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286\n        },\n        __self: this\n      }, __jsx(MenuItem, {\n        value: \"substitute\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292\n        },\n        __self: this\n      }, \"\\u4EE3\\u7406\\u4EBA\"), __jsx(MenuItem, {\n        value: \"supervisor\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293\n        },\n        __self: this\n      }, \"\\u4E3B\\u7BA1\"))), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 296\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 297\n        },\n        __self: this\n      }), __jsx(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }, this.state.data ? __jsx(ReactTable, {\n        data: this.state.data,\n        getTrProps: function getTrProps(state, rowInfo, column, instance) {\n          return {\n            onClick: function onClick(e) {\n              return alert(\"\\u958B\\u59CB\\u65E5\\u671F\\uFF1A\".concat(rowInfo.row.startDate, \"\\n\\u7D50\\u675F\\u65E5\\u671F\\uFF1A\").concat(rowInfo.row.endDate, \"\\n\\u5047\\u52E4\\u985E\\u5225\\uFF1A\").concat(rowInfo.row.leaveType, \"\\n\\u4EE3\\u7406\\u4EBA\\uFF1A\").concat(rowInfo.row.substitute, \"\\n\\u7C3D\\u6838\\u72C0\\u614B\\uFF1A\").concat(rowInfo.row.status, \"\\n\\u62D2\\u7D55\\u539F\\u56E0\\uFF1A\").concat(rowInfo.row.rejectReason));\n            }\n          };\n        },\n        columns: columns,\n        defaultPageSize: 10,\n        pageSizeOptions: [10, 15],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300\n        },\n        __self: this\n      }) : __jsx(ReactTable, {\n        LoadingComponent: MyLoader,\n        data: leaves,\n        columns: columns,\n        defaultPageSize: 10,\n        pageSizeOptions: [10, 15],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport { App as default };","map":{"version":3,"sources":["/Users/yan/ezbot-web/app/pages/viewSign.js"],"names":["Head","React","Component","ReactTable","styled","window","MonthPickerInput","Loader","require","makeStyles","InputLabel","MenuItem","FormHelperText","FormControl","Select","useStyles","theme","formControl","margin","spacing","minWidth","selectEmpty","marginTop","liff","BOX","div","leaves","App","props","event","setState","role","getLeavesSub","state","ubn","name","email","idToken","err","date_array","split","date_select","Date","year_select","getFullYear","month_select","getMonth","filteredData","data_origin","filter","value","date","startDate","year","month","data","loading","liffInit","init","userId","context","accessToken","getAccessToken","URL_CHECKEXIST","body","fetch","method","headers","then","res","text","result","lineAuth","alert","location","replace","url","json","staff","token","error","message","URL_GETLEAVES","header","Authorization","convertData","list","newList","i","length","endDate","leaveType","JSON","parse","substitute","status","leaveReason","rejectReason","push","MyLoader","months","makeText","m","mvalue","columns","Header","accessor","id","show","classes","handleChange","rowInfo","column","instance","onClick","e","row"],"mappings":"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","sourcesContent":["import Head from 'next/head';\nimport React, { Component } from 'react';\nimport ReactTable from \"react-table\";\nimport styled from 'styled-components';\nimport \"react-table/react-table.css\";\nimport window from 'global'\n\nimport MonthPickerInput from 'react-month-picker-input';\nimport Loader from \"./loader\";\n//import 'react-month-picker-input/dist/react-month-picker-input.css';\n//var MonthPickerInput = require('react-month-picker-input');\nrequire('react-month-picker-input/dist/react-month-picker-input.css');\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nconst useStyles = makeStyles(theme => ({\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: 120,\n  },\n  selectEmpty: {\n    marginTop: theme.spacing(2),\n  },\n}));\n\n\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\n\nvar leaves;\n\n\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data : null,\n      data_origin : null,\n      role : \"substitute\"\n    };\n  }\n\n  componentDidMount() {\n    this.liffInit();\n  }\n\n  liffInit() {\n    try {\n      liff.init(data => {\n        const userId = data.context.userId;\n        const accessToken = liff.getAccessToken();\n        const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n        const body = {\n          userId: userId\n        };\n        fetch(URL_CHECKEXIST, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(body)\n        }).then((res) => {\n          return res.text();\n        }).then(result => {\n          if (result) {\n              this.lineAuth(userId, accessToken);\n          } else {\n              alert(\"請登入以查看假單\");\n              window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n          }\n        })\n      }, err => {\n        alert(\"error\");\n      });\n    } catch (err) {\n      throw(err);\n    }\n  }\n  \n  lineAuth (userId, accessToken)  {\n    try {\n      const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n      const body = {\n          userId: userId,\n          accessToken: accessToken\n        };\n      fetch(url, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(body)\n        }).then((res) => {\n          return res.json();\n        }).then(result => {\n          if (result) {\n              const ubn = result.staff.ubn;\n              const email = result.staff.email;\n              const name = result.staff.name;\n              const idToken = result.token.idToken;\n              //this.getLeaves(ubn, email, idToken);\n              //this.getLeavesSub(ubn, name, email, idToken);\n              //this.getLeavesSuper(ubn, email, idToken);\n              this.setState({\n                ubn: ubn,\n                name: name,\n                email: email,\n                idToken: idToken\n              })\n          } else {\n              alert(\"lineAuth no result\");\n\n          }\n        }).catch(function (error) {\n          alert(error.message);\n        })\n      } catch (err) {\n        throw(err);\n      }\n  }\n\n  getLeavesSub (ubn, name, email, idToken) {\n    try {\n      const URL_GETLEAVES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n      const url = URL_GETLEAVES + `?ubn=${ubn}&query=substitute&value={\"name\":\"${name}\",\"email\":\"${email}\"}`;\n      const header = {\n          Authorization: idToken\n        };\n      fetch(url, {\n          method: 'get',\n          headers: header\n      }).then((res) => {\n          return res.json();\n      }).then(result => {\n          if (result) {\n            this.convertData(result.list);\n      } else {\n          alert(\"getLeavesSub no result\");\n      }\n      }).catch(function (error) {\n          alert(error.message);\n      })\n    } catch (err) {\n      throw(err);\n    }\n  }\n\n  getLeavesSuper (ubn, email, idToken) {\n    try {\n      const URL_GETLEAVES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n      const url = URL_GETLEAVES + `?ubn=${ubn}&query=supervisor&value=${email}`;\n      const header = {\n          Authorization: idToken\n        };\n      fetch(url, {\n          method: 'get',\n          headers: header\n      }).then((res) => {\n          return res.json();\n      }).then(result => {\n          if (result) {\n            this.convertData(result.list);\n      } else {\n          alert(\"getLeavesSuper no result\");\n      }\n      }).catch(function (error) {\n          alert(error.message);\n      })\n    } catch (err) {\n      throw(err);\n    }\n  }\n\n  convertData (list)  {\n    try {\n      var newList = [];\n      for (var i = 0; i < list.length; i++) {\n        const data = {\n          \"startDate\": list[i].startDate,\n          \"endDate\": list[i].endDate,\n          \"leaveType\": list[i].leaveType,\n          \"substitute\": JSON.parse(list[i].substitute).name,\n          \"status\": list[i].status,\n          \"leaveReason\": list[i].leaveReason,\n          \"rejectReason\": list[i].rejectReason\n        };\n        newList.push(data);\n      }\n      this.setState({\n        data: newList,\n        data_origin: newList\n      })\n    } catch (err) {\n      throw(err);\n    }\n  }\n\n  handleChange = event => {\n    try{\n      this.setState({ role: event }, () => {\n        //this.globalSearch();\n        if (event == \"substitute\") {\n          this.getLeavesSub(this.state.ubn, this.state.name, this.state.email, idToken);\n        }\n      });\n    } catch (err) {\n      throw(err);\n    }\n  };\n\n  globalSearch = () => {\n    try {\n      let { role } = this.state;\n      var date_array = role.split(\"/\");\n      var date_select = new Date(date_array[1], date_array[0]);\n      var year_select = date_select.getFullYear();\n      var month_select = date_select.getMonth();\n\n      let filteredData = this.state.data_origin.filter(value => {\n        var date = new Date(value.startDate);\n        var year = date.getFullYear();\n        var month = date.getMonth() + 1;\n        return (      \n          year === year_select &&\n          month === month_select  \n        );\n      });\n      this.setState({ data: filteredData, loading: false });\n    } catch (err) {\n      throw(err);\n    }\n  };\n  \n  render() {\n    const MyLoader = () => <Loader loading={this.state.loading} />;\n    let months = ['Jan', 'Feb', 'Mar', 'Spr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    let makeText = m => {\n      if (m && m.year && m.month) return (months[m.month-1] + '. ' + m.year)\n      return '?'\n    };\n    let mvalue = {year: 2015, month: 11};\n    const columns = [{\n      Header: '開始日期',\n      accessor: 'startDate',\n      id: \"startDate\",\n    },{\n      Header: '結束日期',\n      accessor: 'endDate'\n    },{\n      Header: '假勤類別',\n      accessor: 'leaveType'\n    },{\n      Header: '代理人',\n      accessor: 'substitute'\n    },{\n      Header: '簽核狀態',\n      accessor: 'status'\n    },{\n      Header: '請假原因',\n      accessor: 'leaveReason',\n      show: false\n    },{\n      Header: '拒絕原因',\n      accessor: 'rejectReason',\n      show: false\n    }];\n    const classes = useStyles;\n\n    return (\n      <div>\n        <Head>\n          <script src=\"https://d.line-scdn.net/liff/1.0/sdk.js\"></script>\n        </Head>\n        <p>年/月</p>\n        <MonthPickerInput \n          onChange={this.handleChange}\n        />\n        <FormControl className={classes.formControl}>\n          <InputLabel id=\"demo-simple-select-label\">簽核身份</InputLabel>\n          <Select\n            labelId=\"demo-simple-select-label\"\n            id=\"demo-simple-select\"\n            value={this.state.role}\n            onChange={this.handleChange}\n          >\n            <MenuItem value={\"substitute\"}>代理人</MenuItem>\n            <MenuItem value={\"supervisor\"}>主管</MenuItem>\n          </Select>\n        </FormControl>\n        <br></br>\n        <br></br>\n        <div>\n          {this.state.data ?\n            <ReactTable\n              data={this.state.data}\n              getTrProps={(state, rowInfo, column, instance) => ({\n                onClick: e => alert(\n              `開始日期：${rowInfo.row.startDate}\\n結束日期：${rowInfo.row.endDate}\\n假勤類別：${rowInfo.row.leaveType}\\n代理人：${rowInfo.row.substitute}\\n簽核狀態：${rowInfo.row.status}\\n拒絕原因：${rowInfo.row.rejectReason}`)\n              })}\n              columns={columns}\n              defaultPageSize = {10}\n              pageSizeOptions = {[10, 15]}\n            /> :\n            <ReactTable\n              LoadingComponent={MyLoader}\n              data={leaves}\n              columns={columns}\n              defaultPageSize = {10}\n              pageSizeOptions = {[10, 15]}\n            />\n          }\n        </div> \n      </div>    \n    );\n  }\n}\n\n"]},"metadata":{},"sourceType":"module"}