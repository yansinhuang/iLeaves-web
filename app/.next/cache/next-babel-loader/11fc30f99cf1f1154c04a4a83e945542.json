{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nvar __jsx = React.createElement;\n// Render Prop\nimport React, { Component } from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport Head from 'next/head';\nimport window from 'global';\nimport { Select } from 'material-ui-formik-components/Select';\nimport { DatePicker, MuiPickersUtilsProvider } from '@material-ui/pickers';\nimport LuxonUtils from '@date-io/luxon';\n\nrequire(\"react-datepicker/dist/react-datepicker.css\");\n\nvar dateFormat = require('dateformat');\n\nimport Loader from 'react-loader-spinner';\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\nimport Grid from '@material-ui/core/Grid';\nimport firebase from 'firebase';\nconst config = {\n  databaseUrl: 'https://teddybear-dev.firebaseio.com',\n  authUrl: 'https://identitytoolkit.googleapis.com/v1',\n  secureUrl: 'https://securetoken.googleapis.com/v1',\n  apiKey: 'AIzaSyDhqqn1bFuw7mpHKQDdRPQZrc2HfmKb-l8'\n};\nconst liff = window.liff;\nimport { BOX, TITLE, TEXT, CONTAINER, BUTTON, GlobalStyle } from './component';\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      userId: null,\n      email: null\n    };\n  }\n\n  componentDidMount() {\n    this.liffInit();\n  }\n\n  liffInit() {\n    try {\n      firebase.initializeApp(config);\n      liff.init(data => {\n        const userId = data.context.userId;\n        const accessToken = liff.getAccessToken();\n        const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n        const body = {\n          userId: userId\n        };\n        fetch(URL_CHECKEXIST, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(res => {\n          return res.text();\n        }).then(result => {\n          if (result) {\n            this.setState({\n              userId: userId\n            });\n            this.lineAuth(userId, accessToken);\n          } else {\n            alert(\"請登入\");\n            window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n          }\n        });\n      }, err => {\n        alert(err.message);\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  lineAuth(userId, accessToken) {\n    try {\n      const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n      const body = {\n        userId: userId,\n        accessToken: accessToken\n      };\n      fetch(url, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: _JSON$stringify(body)\n      }).then(res => {\n        return res.json();\n      }).then(result => {\n        if (result) {\n          const ubn = result.staff.ubn;\n          const department = result.staff.department;\n          const email = result.staff.email;\n          const idToken = result.token.idToken;\n          this.setState({\n            Authorization: idToken,\n            ubn: ubn,\n            email: email\n          });\n        } else {\n          alert(\"lineAuth no result\");\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  forgotPassword(email) {\n    try {\n      firebase.auth().sendPasswordResetEmail(email).then(function () {\n        alert('請查看信箱：' + email);\n        const messages = [{\n          type: \"text\",\n          text: \"已發送密碼重設信\"\n        }];\n        liff.sendMessages(messages);\n        liff.closeWindow();\n      });\n    } catch (err) {\n      alert(err);\n      next(err);\n    }\n  }\n\n  render() {\n    return __jsx(BOX, null, __jsx(Head, null, __jsx(\"script\", {\n      src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n    }), __jsx(\"script\", {\n      src: \"https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js\"\n    }), __jsx(\"link\", {\n      type: \"text/css\",\n      rel: \"stylesheet\",\n      href: \"https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css\"\n    })), __jsx(\"body\", {\n      style: {\n        background: '#34495E'\n      }\n    }, __jsx(BOX, null, this.state.email ? __jsx(Button, {\n      fontFamily: \"Candara\",\n      variant: \"contained\",\n      color: \"secondary\",\n      onClick: () => {\n        this.forgotPassword(this.state.email);\n      }\n    }, \"\\u767C\\u9001\\u5BC6\\u78BC\\u91CD\\u8A2D\\u4FE1\") : __jsx(LOADERBOX, null, __jsx(Loader, {\n      type: \"ThreeDots\",\n      color: \"#f50057\",\n      height: 80,\n      width: 80\n    })))));\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}