{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar __jsx = React.createElement;\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 5.5em auto;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport Head from 'next/head';\nimport React, { Component } from 'react';\nimport ReactTable from \"react-table\";\nimport styled from 'styled-components';\nimport \"react-table/react-table.css\";\nimport window from 'global';\nimport Geocode from \"react-geocode\";\nimport MonthPickerInput from 'react-month-picker-input';\nimport Loader from \"./loader\"; //import 'react-month-picker-input/dist/react-month-picker-input.css';\n//var MonthPickerInput = require('react-month-picker-input');\n\nrequire('react-month-picker-input/dist/react-month-picker-input.css');\n\nvar liff = window.liff;\nvar BOX = styled.div(_templateObject());\nvar leaves;\nGeocode.setApiKey(\"AIzaSyC7jUeuFb_ujONIHAG-HKhyXggyd6hvz8s\");\nGeocode.setLanguage(\"zh-tw\");\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleChange\", function (event) {\n      try {\n        _this.setState({\n          searchInput: event,\n          loading: true\n        }, function () {\n          _this.globalSearch();\n        });\n      } catch (err) {\n        next(err);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"globalSearch\", function () {\n      try {\n        var searchInput = _this.state.searchInput;\n        var date_array = searchInput.split(\"/\");\n        var date_select = new Date(date_array[1], date_array[0]);\n        var year_select = date_select.getFullYear();\n        var month_select = date_select.getMonth();\n\n        var filteredData = _this.state.data_origin.filter(function (value) {\n          var date = new Date(value.startDate);\n          var year = date.getFullYear();\n          var month = date.getMonth() + 1;\n          return year === year_select && month === month_select;\n        });\n\n        _this.setState({\n          data: filteredData,\n          loading: false\n        });\n      } catch (err) {\n        next(err);\n      }\n    });\n\n    _this.state = {\n      data: null,\n      loading: true\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.liffInit();\n    }\n  }, {\n    key: \"liffInit\",\n    value: function liffInit() {\n      var _this2 = this;\n\n      try {\n        liff.init(function (data) {\n          var userId = data.context.userId;\n          var accessToken = liff.getAccessToken();\n          var URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n          var body = {\n            userId: userId\n          };\n          fetch(URL_CHECKEXIST, {\n            method: 'post',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: _JSON$stringify(body)\n          }).then(function (res) {\n            return res.text();\n          }).then(function (result) {\n            if (result) {\n              _this2.lineAuth(userId, accessToken);\n            } else {\n              alert(\"請登入以查看假單\");\n              window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n            }\n          });\n        }, function (err) {\n          alert(\"error\");\n        });\n      } catch (err) {\n        next(err);\n      }\n    }\n  }, {\n    key: \"lineAuth\",\n    value: function lineAuth(userId, accessToken) {\n      var _this3 = this;\n\n      try {\n        var url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n        var body = {\n          userId: userId,\n          accessToken: accessToken\n        };\n        fetch(url, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          if (result) {\n            var ubn = result.staff.ubn;\n            var email = result.staff.email;\n            var idToken = result.token.idToken;\n\n            _this3.getPunches(ubn, email, idToken);\n          } else {\n            alert(\"lineAuth no result\");\n          }\n        })[\"catch\"](function (error) {\n          alert(error.message);\n        });\n      } catch (err) {\n        next(err);\n      }\n    }\n  }, {\n    key: \"getPunches\",\n    value: function getPunches(ubn, email, idToken) {\n      var _this4 = this;\n\n      try {\n        var url_pre = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/punch/get\";\n        var url = url_pre + \"?ubn=\".concat(ubn, \"&query=email&value=\").concat(email);\n        var header = {\n          Authorization: idToken\n        };\n        fetch(url, {\n          method: 'get',\n          headers: header\n        }).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          if (result) {\n            _this4.convertData(result.list);\n          } else {\n            alert(\"getPunches no result\");\n          }\n        })[\"catch\"](function (error) {\n          alert(error.message);\n        });\n      } catch (err) {\n        next(err);\n      }\n    }\n  }, {\n    key: \"convertData\",\n    value: function convertData(list) {\n      var _this5 = this;\n\n      alert(\"convertData\");\n\n      try {\n        var newList = [];\n\n        for (var i = 0; i < list.length;) {\n          var date = new Date(list[i].createTime * 1000).toLocaleString('zh-TW', {\n            timeZone: 'Asia/Taipei'\n          });\n          Geocode.fromLatLng(list[i].latitude, list[i].longitude).then(function (response) {\n            var address = response.results[0].formatted_address;\n            alert(address);\n            alert(i);\n            var data = {\n              \"createTime\": date,\n              \"latitude\": list[i].latitude,\n              \"longitude\": list[i].longitude,\n              \"address\": address,\n              \"type\": list[i].type\n            };\n            alert(\"end\");\n            newList.push(data);\n            i++;\n\n            if (i == list.length - 1) {\n              alert(\"in\");\n              alert(i);\n\n              _this5.setState({\n                data: newList,\n                data_origin: newList,\n                loading: false\n              });\n            }\n          }, function (error) {\n            next(error);\n          });\n        }\n      } catch (err) {\n        next(err);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var MyLoader = function MyLoader() {\n        return __jsx(Loader, {\n          loading: _this6.state.loading\n        });\n      };\n\n      var months = ['Jan', 'Feb', 'Mar', 'Spr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\n      var makeText = function makeText(m) {\n        if (m && m.year && m.month) return months[m.month - 1] + '. ' + m.year;\n        return '?';\n      };\n\n      var mvalue = {\n        year: 2015,\n        month: 11\n      };\n      var columns = [{\n        Header: '日期',\n        accessor: 'createTime',\n        width: 90\n      }, {\n        Header: 'latitude',\n        accessor: 'latitude',\n        width: 90\n      }, {\n        Header: 'longitude',\n        accessor: 'longitude',\n        width: 90\n      }, {\n        Header: '地址',\n        accessor: 'address',\n        width: 90\n      }, {\n        Header: '類型',\n        accessor: 'type',\n        width: 90\n      }];\n      return __jsx(\"div\", null, __jsx(\"meta\", {\n        name: \"viewport\",\n        content: \"width=device-width, user-scalable=no\"\n      }), __jsx(Head, null, __jsx(\"script\", {\n        src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n      })), __jsx(\"p\", null, \"\\u5E74/\\u6708\"), __jsx(MonthPickerInput, {\n        onChange: this.handleChange\n      }), __jsx(\"br\", null), __jsx(\"div\", null, this.state.data ? __jsx(ReactTable, {\n        LoadingComponent: MyLoader,\n        data: this.state.data,\n        columns: columns,\n        defaultPageSize: 10,\n        pageSizeOptions: [10, 15]\n      }) : __jsx(ReactTable, {\n        LoadingComponent: MyLoader,\n        data: leaves,\n        columns: columns,\n        defaultPageSize: 10,\n        pageSizeOptions: [10, 15]\n      })));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport { App as default };","map":null,"metadata":{},"sourceType":"module"}