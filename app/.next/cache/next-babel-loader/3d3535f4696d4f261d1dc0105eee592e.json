{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _Date$now from \"@babel/runtime-corejs2/core-js/date/now\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n// Render Prop\nimport React, { Component, useState } from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport icon from '../components/image/icon.png';\nimport Head from 'next/head';\nimport window from 'global'; //import DatePicker from \"react-datepicker\";\n\nimport { Select } from 'material-ui-formik-components/Select';\n\nrequire(\"react-datepicker/dist/react-datepicker.css\");\n\nvar dateFormat = require('dateformat');\n\nimport { DatePicker, TimePicker, DateTimePicker, MuiPickersUtilsProvider } from '@material-ui/pickers';\nimport MomentUtils from '@date-io/moment';\nimport DateFnsUtils from '@date-io/date-fns';\nimport LuxonUtils from '@date-io/luxon';\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\nconst TITLE = styled.h2`\n  color: #F8F9F9;\n  font-family: Candara;\n  text-align: center;\n  margin-bottom:-2em;\n`;\nconst CONTAINER = styled.div`\n  background: #F7F9FA;\n  height: auto;\n  width: 90%;\n  margin: 5em auto;\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\n\n  label {\n    font-family: Candara;\n    color: #1C2833;\n    font-size: 1.2em;\n    font-weight: 400;\n  }\n`;\nconst MYFORM = styled(Form)`\n  text-align: center;\n  padding-top: 2em;\n  padding-bottom: 2em;\n`;\nconst FIELD = styled(Field)`\n  width: 80%;\n  margin: auto;\n`;\nconst BUTTON = styled(Button)`\n  width: 80%;\n  variant: contained;\n`;\nconst TomatoButton = styled.button`\n  color: tomato;\n  border-color: tomato;\n  width: 80%;\n`;\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"handleStartDateChange\", date => {\n      this.setState({\n        startDate: date\n      });\n    });\n\n    _defineProperty(this, \"handleEndDateChange\", date => {\n      this.setState({\n        endDate: date\n      });\n    });\n\n    this.state = {\n      substitutes: [],\n      userId: null,\n      startDate: dateFormat(new Date(), \"yyyy-mm-dd\"),\n      endDate: _Date$now()\n    };\n  }\n\n  componentDidMount() {\n    this.liffInit();\n  }\n\n  liffInit() {\n    liff.init(data => {\n      const userId = data.context.userId;\n      const accessToken = liff.getAccessToken();\n      const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n      const body = {\n        userId: userId\n      };\n      fetch(URL_CHECKEXIST, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: _JSON$stringify(body)\n      }).then(res => {\n        return res.text();\n      }).then(result => {\n        if (result) {\n          this.setState({\n            userId: userId\n          });\n          this.lineAuth(userId, accessToken);\n        } else {\n          alert(\"請登入以查看假單\");\n          window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n        }\n      });\n    }, err => {\n      alert(err.message);\n    });\n  }\n\n  lineAuth(userId, accessToken) {\n    const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n    const body = {\n      userId: userId,\n      accessToken: accessToken\n    };\n    fetch(url, {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: _JSON$stringify(body)\n    }).then(res => {\n      return res.json();\n    }).then(result => {\n      if (result) {\n        const ubn = result.staff.ubn;\n        const department = result.staff.department;\n        const email = result.staff.email;\n        const idToken = result.token.idToken;\n        this.setState({\n          Authorization: idToken,\n          ubn: ubn,\n          email: email\n        });\n        this.getSubstitutes(ubn, department, idToken);\n      } else {\n        alert(\"lineAuth no result\");\n      }\n    }).catch(function (error) {\n      alert(error.message);\n    });\n  }\n\n  getSubstitutes(ubn, department, idToken) {\n    const URL_GETSUBSTITUTES = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/getSubstitutes\";\n    const url = URL_GETSUBSTITUTES + `?ubn=${ubn}&query=department&value=${department}`;\n    const header = {\n      Authorization: idToken\n    }; //document.write(idToken);\n\n    fetch(url, {\n      method: 'get',\n      headers: header\n    }).then(res => {\n      return res.json();\n    }).then(result => {\n      if (result) {\n        this.createOptions(result.list);\n      } else {\n        alert(\"getSubstitutes no result\");\n      }\n    }).catch(function (error) {\n      alert(error.message);\n    });\n  }\n\n  createOptions(arr) {\n    try {\n      var newList = [];\n\n      for (var i = 0; i < arr.length; i++) {\n        var obj = arr[i];\n        obj.value = _JSON$stringify({\n          \"name\": obj.name,\n          \"email\": obj.email\n        });\n        obj.label = obj.name;\n        delete obj.email;\n        delete obj.name; //push to list\n\n        newList.push(obj); // set substitutes\n\n        if (i == arr.length - 1) {\n          this.setState({\n            substitutes: newList\n          });\n        }\n      }\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  submitForm(values) {\n    const URL_CREATELEAVE = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/create\";\n    fetch(URL_CREATELEAVE, {\n      method: 'post',\n      headers: {\n        \"Authorization\": this.state.Authorization,\n        \"ubn\": this.state.ubn,\n        \"userId\": this.state.userId,\n        \"Content-Type\": \"application/json\"\n      },\n      body: _JSON$stringify(values)\n    }).then(res => {\n      return res.text();\n    }).then(result => {\n      if (result) {\n        liff.closeWindow();\n      } else {\n        alert(\"submitForm error\"); //window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n      }\n    }).catch(function (error) {\n      alert(error.message);\n    });\n  }\n\n  render() {\n    return __jsx(BOX, null, __jsx(Head, null, __jsx(\"script\", {\n      src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n    })), __jsx(\"body\", {\n      style: {\n        background: '#34495E'\n      }\n    }, __jsx(BOX, null, __jsx(Formik, {\n      initialValues: {\n        startDate: dateFormat(new Date(), \"yyyy-mm-dd\"),\n        endDate: dateFormat(new Date(), \"yyyy-mm-dd\"),\n        leaveType: '',\n        leaveReason: '',\n        substitute: ''\n      },\n      validate: values => {\n        const errors = {}; // check for startDate\n\n        if (!values.startDate) {\n          errors.startDate = 'Required';\n        } // check for endDate\n\n\n        if (!values.endDate) {\n          errors.endDate = 'Required';\n        } // check for leaveType\n\n\n        if (!values.leaveType) {\n          errors.leaveType = 'Required';\n        } // check for leaveReason\n\n\n        if (!values.leaveReason) {\n          errors.leaveReason = 'Required';\n        } // check for substitute\n\n\n        if (!values.substitute) {\n          errors.substitute = 'Required';\n        }\n\n        return errors;\n      },\n      onSubmit: (values, {\n        setSubmitting\n      }) => {\n        values.email = this.state.email;\n        this.submitForm(values);\n        setSubmitting(false);\n        /*\n        setTimeout(() => {\n          this.submitForm(values);\n          setSubmitting(false);\n        }, 400);\n        */\n\n        console.log('submitting', values); //setSubmitting(false);\n      }\n    }, ({\n      isSubmitting,\n      values,\n      setFieldValue\n    }) => __jsx(CONTAINER, null, __jsx(MYFORM, null, __jsx(MuiPickersUtilsProvider, {\n      utils: LuxonUtils\n    }, __jsx(DatePicker, {\n      style: {\n        width: \"80%\"\n      },\n      name: \"startDate\",\n      label: \"\\u958B\\u59CB\\u65E5\\u671F\",\n      format: \"yyyy-MM-dd\",\n      value: values.startDate,\n      onChange: date => setFieldValue('startDate', dateFormat(date, \"yyyy-mm-dd\"))\n    })), __jsx(\"br\", null), __jsx(\"br\", null), __jsx(MuiPickersUtilsProvider, {\n      utils: LuxonUtils\n    }, __jsx(DatePicker, {\n      style: {\n        width: \"80%\"\n      },\n      name: \"endDate\",\n      label: \"\\u7D50\\u675F\\u65E5\\u671F\",\n      format: \"yyyy-MM-dd\",\n      value: values.endDate,\n      onChange: date => setFieldValue('endDate', dateFormat(date, \"yyyy-mm-dd\"))\n    })), __jsx(\"div\", {\n      style: {\n        width: \"80%\",\n        margin: 'auto'\n      }\n    }, __jsx(Field, {\n      type: \"leaveType\",\n      name: \"leaveType\",\n      label: \"\\u5047\\u52E4\\u985E\\u5225\",\n      options: [{\n        value: '病假',\n        label: '病假'\n      }, {\n        value: '事假',\n        label: '事假'\n      }, {\n        value: '喪假',\n        label: '喪假'\n      }, {\n        value: '公假',\n        label: '公假'\n      }, {\n        value: '生理假',\n        label: '生理假'\n      }, {\n        value: '婚假',\n        label: '婚假'\n      }, {\n        value: '產假',\n        label: '產假'\n      }, {\n        value: '陪產假',\n        label: '陪產假'\n      }],\n      component: Select\n    })), __jsx(FIELD, {\n      type: \"leaveReason\",\n      name: \"leaveReason\",\n      label: \"\\u5047\\u52E4\\u4E8B\\u7531\",\n      component: TextField\n    }), __jsx(\"div\", {\n      style: {\n        width: \"80%\",\n        margin: 'auto'\n      }\n    }, __jsx(Field, {\n      type: \"substitute\",\n      name: \"substitute\",\n      label: \"\\u8077\\u52D9\\u4EE3\\u7406\\u4EBA\",\n      options: this.state.substitutes,\n      component: Select\n    })), __jsx(\"br\", null), __jsx(\"br\", null), __jsx(BUTTON, {\n      type: \"submit\",\n      fontFamily: \"Candara\",\n      variant: \"contained\",\n      color: \"secondary\",\n      disabled: isSubmitting\n    }, \"\\u9001\\u51FA\\u5047\\u55AE\")))))));\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}