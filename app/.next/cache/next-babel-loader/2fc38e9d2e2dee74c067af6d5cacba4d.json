{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar __jsx = React.createElement;\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n  color: tomato;\\n  border-color: tomato;\\n  width: 80%;\\n\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 80%;\\n  variant: contained;\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 80%;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  text-align: center;\\n  padding-top: 2em;\\n  padding-bottom: 2em;\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  background: #F7F9FA;\\n  height: auto;\\n  width: 90%;\\n  margin: 5em auto;\\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\\n\\n  label {\\n    font-family: Candara;\\n    color: #1C2833;\\n    font-size: 1.2em;\\n    font-weight: 400;\\n  }\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  color: #F8F9F9;\\n  font-family: Candara;\\n  text-align: center;\\n  margin-bottom:-2em;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 5.5em auto;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\n// Render Prop\nimport React from 'react';\nimport styled from 'styled-components';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { TextField } from 'formik-material-ui';\nimport fetch from 'isomorphic-unfetch';\nimport Button from \"@material-ui/core/Button\";\nimport Box from \"@material-ui/core/Box\";\nimport icon from '../components/image/icon.png';\nimport Head from 'next/head';\nimport window from 'global';\nimport DatePicker from \"react-datepicker\";\nimport { Select } from 'material-ui-formik-components/Select';\n\nrequire(\"react-datepicker/dist/react-datepicker.css\");\n\nvar liff = window.liff;\nvar BOX = styled.div(_templateObject());\nvar TITLE = styled.h2(_templateObject2());\nvar CONTAINER = styled.div(_templateObject3());\nvar MYFORM = styled(Form)(_templateObject4());\nvar FIELD = styled(Field)(_templateObject5());\nvar BUTTON = styled(Button)(_templateObject6());\nvar TomatoButton = styled.button(_templateObject7());\n\nvar liffInit = function liffInit() {\n  return _regeneratorRuntime.async(function liffInit$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          liff.init(function (data) {\n            var userId = data.context.userId;\n            var accessToken = liff.getAccessToken(); //alert(\"success\");\n            //alert(userId);\n\n            var URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n            var body = {\n              userId: userId\n            };\n            fetch(URL_CHECKEXIST, {\n              method: 'post',\n              headers: {\n                'Content-Type': 'application/json'\n              },\n              body: _JSON$stringify(body)\n            }).then(function (res) {\n              return res.text();\n            }).then(function (result) {\n              if (result) {\n                alert(userId);\n                alert(accessToken);\n                lineAuth(userId, accessToken);\n              } else {\n                alert(\"請登入以查看假單\");\n                window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n              }\n            });\n          }, function (err) {\n            alert(\"error\");\n          });\n\n        case 1:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  });\n};\n\nvar lineAuth = function lineAuth(userId, accessToken) {\n  var url, body;\n  return _regeneratorRuntime.async(function lineAuth$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n          body = {\n            userId: userId,\n            accessToken: accessToken\n          };\n          fetch(url, {\n            method: 'post',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: _JSON$stringify(body)\n          }).then(function (res) {\n            return res.json();\n          }).then(function (result) {\n            if (result) {\n              alert(\"success\"); //alert(result.staff);\n              //alert(result);\n\n              var ubn = result.staff.ubn;\n              var department = result.staff.depertment;\n              var idToken = result.token.idToken;\n              getSubstitutes(ubn, department, idToken);\n            } else {\n              alert(\"lineAuth no result\");\n            }\n          })[\"catch\"](function (error) {\n            alert(error.message);\n          });\n\n        case 3:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  });\n};\n\nvar getSubstitutes = function getSubstitutes(ubn, department, accessToken) {\n  var URL_GETSUBSTITUTES, url, header;\n  return _regeneratorRuntime.async(function getSubstitutes$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          URL_GETSUBSTITUTES = \"https://https-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n          url = URL_GETSUBSTITUTES + \"?ubn=\".concat(ubn, \"&query=department&value=\").concat(department);\n          header = {\n            Authorization: accessToken\n          };\n          fetch(url, {\n            method: 'get',\n            headers: header\n          }).then(function (res) {\n            return res.json();\n          }).then(function (result) {\n            if (result) {\n              alert(\"success\");\n              createOptions(result.list);\n            } else {\n              alert(\"getSubstitutes no result\");\n            }\n          })[\"catch\"](function (error) {\n            alert(error.message);\n          });\n\n        case 4:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  });\n};\n\nvar substitutes;\n\nvar createOptions = function createOptions(arr) {\n  var i, obj, newList;\n  return _regeneratorRuntime.async(function createOptions$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          for (i = 0; i < arr.length; i++) {\n            obj = JSON.parse(arr)[i];\n            obj.email = obj.value;\n            obj.name = obj.label;\n            delete obj.email;\n            delete obj.name; //push to list\n\n            newList = [];\n            newList.push(obj);\n          } // tell Basic that options have been changed\n\n\n          substitutes = newList;\n\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  });\n}; //liffInit();\n\n\nBasic.getInitialProps = function _callee(req) {\n  return _regeneratorRuntime.async(function _callee$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          liffInit();\n\n        case 1:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  });\n};\n\nvar Basic = function Basic() {\n  return __jsx(BOX, null, __jsx(Head, null, __jsx(\"script\", {\n    src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n  })), __jsx(\"body\", {\n    style: {\n      background: '#34495E'\n    }\n  }, __jsx(BOX, null, __jsx(Formik, {\n    initialValues: {\n      startDate: '',\n      endDate: '',\n      leaveType: '',\n      leaveReason: ' ',\n      substitute: ' '\n    },\n    validate: function validate(values) {\n      var errors = {}; // check for ubn\n\n      if (!values.startDate) {\n        errors.startDate = 'Required';\n      } // check for email\n\n\n      if (!values.endDate) {\n        errors.endDate = 'Required';\n      } // check for leaveType\n\n\n      if (!values.leaveType) {\n        errors.leaveType = 'Required';\n      } // check for leaveReason\n\n\n      if (!values.leaveReason) {\n        errors.leaveReason = 'Required';\n      } // check for substitute\n\n\n      if (!values.substitute) {\n        errors.substitute = 'Required';\n      }\n\n      return errors;\n    },\n    onSubmit: function onSubmit(values, _ref) {\n      var setSubmitting = _ref.setSubmitting;\n      //submitForm(values, userId);\n      setTimeout(function () {\n        submitForm(values, userId);\n        setSubmitting(false);\n      }, 400); //console.log('submitting', values);\n      //setSubmitting(false);\n    }\n  }, function (_ref2) {\n    var isSubmitting = _ref2.isSubmitting,\n        values = _ref2.values,\n        setFieldValue = _ref2.setFieldValue;\n    return __jsx(CONTAINER, null, __jsx(MYFORM, null, __jsx(DatePicker, {\n      selected: values.startDate,\n      dateFormat: \"MMMM d, yyyy\",\n      className: \"form-control\",\n      name: \"startDate\",\n      label: \"\\u958B\\u59CB\\u65E5\\u671F\",\n      onChange: function onChange(date) {\n        return setFieldValue('startDate', date);\n      }\n    }), __jsx(DatePicker, {\n      selected: values.endDate,\n      dateFormat: \"MMMM d, yyyy\",\n      className: \"form-control\",\n      name: \"endDate\",\n      label: \"\\u7D50\\u675F\\u65E5\\u671F\",\n      onChange: function onChange(date) {\n        return setFieldValue('endDate', date);\n      }\n    }), __jsx(FIELD, {\n      type: \"leaveType\",\n      name: \"leaveType\",\n      label: \"\\u5047\\u52E4\\u985E\\u5225\",\n      component: TextField\n    }), __jsx(FIELD, {\n      type: \"leaveReason\",\n      name: \"leaveReason\",\n      label: \"\\u5047\\u52E4\\u4E8B\\u7531\",\n      component: TextField\n    }), __jsx(FIELD, {\n      type: \"substitute\",\n      name: \"substitute\",\n      label: \"\\u8077\\u52D9\\u4EE3\\u7406\\u4EBA\",\n      component: TextField\n    }), __jsx(Field, {\n      required: true,\n      name: \"substitute\",\n      label: \"\\u8077\\u52D9\\u4EE3\\u7406\\u4EBA\",\n      options: substitutes,\n      component: Select\n    }), __jsx(\"br\", null), __jsx(\"br\", null), __jsx(BUTTON, {\n      type: \"submit\",\n      fontFamily: \"Candara\",\n      variant: \"contained\",\n      color: \"secondary\",\n      disabled: isSubmitting\n    }, \"\\u9001\\u51FA\\u5047\\u55AE\")));\n  }))));\n};\n\nexport default Basic;","map":null,"metadata":{},"sourceType":"module"}