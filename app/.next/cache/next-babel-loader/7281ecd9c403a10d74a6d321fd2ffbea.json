{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport React, { Component } from 'react';\nimport ReactTable from \"react-table\";\nimport styled from 'styled-components';\nimport \"react-table/react-table.css\";\nimport window from 'global';\nimport MonthPickerInput from 'react-month-picker-input';\nimport Loader from \"./loader\"; //import 'react-month-picker-input/dist/react-month-picker-input.css';\n//var MonthPickerInput = require('react-month-picker-input');\n\nrequire('react-month-picker-input/dist/react-month-picker-input.css');\n\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\nvar leaves;\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"handleChange\", event => {\n      try {\n        this.setState({\n          searchInput: event,\n          loading: true\n        }, () => {\n          this.globalSearch();\n        });\n      } catch (err) {\n        next(err);\n      }\n    });\n\n    _defineProperty(this, \"globalSearch\", () => {\n      try {\n        let {\n          searchInput\n        } = this.state;\n        var date_array = searchInput.split(\"/\");\n        var date_select = new Date(date_array[1], date_array[0]);\n        var year_select = date_select.getFullYear();\n        var month_select = date_select.getMonth();\n        let filteredData = this.state.data_origin.filter(value => {\n          var date = new Date(value.startDate);\n          var year = date.getFullYear();\n          var month = date.getMonth() + 1;\n          return year === year_select && month === month_select;\n        });\n        this.setState({\n          data: filteredData,\n          loading: false\n        });\n      } catch (err) {\n        next(err);\n      }\n    });\n\n    this.state = {\n      data: null,\n      loading: true\n    };\n  }\n\n  componentDidMount() {\n    this.liffInit();\n  }\n\n  liffInit() {\n    try {\n      liff.init(data => {\n        const userId = data.context.userId;\n        const accessToken = liff.getAccessToken();\n        const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n        const body = {\n          userId: userId\n        };\n        fetch(URL_CHECKEXIST, {\n          method: 'post',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: _JSON$stringify(body)\n        }).then(res => {\n          return res.text();\n        }).then(result => {\n          if (result) {\n            this.lineAuth(userId, accessToken);\n          } else {\n            alert(\"請登入以查看假單\");\n            window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n          }\n        });\n      }, err => {\n        alert(\"error\");\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  lineAuth(userId, accessToken) {\n    try {\n      const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n      const body = {\n        userId: userId,\n        accessToken: accessToken\n      };\n      fetch(url, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: _JSON$stringify(body)\n      }).then(res => {\n        return res.json();\n      }).then(result => {\n        if (result) {\n          const ubn = result.staff.ubn;\n          const email = result.staff.email;\n          const idToken = result.token.idToken;\n          this.getPunches(ubn, email, idToken);\n        } else {\n          alert(\"lineAuth no result\");\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  getPunches(ubn, email, idToken) {\n    try {\n      const url_pre = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/punch/get\";\n      const url = url_pre + `?ubn=${ubn}&query=email&value=${email}`;\n      const header = {\n        Authorization: idToken\n      };\n      fetch(url, {\n        method: 'get',\n        headers: header\n      }).then(res => {\n        return res.json();\n      }).then(result => {\n        if (result) {\n          this.convertData(result.list);\n        } else {\n          alert(\"getPunches no result\");\n        }\n      }).catch(function (error) {\n        alert(error.message);\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  convertData(list) {\n    alert(\"convertData\");\n\n    try {\n      var newList = [];\n      alert(list.length);\n\n      for (var i = 0; i < list.length; i++) {\n        var date = new Date(list[i].createTime).toLocaleString('zh-TW', {\n          timeZone: 'Asia/Taipei'\n        });\n        const data = {\n          \"createTime\": date,\n          \"latitude\": list[i].latitude,\n          \"longitude\": list[i].longitude,\n          \"type\": list[i].type\n        };\n        newList.push(data);\n      }\n\n      this.setState({\n        data: newList,\n        data_origin: newList,\n        loading: false\n      });\n    } catch (err) {\n      next(err);\n    }\n  }\n\n  render() {\n    const MyLoader = () => __jsx(Loader, {\n      loading: this.state.loading\n    });\n\n    let months = ['Jan', 'Feb', 'Mar', 'Spr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\n    let makeText = m => {\n      if (m && m.year && m.month) return months[m.month - 1] + '. ' + m.year;\n      return '?';\n    };\n\n    let mvalue = {\n      year: 2015,\n      month: 11\n    };\n    const columns = [{\n      Header: '日期',\n      accessor: 'createTime',\n      width: 90\n    }, {\n      Header: 'latitude',\n      accessor: 'latitude',\n      width: 90\n    }, {\n      Header: 'longitude',\n      accessor: 'longitude',\n      width: 90\n    }, {\n      Header: '類型',\n      accessor: 'type',\n      width: 90\n    }];\n    return __jsx(\"div\", null, __jsx(\"meta\", {\n      name: \"viewport\",\n      content: \"width=device-width, user-scalable=no\"\n    }), __jsx(Head, null, __jsx(\"script\", {\n      src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n    })), __jsx(\"p\", null, \"\\u5E74/\\u6708\"), __jsx(MonthPickerInput, {\n      onChange: this.handleChange\n    }), __jsx(\"br\", null), __jsx(\"div\", null, this.state.data ? __jsx(ReactTable, {\n      LoadingComponent: MyLoader,\n      data: this.state.data,\n      columns: columns,\n      defaultPageSize: 10,\n      pageSizeOptions: [10, 15]\n    }) : __jsx(ReactTable, {\n      LoadingComponent: MyLoader,\n      data: leaves,\n      columns: columns,\n      defaultPageSize: 10,\n      pageSizeOptions: [10, 15]\n    })));\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}