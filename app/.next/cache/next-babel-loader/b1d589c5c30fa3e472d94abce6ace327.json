{"ast":null,"code":"import _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport React, { Component } from 'react';\nimport ReactTable from \"react-table\";\nimport styled from 'styled-components';\nimport \"react-table/react-table.css\";\nimport window from 'global';\nimport MonthPickerInput from 'react-month-picker-input'; //import 'react-month-picker-input/dist/react-month-picker-input.css';\n//var MonthPickerInput = require('react-month-picker-input');\n\nrequire('react-month-picker-input/dist/react-month-picker-input.css');\n\nconst liff = window.liff;\nconst BOX = styled.div`\n  margin: 5.5em auto;\n`;\n\nconst liffInit = async () => {\n  liff.init(data => {\n    const userId = data.context.userId;\n    const accessToken = liff.getAccessToken(); //alert(\"success\");\n    //alert(userId);\n\n    const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n    const body = {\n      userId: userId\n    };\n    fetch(URL_CHECKEXIST, {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: _JSON$stringify(body)\n    }).then(res => {\n      return res.text();\n    }).then(result => {\n      if (result) {\n        alert(userId);\n        alert(accessToken);\n        lineAuth(userId, accessToken);\n      } else {\n        alert(\"請登入以查看假單\");\n        window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n      }\n    });\n  }, err => {\n    alert(\"error\");\n  });\n};\n\nconst lineAuth = async (userId, accessToken) => {\n  const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n  const body = {\n    userId: userId,\n    accessToken: accessToken\n  };\n  fetch(url, {\n    method: 'post',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: _JSON$stringify(body)\n  }).then(res => {\n    return res.json();\n  }).then(result => {\n    if (result) {\n      alert(\"success\"); //alert(result.staff);\n      //alert(result);\n\n      const ubn = result.staff.ubn;\n      const email = result.staff.email;\n      const idToken = result.token.idToken;\n      getLeaves(ubn, email, idToken);\n    } else {\n      alert(\"lineAuth no result\");\n    }\n  }).catch(function (error) {\n    alert(error.message);\n  });\n};\n\nvar leaves;\n\nconst getLeaves = async (ubn, email, idToken) => {\n  const url_pre = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n  const url = url_pre + `?ubn=${ubn}&query=email&value=${email}`;\n  const header = {\n    Authorization: idToken\n  };\n  fetch(url, {\n    method: 'get',\n    headers: header\n  }).then(res => {\n    return res.json();\n  }).then(result => {\n    if (result) {\n      convertData(result.list);\n      alert(result.list[0].startDate);\n    } else {\n      alert(\"getLeaves no result\");\n    }\n  }).catch(function (error) {\n    alert(error.message);\n  });\n};\n\nconst convertData = async list => {\n  var newList = [];\n\n  for (var i = 0; i < list.length; i++) {\n    const data = {\n      \"startDate\": list[i].startDate,\n      \"endDate\": list[i].endDate,\n      \"leaveType\": list[i].leaveType,\n      \"substitute\": list[i].substitute.name,\n      \"status\": list[i].status\n    };\n    newList.push(data);\n  }\n\n  leaves = newList; //alert(leaves);\n}; //liffInit();\n\n\nconst Basic = () => __jsx(Head, null, __jsx(\"script\", {\n  src: \"https://d.line-scdn.net/liff/1.0/sdk.js\"\n})); //export default Basic;\n\n\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"handleChange\", event => {\n      this.setState({\n        searchInput: event.target.value\n      }, () => {\n        this.globalSearch();\n      });\n    });\n\n    _defineProperty(this, \"globalSearch\", () => {\n      let {\n        searchInput\n      } = this.state;\n      var date = new Date(value.startDate);\n      var year = date.getFullYear();\n      var month = date.getMonth() + 1;\n      var date_select = new Date(searchInput);\n      var year_select = date_select.getFullYear();\n      var month_select = date.getMonth() + 1;\n      let filteredData = this.state.data.filter(value => {\n        return year === year_select && month === month_select;\n      });\n      this.setState({\n        data: filteredData\n      });\n    });\n\n    this.state = {\n      data: null\n    };\n  }\n\n  componentDidMount() {\n    this.liffInit();\n  }\n\n  liffInit() {\n    liff.init(data => {\n      const userId = data.context.userId;\n      const accessToken = liff.getAccessToken(); //alert(\"success\");\n      //alert(userId);\n\n      const URL_CHECKEXIST = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist\";\n      const body = {\n        userId: userId\n      };\n      fetch(URL_CHECKEXIST, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: _JSON$stringify(body)\n      }).then(res => {\n        return res.text();\n      }).then(result => {\n        if (result) {\n          alert(userId);\n          alert(accessToken);\n          this.lineAuth(userId, accessToken);\n        } else {\n          alert(\"請登入以查看假單\");\n          window.location.replace(\"https://teddybear-dev.firebaseapp.com/signIn\");\n        }\n      });\n    }, err => {\n      alert(\"error\");\n    });\n  }\n\n  lineAuth(userId, accessToken) {\n    const url = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth\";\n    const body = {\n      userId: userId,\n      accessToken: accessToken\n    };\n    fetch(url, {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: _JSON$stringify(body)\n    }).then(res => {\n      return res.json();\n    }).then(result => {\n      if (result) {\n        alert(\"success\"); //alert(result.staff);\n        //alert(result);\n\n        const ubn = result.staff.ubn;\n        const email = result.staff.email;\n        const idToken = result.token.idToken;\n        this.getLeaves(ubn, email, idToken);\n      } else {\n        alert(\"lineAuth no result\");\n      }\n    }).catch(function (error) {\n      alert(error.message);\n    });\n  }\n\n  getLeaves(ubn, email, idToken) {\n    const url_pre = \"https://us-central1-teddybear-dev.cloudfunctions.net/api/leave/get\";\n    const url = url_pre + `?ubn=${ubn}&query=email&value=${email}`;\n    const header = {\n      Authorization: idToken\n    };\n    fetch(url, {\n      method: 'get',\n      headers: header\n    }).then(res => {\n      return res.json();\n    }).then(result => {\n      if (result) {\n        this.convertData(result.list);\n        alert(result.list[0].startDate);\n      } else {\n        alert(\"getLeaves no result\");\n      }\n    }).catch(function (error) {\n      alert(error.message);\n    });\n  }\n\n  convertData(list) {\n    var newList = [];\n\n    for (var i = 0; i < list.length; i++) {\n      const data = {\n        \"startDate\": list[i].startDate,\n        \"endDate\": list[i].endDate,\n        \"leaveType\": list[i].leaveType,\n        \"substitute\": JSON.parse(list[i].substitute).name,\n        \"status\": list[i].status\n      };\n      newList.push(data);\n    }\n\n    this.setState({\n      data: newList\n    }); //leaves = newList;\n    //alert(leaves);\n  }\n\n  renderMyData() {//liffInit();\n  }\n\n  render() {\n    let months = ['Jan', 'Feb', 'Mar', 'Spr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\n    let makeText = m => {\n      if (m && m.year && m.month) return months[m.month - 1] + '. ' + m.year;\n      return '?';\n    };\n\n    let mvalue = {\n      year: 2015,\n      month: 11\n    };\n    const columns = [{\n      Header: '開始日期',\n      accessor: 'startDate',\n      id: \"startDate\"\n    }, {\n      Header: '結束日期',\n      accessor: 'endDate'\n    }, {\n      Header: '假勤類別',\n      accessor: 'leaveType'\n    }, {\n      Header: '代理人',\n      accessor: 'substitute'\n    }, {\n      Header: '簽核狀態',\n      accessor: 'status'\n    }];\n    return __jsx(BOX, null, __jsx(MonthPickerInput, {\n      onChange: this.handleChange\n    }), __jsx(\"div\", null, this.state.data ? __jsx(ReactTable, {\n      data: this.state.data,\n      columns: columns,\n      defaultPageSize: 10,\n      pageSizeOptions: [10, 15]\n    }) : __jsx(ReactTable, {\n      data: leaves,\n      columns: columns,\n      defaultPageSize: 10,\n      pageSizeOptions: [10, 15]\n    })));\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}