(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"5jIz":function(t,n,e){"use strict";e.r(n),e.d(n,"default",(function(){return G}));var o=e("9Jkg"),i=e.n(o),r=e("0iUn"),a=e("sLSF"),u=e("MI3g"),c=e("a7VT"),s=e("Tit0"),l=e("rt45"),d=e("q1tI"),f=e.n(d),p=e("vOnD"),h=e("KYPV"),b=(e("vBfy"),e("vcXL")),y=e.n(b),v=e("Z3vd"),m=e("8Kt/"),g=e.n(m),O=e("vgmO"),j=e.n(O),w=(e("VrOB"),e("YKRf"),e("jkUL")),P=e.n(w),T=(e("Bb0u"),e("yLQo"),f.a.createElement);function E(){var t=Object(l.a)(["\n  color: tomato;\n  border-color: tomato;\n  width: 80%;\n"]);return E=function(){return t},t}function k(){var t=Object(l.a)(["\n  width: 80%;\n  variant: contained;\n"]);return k=function(){return t},t}function I(){var t=Object(l.a)(["\n  width: 60vw;\n  margin: auto;\n"]);return I=function(){return t},t}function x(){var t=Object(l.a)(["\n  text-align: center;\n  padding-top: 2em;\n  padding-bottom: 2em;\n"]);return x=function(){return t},t}function C(){var t=Object(l.a)(["\n  background: #F7F9FA;\n  height: 90vh;\n  width: 80vw;\n  margin: 5em auto;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  box-shadow: 5px 5px 5px 0px rgba(0, 0, 0, 0.4);\n\n  label {\n    font-family: Candara;\n    color: #1C2833;\n    font-size: 1.2em;\n    font-weight: 400;\n  }\n"]);return C=function(){return t},t}function _(){var t=Object(l.a)(["\n  color: #F8F9F9;\n  font-family: Candara;\n  text-align: center;\n  margin-bottom:-2em;\n"]);return _=function(){return t},t}function S(){var t=Object(l.a)(["\n  margin: 5.5em auto;\n  width: 80vw;\n  height: 64vh;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n"]);return S=function(){return t},t}function A(){var t=Object(l.a)(["\n  display: table;\n  margin: 0 auto;\n"]);return A=function(){return t},t}e("5Buo");e("ubkq");var D=j.a.liff,L=p.a.div(A()),M=p.a.div(S()),F=(p.a.h2(_()),p.a.div(C()),Object(p.a)(h.Form)(x()),Object(p.a)(h.Field)(I()),Object(p.a)(v.a)(k())),G=(p.a.button(E()),function(t){function n(t){var e;return Object(r.a)(this,n),(e=Object(u.a)(this,Object(c.a)(n).call(this,t))).state={substitutes:[],userId:null},e}return Object(s.a)(n,t),Object(a.a)(n,[{key:"componentDidMount",value:function(){this.liffInit(),this.getLocation()}},{key:"liffInit",value:function(){var t=this;try{D.init((function(n){var e=n.context.userId,o=D.getAccessToken(),r={userId:e};y()("https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/checkExist",{method:"post",headers:{"Content-Type":"application/json"},body:i()(r)}).then((function(t){return t.text()})).then((function(n){n?(t.setState({userId:e}),t.lineAuth(e,o)):(alert("\u8acb\u767b\u5165\u4ee5\u67e5\u770b\u5047\u55ae"),j.a.location.replace("https://teddybear-dev.firebaseapp.com/signIn"))}))}),(function(t){alert(t.message)}))}catch(n){next(n)}}},{key:"lineAuth",value:function(t,n){var e=this;try{var o={userId:t,accessToken:n};y()("https://us-central1-teddybear-dev.cloudfunctions.net/api/staff/lineAuth",{method:"post",headers:{"Content-Type":"application/json"},body:i()(o)}).then((function(t){return t.json()})).then((function(t){if(t){var n=t.staff.ubn,o=(t.staff.department,t.staff.email),i=t.token.idToken;e.setState({Authorization:i,ubn:n,email:o})}else alert("lineAuth no result")})).catch((function(t){alert(t.message)}))}catch(r){next(r)}}},{key:"getLocation",value:function(){try{alert("getLocation"),navigator.geolocation.getCurrentPosition((function(t){alert("Latitude is :",t.coords.latitude),alert("Longitude is :",t.coords.longitude),this.setState({latitude:t.coords.latitude,longitude:t.coords.longitude})}))}catch(t){next(t)}}},{key:"punchIn",value:function(){try{y()("https://us-central1-teddybear-dev.cloudfunctions.net/api/punch/create",{method:"post",headers:{Authorization:this.state.Authorization,ubn:this.state.ubn,"Content-Type":"application/json"},body:{latitude:this.state.latitude,longitude:this.state.longitude,type:"in",email:this.state.email}}).then((function(t){return t.text()})).then((function(t){t?alert("punch in success"):alert("punch error")})).catch((function(t){alert(t.message)}))}catch(t){next(t)}}},{key:"render",value:function(){var t=this;return T(M,null,T(g.a,null,T("script",{src:"https://d.line-scdn.net/liff/1.0/sdk.js"})),T("body",{style:{background:"#34495E"}},T(M,null,this.state.email?T(F,{fontFamily:"Candara",variant:"contained",color:"secondary",disabled:!this.state.latitude|!this.state.longitude,onClick:function(){t.punchIn()}},"\u7c3d\u5230"):T(L,null,T(P.a,{type:"ThreeDots",color:"#f50057",height:80,width:80})))))}}]),n}(d.Component))},tPI5:function(t,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/punchIn",function(){return e("5jIz")}])},yLQo:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.geoPropTypes=n.geolocated=void 0;var o,i=function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,e):{};o.get||o.set?Object.defineProperty(n,e,o):n[e]=t[e]}return n.default=t,n}(e("q1tI")),r=(o=e("17x9"))&&o.__esModule?o:{default:o};function a(t){return(a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(){return(u=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t}).apply(this,arguments)}function c(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function s(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function l(t,n,e){return n&&s(t.prototype,n),e&&s(t,e),t}function d(t,n){return!n||"object"!==a(n)&&"function"!==typeof n?p(t):n}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&b(t,n)}function b(t,n){return(b=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function y(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var v=function(t){return"Geolocated(".concat(t.displayName||t.name||"Component",")")};n.geolocated=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.positionOptions,e=void 0===n?{enableHighAccuracy:!0,maximumAge:0,timeout:1/0}:n,o=t.isOptimisticGeolocationEnabled,a=void 0===o||o,s=t.userDecisionTimeout,b=void 0===s?null:s,m=t.suppressLocationOnMount,g=void 0!==m&&m,O=t.watchPosition,j=void 0!==O&&O,w=t.geolocationProvider,P=void 0===w?"undefined"!==typeof navigator&&navigator.geolocation:w;return function(t){var n=function(n){function o(t){var n;return c(this,o),y(p(n=d(this,f(o).call(this,t))),"isCurrentlyMounted",!1),y(p(n),"cancelUserDecisionTimeout",(function(){n.userDecisionTimeoutId&&clearTimeout(n.userDecisionTimeoutId)})),y(p(n),"onPositionError",(function(t){n.cancelUserDecisionTimeout(),n.isCurrentlyMounted&&n.setState({coords:null,isGeolocationEnabled:!1,positionError:t}),n.props.onError&&n.props.onError(t)})),y(p(n),"onPositionSuccess",(function(t){n.cancelUserDecisionTimeout(),n.isCurrentlyMounted&&n.setState({coords:t.coords,isGeolocationEnabled:!0,positionError:null}),n.props.onSuccess&&n.props.onSuccess(t)})),y(p(n),"getLocation",(function(){if(!P||!P.getCurrentPosition||!P.watchPosition)throw new Error("The provided geolocation provider is invalid");var t=(j?P.watchPosition:P.getCurrentPosition).bind(P);b&&(n.userDecisionTimeoutId=setTimeout((function(){n.onPositionError()}),b)),n.watchId=t(n.onPositionSuccess,n.onPositionError,e)})),n.state={coords:null,isGeolocationAvailable:Boolean(P),isGeolocationEnabled:a,positionError:null},n}return h(o,n),l(o,[{key:"componentDidMount",value:function(){this.isCurrentlyMounted=!0,g||this.getLocation()}},{key:"componentWillUnmount",value:function(){this.isCurrentlyMounted=!1,this.cancelUserDecisionTimeout(),j&&P.clearWatch(this.watchId)}},{key:"render",value:function(){return i.default.createElement(t,u({},this.state,this.props))}}]),o}(i.Component);return n.displayName=v(t),n.propTypes={onError:r.default.func,onSuccess:r.default.func},n}};var m={coords:r.default.shape({latitude:r.default.number,longitude:r.default.number,altitude:r.default.number,accuracy:r.default.number,altitudeAccuracy:r.default.number,heading:r.default.number,speed:r.default.number}),isGeolocationAvailable:r.default.bool,isGeolocationEnabled:r.default.bool,positionError:r.default.shape({code:r.default.oneOf([1,2,3]),message:r.default.string}),watchPosition:r.default.bool};n.geoPropTypes=m}},[["tPI5",1,0]]]);